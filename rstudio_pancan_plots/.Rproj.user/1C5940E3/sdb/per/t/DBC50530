{
    "collab_server" : "",
    "contents" : "library(dplyr)\nlibrary(ggplot2)\nlibrary(colorspace)\nlibrary(viridis)\nlibrary(reshape2)\n\nresults <- read.csv(\"/Users/Eric/tcrseq/new/final/pancan_results_8-10-2016.txt\", sep=\"\\t\")\nclonotypes <- read.csv(\"/Users/Eric/tcrseq/new/final/pancan_clonotypes_8-10-2016.txt\", sep=\"\\t\")\n\nresults <- filter(results, cohort != \"DLBC\")\n                         \nclonotypes$clonotype <- as.character(clonotypes$clonotype)\nclonotypes$patient_id <- as.character(clonotypes$patient_id)\nclonotypes$nuc <- as.character(clonotypes$nuc)\n\n# compare exome and blood\n# defining \"public clonotype\" as any that is found in both exome and blood (though not in same patient)\n#exome_pos_blood_pos <- filter(clonotypes, blood > 0 & exome > 0)\n#exome_neg_blood_pos <- filter(clonotypes, blood > 0 & exome == 0)\n#exome_pos_blood_neg <- filter(clonotypes, blood == 0 & exome > 0)\n\n#clonotype_common <- \"TGTGCCACCAGCAGAGACACAGAGCTGCAGTGCTTCCTGCTCTCTGTTCATAAACCTCATTGTTTCCCAGATCCAGGTGCTTTCTCT\"\nclonotype_common <- \"CATSRDTELQCFLLSVHKPHCFPDPGAFS\"\nshared <- clonotypes[which(clonotypes$clonotype==clonotype_common),]\n\n#public_clonotypes_patients <- unique(exome_pos_blood_pos$patient_id)\n\nexome_pos <- filter(clonotypes, exome > 0)\nblood_pos <- filter(clonotypes, blood > 0)\n\nexome_blood_shared_aa <- unique(intersect(exome_pos$clonotype, blood_pos$clonotype))\nexome_or_blood <- filter(clonotypes, exome > 0 | blood > 0)\nexome_or_blood_patients <- unique(exome_or_blood$patient_id)\nexome_blood_public_aa <- names(which(table(exome_or_blood$clonotype)>1))\nexome_blood_shared_all <- filter(exome_or_blood, clonotype %in% exome_blood_shared_aa)\nexome_blood_shared_patients <- unique(exome_blood_shared_all$patient_id)\nexome_blood_public_all <- filter(exome_or_blood, clonotype %in% exome_blood_public_aa)\nexome_blood_public_patients <- unique(exome_blood_public_all$patient_id)\n\n# 100 shared aa sequences between blood and tumor exome\n# 5934 patients with a clonotype in exome OR blood\n# 574 that have a public clonotype\n# 348 of these have the \"sticky\" clonotype\n\n# remove \"sticky\" clonotype\nexome_blood_shared_aa_no_c66 <- exome_blood_shared_aa[exome_blood_shared_aa!=clonotype_common]\nexome_blood_shared_no_c66 <- filter(exome_or_blood, clonotype %in% exome_blood_shared_aa_no_c66)\nexome_blood_shared_patients_no_c66 <- unique(exome_blood_shared_no_c66$patient_id)\n\n# only \"sticky\" clonotype\nexome_blood_shared_only_c66 <- filter(exome_or_blood, clonotype==clonotype_common)\nexome_blood_shared_patients_only_c66 <- unique(exome_blood_shared_only_c66$patient_id)\n\nexome_blood_shared_patients_only_c66_clonotypes <- filter(clonotypes, patient_id %in% exome_blood_shared_patients_only_c66)\n\n# includes RNA\npublic_aa <- names(which(table(clonotypes$clonotype)>1))\npublic_aa_n <- c()\nfor (i in 1:length(public_aa))\n{\n  public_aa_n <- c(public_aa_n, nrow(filter(clonotypes, clonotype==public_aa[i])))\n}\n\npublic_all <- filter(clonotypes, clonotype %in% public_aa)\npublic_patients <- unique(public_all$patient_id)\n\n# compare exome and rna\nexome_pos_rna_pos <- filter(clonotypes, rna > 0 & exome > 0)\nexome_neg_rna_pos <- filter(clonotypes, rna > 0 & exome == 0)\nexome_pos_rna_neg <- filter(clonotypes, rna == 0 & exome > 0)\n\n### new paper work start here 8/21 ###\n\n# just tumor exome\nexome_pos <- filter(clonotypes, exome > 0)\ntumor_exome_cl <- unique(exome_pos$clonotype)\nlength(tumor_exome_cl)\nlength(unique(exome_pos$patient_id))\n\ntumor_exome_shared_aa <- names(which(table(exome_pos$clonotype)>1))\nexome_tumor_shared <- filter(exome_pos, clonotype %in% tumor_exome_shared_aa)\nlength(unique(exome_tumor_shared$clonotype))\nlength(unique(exome_tumor_shared$patient_id))\nsort(table(exome_tumor_shared$clonotype))\n\nhist((sort(table(exome_tumor_shared$clonotype), decreasing = TRUE))) # 5 AA one is likely artifact\nggplot(melt(table(exome_tumor_shared$clonotype)), aes(value)) + geom_histogram() + labs(x=\"Number of patients with clonotype\", y=\"Number of clonotypes\") + theme(text=element_text(size=16))\n\n# just tumor RNA\nrna_pos <- filter(clonotypes, rna > 0)\ntumor_rna_cl <- unique(rna_pos$clonotype)\nlength(tumor_rna_cl)\nlength(unique(rna_pos$patient_id))\n\ntumor_rna_shared_aa <- names(which(table(rna_pos$clonotype)>1))\nrna_tumor_shared <- filter(rna_pos, clonotype %in% tumor_rna_shared_aa)\nlength(unique(rna_tumor_shared$clonotype))\nlength(unique(rna_tumor_shared$patient_id))\nsort(table(rna_tumor_shared$clonotype))\n\nhist((sort(table(rna_tumor_shared$clonotype), decreasing = TRUE)[-1])) # 5 AA one is likely artifact\nggplot(melt(table(rna_tumor_shared$clonotype)), aes(value)) + geom_histogram() + labs(x=\"Number of patients with clonotype\", y=\"Number of clonotypes\") + theme(text=element_text(size=16))\n\n# tumor exome and RNA\ntumor_exome_rna_shared <- intersect(tumor_exome_cl, tumor_rna_cl)\nlength(tumor_exome_rna_shared)\n\nexome_rna_tumor_shared <- filter(clonotypes, clonotype %in% tumor_exome_rna_shared)\nlength(unique(exome_rna_tumor_shared$clonotype))\nlength(unique(exome_rna_tumor_shared$patient_id))\nsort(table(exome_rna_tumor_shared$clonotype))\n\nhist((sort(table(exome_rna_tumor_shared$clonotype), decreasing = TRUE)[-1])) # 5 AA one is likely artifact\nggplot(melt(table(exome_rna_tumor_shared$clonotype)), aes(value)) + geom_histogram() + labs(x=\"Number of patients with clonotype\", y=\"Number of clonotypes\") + theme(text=element_text(size=16))\n\n# profile these shared cases\nexome_rna_tumor_shared_patients <- unique(exome_rna_tumor_shared$patient_id)\nexome_rna_tumor_shared_data <- filter(results, patient_uuid %in% exome_rna_tumor_shared_patients)\n\noverall_cohorts <- table(results$cohort)\nshared_cohorts <- table(exome_rna_tumor_shared_data$cohort)\nshared_df <- data.frame(overall_cohorts-shared_cohorts, shared_cohorts)\nshared_df <- filter(shared_df, Freq.1>0)\nshared_df$Var1.1 <- NULL\ncolnames(shared_df) <- c(\"Var1\", \"Non-shared\", \"Shared\")\nshared_df_melt <- melt(shared_df)\n\nggplot(shared_df_melt, aes(x=Var1, y=value, fill=variable)) + geom_bar(stat=\"identity\", position=\"fill\") + labs(x=\"Cohort\", y=\"Fraction\") + theme(axis.text.x = element_text(angle = 90, hjust = 1)) + theme(text=element_text(size=16))\n\n# just blood exome\nblood_pos <- filter(clonotypes, blood > 0)\nblood_exome_cl <- unique(blood_pos$clonotype)\nlength(blood_exome_cl)\nlength(unique(blood_pos$patient_id))\n\nblood_exome_shared_aa <- names(which(table(blood_pos$clonotype)>1))\nexome_blood_shared <- filter(blood_pos, clonotype %in% blood_exome_shared_aa)\nlength(unique(exome_blood_shared$clonotype))\nlength(unique(exome_blood_shared$patient_id))\nsort(table(exome_blood_shared$clonotype))\n\nhist((sort(table(exome_blood_shared$clonotype), decreasing = TRUE))) # 5 AA one is likely artifact\nggplot(melt(table(exome_blood_shared$clonotype)), aes(value)) + geom_histogram() + labs(x=\"Number of patients with clonotype\", y=\"Number of clonotypes\") + theme(text=element_text(size=16))\n\n# tumor exome and blood\ntumor_exome_blood_shared <- intersect(tumor_exome_cl, blood_exome_cl)\nlength(tumor_exome_blood_shared)\n\nexome_blood_tumor_shared <- filter(clonotypes, clonotype %in% tumor_exome_blood_shared)\nlength(unique(exome_blood_tumor_shared$clonotype))\nlength(unique(exome_blood_tumor_shared$patient_id))\nsort(table(exome_blood_tumor_shared$clonotype))\n\nhist((sort(table(exome_blood_tumor_shared$clonotype), decreasing = TRUE)[-1])) # 5 AA one is likely artifact\nggplot(melt(table(exome_blood_tumor_shared$clonotype)), aes(value)) + geom_histogram() + labs(x=\"Number of patients with clonotype\", y=\"Number of clonotypes\") + theme(text=element_text(size=16))\n\n# all three\ntumor_all_shared <- intersect(tumor_exome_blood_shared, tumor_exome_rna_shared)\nlength(tumor_all_shared)\n\nall_shared <- filter(clonotypes, clonotype %in% tumor_all_shared)\nlength(unique(all_shared$clonotype))\nlength(unique(all_shared$patient_id))\nsort(table(all_shared$clonotype))\n\nhist((sort(table(all_shared$clonotype), decreasing = TRUE)[-1])) # 5 AA one is likely artifact\nggplot(melt(table(all_shared$clonotype)), aes(value)) + geom_histogram() + labs(x=\"Number of patients with clonotype\", y=\"Number of clonotypes\") + theme(text=element_text(size=16))\n\n# tumor exome and blood\nblood_pos <- filter(clonotypes, blood > 0)\ntumor_blood_cl <- unique(blood_pos$clonotype)\nlength(tumor_blood_cl)\nlength(unique(blood_pos$patient_id))\n\ntumor_all_shared <- intersect(tumor_exome_cl, tumor_blood_cl)\nlength(tumor_all_shared)\n\nexome_blood_tumor_shared <- filter(clonotypes, clonotype %in% tumor_all_shared)\nlength(unique(exome_blood_tumor_shared$clonotype))\nlength(unique(exome_blood_tumor_shared$patient_id))\nsort(table(exome_blood_tumor_shared$clonotype))\n\n# tumor exome and blood c66 comparison\nclonotype_common <- \"CATSRDTELQCFLLSVHKPHCFPDPGAFS\"\n\n# clonal diversity by cohort\nexome_pos_results <- filter(results, exome_clonotypes>0)\nrna_pos_results <- filter(results, rna_clonotypes>0)\nggplot(exome_pos_results, aes(exome_cdr3, exome_clonotypes, colour=cohort)) + geom_point() + labs(x=\"exome CDR3 reads\", y=\"Number of clonotypes\") + theme(text=element_text(size=16)) + scale_color_viridis(discrete=TRUE)\nggplot(rna_pos_results, aes(rna_cdr3, rna_clonotypes, colour=cohort)) + geom_point() + labs(x=\"RNA CDR3 reads\", y=\"Number of clonotypes\") + theme(text=element_text(size=16)) + scale_color_viridis(discrete=TRUE)\n\nggplot(rna_pos_results, aes(log10(tcrb_rpm), log10(rna_rpm), colour=cohort)) + geom_point() + labs(x=\"TCRB RNA rpm (log10)\", y=\"RNA CDR3 rpm (log10)\") + theme(text=element_text(size=16)) + scale_color_viridis(discrete=TRUE)\nggplot(rna_pos_results, aes(log10(tcrb_reads), log10(rna_cdr3), colour=cohort)) + geom_point() + labs(x=\"TCRB RNA reads (log10)\", y=\"RNA CDR3 reads (log10)\") + theme(text=element_text(size=16)) + scale_color_viridis(discrete=TRUE)\nggplot(rna_pos_results, aes(log10(tcrb_reads), log10(rna_clonotypes), colour=cohort)) + geom_point() + labs(x=\"TCRB RNA reads (log10)\", y=\"RNA CDR3 clonotypes (log10)\") + theme(text=element_text(size=16)) + scale_color_viridis(discrete=TRUE)\n\ncor.test(exome_pos_results$exome_reads, exome_pos_results$exome_clonotypes)\ncor.test(rna_pos_results$tcrb_rpm, rna_pos_results$rna_rpm)\ncor.test(rna_pos_results$tcrb_reads, rna_pos_results$rna_clonotypes)\n\n# dna rna shared poisson statistic\ndna_and_rna_patients <- as.character(filter(results, exome_cdr3 > 0 & rna_cdr3 > 0)$patient_uuid)\ndna_and_rna_clonotypes <- filter(clonotypes, patient_id %in% dna_and_rna_patients)\nlength(unique(dna_and_rna_clonotypes$clonotype))\n\n\n\n",
    "created" : 1470845850290.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1239575799",
    "id" : "DBC50530",
    "lastKnownWriteTime" : 1474345212,
    "last_content_update" : 1474345212110,
    "path" : "~/tcrseq/new/rstudio_plots/clonotypes_analysis.R",
    "project_path" : "clonotypes_analysis.R",
    "properties" : {
    },
    "relative_order" : 8,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}