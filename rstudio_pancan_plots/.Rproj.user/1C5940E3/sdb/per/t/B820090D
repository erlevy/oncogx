{
    "collab_server" : "",
    "contents" : "library(dplyr)\nlibrary(ggplot2)\nlibrary(colorspace)\nlibrary(viridis)\nlibrary(grDevices)\n\nresults <- read.csv(\"/Users/Eric/tcrseq/new/final/pancan_results_8-10-2016.txt\", sep=\"\\t\")\nclonotypes <- read.csv(\"/Users/Eric/tcrseq/new/final/pancan_clonotypes_8-10-2016.txt\", sep=\"\\t\")\n\nclonotypes$clonotype <- as.character(clonotypes$clonotype)\nclonotypes$patient_id <- as.character(clonotypes$patient_id)\nclonotypes$nuc <- as.character(clonotypes$nuc)\n\ncancer_current <- filter(results, cohort != \"THYM\", cohort != \"UVM\", cohort != \"CHOL\",\n                         cohort != \"ACC\", cohort != \"CESC\", cohort != \"DLBC\", cohort != \"ESCA\", \n                         cohort != \"KICH\", cohort != \"LGG\", cohort != \"LIHC\", cohort != \"MESO\",\n                         cohort != \"PCPG\", cohort != \"TGCT\", cohort != \"UCS\")\ncancer_current$cohort <- factor(cancer_current$cohort)\n\nresults <- cancer_current\n\n# clonal diversity by cohort\nexome_pos_results <- filter(results, exome_clonotypes>0)\nrna_pos_results <- filter(results, rna_clonotypes>0)\nggplot(exome_pos_results, aes(exome_cdr3, exome_clonotypes, colour=cohort)) + geom_point() + labs(x=\"Tumor DNA CDR3 reads\", y=\"Number of clonotypes\") + theme(text=element_text(size=16)) + scale_color_viridis(discrete=TRUE)\nggplot(rna_pos_results, aes(rna_cdr3, rna_clonotypes, colour=cohort)) + geom_point() + labs(x=\"Tumor RNA CDR3 reads\", y=\"Number of clonotypes\") + theme(text=element_text(size=16)) + scale_color_viridis(discrete=TRUE)\n\nggplot(rna_pos_results, aes(log10(tcrb_rpm), log10(rna_rpm), colour=cohort)) + geom_point() + labs(x=\"TCRB RNA rpm (log10)\", y=\"RNA CDR3 rpm (log10)\") + theme(text=element_text(size=16)) + scale_color_viridis(discrete=TRUE)\nggplot(rna_pos_results, aes(log10(tcrb_reads), log10(rna_cdr3), colour=cohort)) + geom_point() + labs(x=\"TCRB RNA reads (log10)\", y=\"RNA CDR3 reads (log10)\") + theme(text=element_text(size=16)) + scale_color_viridis(discrete=TRUE)\nggplot(rna_pos_results, aes(log10(tcrb_reads), log10(rna_clonotypes), colour=cohort)) + geom_point() + labs(x=\"TCRB RNA reads (log10)\", y=\"RNA CDR3 clonotypes (log10)\") + theme(text=element_text(size=16)) + scale_color_viridis(discrete=TRUE)\nggplot(rna_pos_results, aes(log10(tcrb_reads), log10(rna_clonotypes/rna_rpm), colour=cohort)) + geom_point() + labs(x=\"TCRB RNA reads (log10)\", y=\"RNA clonal diversity (log10)\") + theme(text=element_text(size=16)) + scale_color_viridis(discrete=TRUE)\n\nexome_rna_pos_results <- filter(results, exome_clonotypes>0, rna_clonotypes>0)\nggplot(exome_rna_pos_results, aes(log10(exome_clonotypes/exome_rpm), log10(rna_clonotypes/rna_rpm), colour=cohort)) + geom_point() + labs(x=\"Exome clonal diversity (log10)\", y=\"RNA clonal diversity (log10)\") + theme(text=element_text(size=16)) + scale_color_viridis(discrete=TRUE)\n\ngrays <- gray.colors(length(unique(exome_rna_pos_results$cohort)))\ngrays[16] <- \"yellow\" # should be STAD\ngrays[18] <- \"red\" # should be UCEC\ngrays[11] <- \"blue\" # should be PAAD\nggplot(exome_rna_pos_results, aes(log10(exome_clonotypes/exome_rpm), log10(rna_clonotypes/rna_rpm), colour=cohort)) + geom_point() + labs(x=\"Exome clonal diversity (log10)\", y=\"RNA clonal diversity (log10)\") + theme(text=element_text(size=16)) + scale_color_manual(values=grays)\n\nshared_id <- unique(filter(clonotypes, rna > 0 & exome > 0)$patient_id)\nshared_id_results <- filter(exome_rna_pos_results, patient_uuid %in% shared_id)\nnon_shared_id_results <- filter(exome_rna_pos_results, !(patient_uuid %in% shared_id))\nshared_id_results$shared <- \"shared\"\nnon_shared_id_results$shared <- \"no shared\"\nshared_annotation_results <- rbind(non_shared_id_results, shared_id_results)\nshared_annotation_results$shared <- factor(shared_annotation_results$shared, levels = c(\"shared\",\"no shared\"))\nshared_annotation_colors <- c(\"red\", \"lightgray\")\nggplot(shared_annotation_results, aes(log10(exome_clonotypes/exome_rpm), log10(rna_clonotypes/rna_rpm), colour=shared)) + geom_point(alpha = 0.9) + labs(x=\"Exome clonal diversity (log10)\", y=\"RNA clonal diversity (log10)\") + theme(text=element_text(size=16)) + scale_color_manual(values=shared_annotation_colors)\n\nggplot(exome_rna_pos_results, aes(log10(exome_reads), exome_clonotypes, colour=cohort)) + geom_point() + labs(x=\"Tumor DNA read count (log10)\", y=\"Tumor DNA clonotypes\") + theme(text=element_text(size=16)) + scale_color_viridis(discrete=TRUE)\nggplot(exome_rna_pos_results, aes(log10(rna_reads), rna_clonotypes, colour=cohort)) + geom_point() + labs(x=\"Tumor RNA read count (log10)\", y=\"Tumor RNA clonotypes\") + theme(text=element_text(size=16)) + scale_color_viridis(discrete=TRUE)\n\ncor.test(exome_pos_results$exome_reads, exome_pos_results$exome_clonotypes)\ncor.test(rna_pos_results$tcrb_rpm, rna_pos_results$rna_rpm)\ncor.test(rna_pos_results$tcrb_reads, rna_pos_results$rna_clonotypes)\n\n# linear regression for # clonotypes by # reads\nmylm <- lm(exome_clonotypes~exome_cdr3, data=exome_pos_results)\nmylm <- lm(rna_clonotypes~rna_cdr3, data=rna_pos_results)\n\n# dna rna shared clonality statistic\nlength(shared_id) # 196 with shared DNA RNA clonotype\nnrow(exome_pos_results) # 2906 with DNA\nnrow(rna_pos_results) # 5699 with RNA\nnrow(filter(cancer_current, exome_cdr3 > 0 & rna_cdr3 > 0)) # 2502 with both\nlength(unique(as.character(filter(clonotypes, exome > 0)$clonotype))) # 5434 exome clonotypes\nlength(unique(as.character(filter(clonotypes, rna > 0)$clonotype))) # 61914 rna clonotypes\n\nexome_rna_both_results <- filter(cancer_current, exome_cdr3 > 0 & rna_cdr3 > 0)\nexome_rna_both_patients <- as.character(exome_rna_both_results$patient_uuid)\nexome_rna_both_clonotypes <- filter(clonotypes, patient_id %in% exome_rna_both_patients)\nlength(unique(as.character(exome_rna_both_clonotypes$clonotype))) # 45996 clonotypes in patients with both exome and rna\nlength(unique(as.character(filter(exome_rna_both_clonotypes, exome > 0)$clonotype))) # 4616 exome clonotypes in patients with both exome and rna\nlength(unique(as.character(filter(exome_rna_both_clonotypes, rna > 0)$clonotype))) # 37859 exome clonotypes in patients with both exome and rna\n\nsummary(exome_rna_both_results$exome_clonotypes) # mean of 2\nsummary(exome_rna_both_results$rna_clonotypes) # mean of 16\n\n# check to make sure shared ones don't have different clonal diversity\nwilcox.test(shared_id_results$exome_clonotypes/shared_id_results$exome_rpm, non_shared_id_results$exome_clonotypes/non_shared_id_results$exome_rpm)\nwilcox.test(shared_id_results$rna_clonotypes/shared_id_results$rna_rpm, non_shared_id_results$rna_clonotypes/non_shared_id_results$rna_rpm)\n\n\n\n",
    "created" : 1472678439532.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2076380024",
    "id" : "B820090D",
    "lastKnownWriteTime" : 1474610652,
    "last_content_update" : 1474610652406,
    "path" : "~/tcrseq/new/rstudio_plots/clonal_diversity.R",
    "project_path" : "clonal_diversity.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 9,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}