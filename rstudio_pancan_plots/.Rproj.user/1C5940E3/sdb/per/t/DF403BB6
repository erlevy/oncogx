{
    "collab_server" : "",
    "contents" : "library(OIsurv)\nlibrary(cgdsr)\nlibrary(cluster)\nlibrary(fpc)\nlibrary(gplots)\nlibrary(heatmap.plus)\nlibrary(reshape2)\nlibrary(dplyr)\nlibrary(ggplot2)\nlibrary(plotrix)\nlibrary(VennDiagram)\nlibrary(ggrepel)\n\n# run clonotypes_analysis.R first\nsource(\"clonotypes_analysis.R\")\n\nresults <- read.csv(\"/Users/Eric/tcrseq/new/final/pancan_results_8-10-2016.txt\", sep=\"\\t\")\nclonotypes <- read.csv(\"/Users/Eric/tcrseq/new/final/pancan_clonotypes_8-10-2016.txt\", sep=\"\\t\")\n\ncdr3_results_current <- results\ncancer_current <- cdr3_results_current\n# remove cohort size <400\n# BLCA, BRCA, COAD, HNSC, KIRC, LGG, LUAD, LUSC, OV, PRAD, STAD, THCA, UCEC\n#cancer_current <- filter(cdr3_results_current, cohort==\"BLCA\" | cohort==\"BRCA\" | cohort==\"COAD\" | cohort==\"HNSC\" |\n#                       cohort==\"KIRC\" | cohort==\"LGG\" | cohort==\"LUAD\" | cohort==\"LUSC\" | cohort==\"OV\" |\n#                       cohort==\"PRAD\" | cohort==\"STAD\" | cohort==\"THCA\" | cohort==\"UCEC\")\n#cancer_current$cohort <- factor(cancer_current$cohort)\n#cancer_split <- split(cancer_current, cancer_current$cohort)\n\n# remove THYM since it only has ONE exome case, UVM and CHOL have no RNA\ncancer_current <- filter(cdr3_results_current, cohort != \"THYM\", cohort != \"UVM\", cohort != \"CHOL\")\ncancer_current$cohort <- factor(cancer_current$cohort)\ncancer_split <- split(cancer_current, cancer_current$cohort)\n\n# exome vs. blood\n# run clonotypes_analysis.R first\nexome_pos <- filter(clonotypes, exome > 0)\nblood_pos <- filter(clonotypes, blood > 0)\n\nexome_only <- filter(clonotypes, exome > 0)\nexome_pos_n <- length(unique(exome_pos$aa))\nblood_pos_n <- length(unique(blood_pos$aa))\nboth_n <- length(unique(intersect(exome_pos$aa, blood_pos$aa)))\n\n# distribution of cohorts with \"sticky\" clonotype\nshared_patients <- exome_blood_shared_patients_only_c66\nshared_patients_results <- filter(cancer_current, patient_uuid %in% shared_patients)\nexome_blood_or_n_patients <- filter(cancer_current, exome_rpm>0 | blood_rpm>0)$patient_uuid\nexome_blood_baseline <- filter(cancer_current, patient_uuid %in% exome_blood_or_n_patients)\nexome_blood_baseline <- mutate(exome_blood_baseline,has_c66=ifelse(patient_uuid %in% shared_patients,\"1\",\"0\"))\nshared_patients_df <- data.frame(table(shared_patients_results$cohort), table(exome_blood_baseline$cohort))\nshared_patients_df <- filter(shared_patients_df, Freq>0)\ncolnames(shared_patients_df)[1] <- \"Cohort\"\nshared_patients_df$Cohort <- factor(shared_patients_df$Cohort)\nshared_patients_df$Freq.2 <- shared_patients_df$Freq/shared_patients_df$Freq.1\n\n### FIGURE: c66 cohort fraction barplot ###\n\nggplot(shared_patients_df, aes(x=reorder(Cohort, -Freq.2), y=Freq.2)) + geom_bar(stat=\"identity\") + labs(x=\"Cohort\", y=\"Fraction of patients\") + theme(axis.text.x = element_text(angle = 90, hjust = 1)) + theme(text=element_text(size=16))\n\n### FIGURE: c66 cohort fraction barplot by gender\nshared_patients_gender_df <- data.frame(table(shared_patients_results$cohort, shared_patients_results$gender))\nshared_patients_gender_df <- filter(shared_patients_gender_df, Freq>0)\nggplot(shared_patients_gender_df, aes(x=reorder(Var1, -Freq), y=Freq, fill=Var2)) + geom_bar(stat=\"identity\") + labs(x=\"Cohort\", y=\"Number of patients\") + theme(axis.text.x = element_text(angle = 90, hjust = 1)) + theme(text=element_text(size=16))\n\n# distribution of cohorts without \"sticky\" clonotype\nnon_shared_patients <- exome_blood_shared_patients_no_c66\nnon_shared_patients_results <- filter(cancer_current, patient_uuid %in% non_shared_patients)\nnon_shared_patients_df <- data.frame(table(non_shared_patients_results$cohort), table(exome_blood_baseline$cohort))\nnon_shared_patients_df <- filter(non_shared_patients_df, Freq>0)\ncolnames(non_shared_patients_df)[1] <- \"Cohort\"\nnon_shared_patients_df$Cohort <- factor(non_shared_patients_df$Cohort)\nnon_shared_patients_df$Freq.2 <- non_shared_patients_df$Freq/non_shared_patients_df$Freq.1\n\n### FIGURE: non c66 cohort fraction barplot ###\nggplot(non_shared_patients_df, aes(x=reorder(Cohort, -Freq.2), y=Freq.2)) + geom_bar(stat=\"identity\") + labs(x=\"Cohort\", y=\"Fraction of patients\") + theme(axis.text.x = element_text(angle = 90, hjust = 1)) + theme(text=element_text(size=16))\n\n### FIGURE: non c66 cohort fraction barplot by gender\nnon_shared_patients_gender_df <- data.frame(table(non_shared_patients_results$cohort, non_shared_patients_results$gender))\nnon_shared_patients_gender_df <- filter(non_shared_patients_gender_df, Freq>0)\nggplot(non_shared_patients_gender_df, aes(x=reorder(Var1, -Freq), y=Freq, fill=Var2)) + geom_bar(stat=\"identity\") + labs(x=\"Cohort\", y=\"Number of patients\") + theme(axis.text.x = element_text(angle = 90, hjust = 1)) + theme(text=element_text(size=16))\n\n# profile gender with c66\nshared_patients_gender_df <- data.frame(table(shared_patients_results$gender), table(exome_blood_baseline$gender)-table(shared_patients_results$gender))\nshared_patients_gender_table <- matrix(c(shared_patients_gender_df[1,2], shared_patients_gender_df[1,4],\n                                         shared_patients_gender_df[2,2], shared_patients_gender_df[2,4]),\n                                       nrow=2, byrow=TRUE)\nnon_shared_patients_gender_df <- data.frame(table(non_shared_patients_results$gender), table(exome_blood_baseline$gender)-table(non_shared_patients_results$gender))\nnon_shared_patients_gender_table <- matrix(c(non_shared_patients_gender_df[1,2], non_shared_patients_gender_df[1,4],\n                                             non_shared_patients_gender_df[2,2], non_shared_patients_gender_df[2,4]), nrow=2, byrow=TRUE)\n\npublic_clonotypes_results <- filter(cancer_current, as.character(patient_uuid) %in% public_patients)\nexome_rna_blood_or_n_patients <- filter(cancer_current, !is.na(rna_rpm) | !is.na(exome_rpm) | !is.na(blood_rpm))$patient_uuid\npublic_clonotypes_baseline <- filter(cancer_current, patient_uuid %in% exome_rna_blood_or_n_patients)\ntable(public_clonotypes_results$cohort)\n\n# coverage vs c66\nexome_blood_non_c66 <- filter(cancer_current, patient_uuid %in% exome_or_blood_patients)\nexome_blood_non_c66 <- filter(exome_blood_non_c66, !(patient_uuid %in% exome_blood_shared_patients_only_c66))\nt.test(shared_patients_results$exome_reads, exome_blood_non_c66$exome_reads)\nt.test(shared_patients_results$blood_reads, exome_blood_non_c66$blood_reads)\n\nexome_blood_non_public <- filter(cancer_current, patient_uuid %in% exome_or_blood_patients)\nexome_blood_non_public <- filter(exome_blood_non_public, !(patient_uuid %in% exome_blood_shared_patients_no_c66))\nt.test(shared_patients_results$exome_reads, exome_blood_non_public$exome_reads)\nt.test(shared_patients_results$blood_reads, exome_blood_non_public$blood_reads)\n\nshared_df <- data.frame(reads=log10(shared_patients_results$exome_reads), group=rep(\"Shared\", length(shared_patients_results$exome_reads)))\nnon_shared_df <- data.frame(reads=log10(exome_blood_non_public$exome_reads), group=rep(\"Non-Shared\", length(exome_blood_non_public$exome_reads)))\nread_comparison_df <- rbind(shared_df, non_shared_df)\nggplot(read_comparison_df, aes(x=group, y=reads)) + geom_boxplot() + labs(x=\"Shared clonotype group\", y=\"Number of tumor DNA reads (log10)\")+ theme(text=element_text(size=16))\n\nshared_df <- data.frame(reads=log10(shared_patients_results$blood_reads), group=rep(\"Shared\", length(shared_patients_results$blood_reads)))\nnon_shared_df <- data.frame(reads=log10(exome_blood_non_public$blood_reads), group=rep(\"Non-Shared\", length(exome_blood_non_public$blood_reads)))\nread_comparison_df <- rbind(shared_df, non_shared_df)\nggplot(read_comparison_df, aes(x=group, y=reads)) + geom_boxplot() + labs(x=\"Shared clonotype group\", y=\"Number of blood DNA reads (log10)\")+ theme(text=element_text(size=16))\n\n### new stuff\n\n# correlation between diversity in blood and tumor exome?\ntumor_blood_exome_pos <- filter(results, blood_clonotypes > 0 & exome_clonotypes > 0)\n# only cases with >0 clonotypes in both tumor and blood\nblood_clonotype_diversity <- tumor_blood_exome_pos$blood_clonotypes/tumor_blood_exome_pos$blood_cdr3\ntumor_exome_clonotype_diversity <- tumor_blood_exome_pos$exome_clonotypes/tumor_blood_exome_pos$exome_cdr3\n\n",
    "created" : 1470937772085.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "250085266",
    "id" : "DF403BB6",
    "lastKnownWriteTime" : 1475775982,
    "last_content_update" : 1475775982018,
    "path" : "~/tcrseq/new/rstudio_plots/tumor_blood_clonotypes.R",
    "project_path" : "tumor_blood_clonotypes.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 7,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}