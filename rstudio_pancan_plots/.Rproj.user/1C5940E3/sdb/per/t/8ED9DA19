{
    "collab_server" : "",
    "contents" : "library(OIsurv)\nlibrary(cgdsr)\nlibrary(cluster)\nlibrary(fpc)\nlibrary(gplots)\nlibrary(heatmap.plus)\nlibrary(reshape2)\nlibrary(dplyr)\nlibrary(ggplot2)\nlibrary(plotrix)\nlibrary(VennDiagram)\nlibrary(ggrepel)\nlibrary(PredictABEL)\n\nresults <- read.csv(\"/Users/Eric/tcrseq/new/final/pancan_results_8-28-2016.txt\", sep=\"\\t\")\nclonotypes <- read.csv(\"/Users/Eric/tcrseq/new/final/pancan_clonotypes_8-10-2016.txt\", sep=\"\\t\")\n\n# add in LUMP score\n### purity\npurity <- read.csv(\"/Users/Eric/tcrseq/new/purity/pancancer_purity_butte.txt\", sep=\"\\t\")\n\n# process purity matrix\npurity <- as.matrix(purity)\nrownames(purity) <- purity[,1]\npurity <- purity[,-1]\n\n# match samples\npatient_purity <- c()\ndata_list <- c(\"LUMP\")\nfor (i in 1:nrow(results))\n{\n  sample_id <- substr(as.character(results$sample_barcode[i]),1,16)\n  matching <- which(rownames(purity)==sample_id)\n  if (length(matching)>0)\n  {\n    matching_purity <- purity[matching, data_list]\n  }\n  else\n  {\n    matching_purity <- rep(NA, length(data_list))\n  }\n  patient_purity <- rbind(patient_purity, matching_purity)\n}\nrownames(patient_purity) <- seq(1,nrow(patient_purity))\nmode(patient_purity) <- 'numeric'\nlump_score <- patient_purity\nresults <- cbind(results, lump_score)\nresults$lump_score <- as.numeric(as.character(results$lump_score))\n\ncdr3_results_current <- results\ncancer_current <- cdr3_results_current\n\n#cancer_current <- filter(cdr3_results_current, cohort != \"DLBC\")\n\n#cancer_current <- filter(cdr3_results_current, cohort != \"ACC\", cohort != \"CHOL\",\n#                         cohort != \"DLBC\", cohort != \"KICH\", cohort != \"TGCT\", cohort != \"THYM\")\n\ncancer_current <- filter(cdr3_results_current, cohort != \"THYM\", cohort != \"UVM\", cohort != \"CHOL\",\n                         cohort != \"ACC\", cohort != \"CESC\", cohort != \"DLBC\", cohort != \"ESCA\", \n                         cohort != \"KICH\", cohort != \"LIHC\", cohort != \"MESO\",\n                         cohort != \"PCPG\", cohort != \"TGCT\", cohort != \"UCS\")\n\ncancer_current$cohort <- factor(cancer_current$cohort)\ncancer_current<-mutate(cancer_current,gsva_lowhigh=ifelse(gsva_cluster==1 | gsva_cluster==4,\"1\",\"0\"))\ncancer_current<-mutate(cancer_current,blood_level=ifelse(blood_rpm<median(cancer_current$blood_rpm, na.rm=TRUE),\"0\",\"1\"))\n\ntmp<-select(filter(cancer_current,blood_rpm!=0),patient_uuid,blood_rpm)\ntmp<-mutate(tmp,iDNA_blood_score=ntile(blood_rpm,10))\ncancer_current<-left_join(cancer_current,tmp)\ncancer_current<-mutate(cancer_current,iDNA_blood_score=ifelse(is.na(iDNA_blood_score),0,iDNA_blood_score))\n\ntmp<-select(filter(cancer_current,rate_non!=0),patient_uuid,rate_non)\ntmp<-mutate(tmp,nonsyn_score=ntile(rate_non,10))\ncancer_current<-left_join(cancer_current,tmp)\ncancer_current<-mutate(cancer_current,nonsyn_score=ifelse(is.na(nonsyn_score),0,nonsyn_score))\n\n# CDR3 nonzero logistic regression\ncancer_current$gsva_cluster <- factor(cancer_current$gsva_cluster)\ncancer_current <- within(cancer_current, cohort <- relevel(cohort, ref=\"LGG\"))\nmylogit <- glm(exome_level ~ cohort + days_to_birth + gender + gsva_cluster + patient_purity + rna_rpm + \n                 blood_rpm + tcrb_rpm + exome_reads, data = cancer_current, family = \"binomial\")\n\n# CDR3 nonzero linear regression\nmylm <- lm(exome_rpm ~ cohort + days_to_birth + gender + gsva_cluster + patient_purity + rna_rpm + \n                 blood_rpm + tcrb_rpm, data = cancer_current)\n\n# GSVA lowhigh logistic regression\ncancer_current$gsva_lowhigh <- factor(cancer_current$gsva_lowhigh)\ncancer_current <- within(cancer_current, cohort <- relevel(cohort, ref=\"LGG\"))\nmylogit <- glm(gsva_lowhigh ~ cohort + days_to_birth + gender + blood_rpm,\n               data = cancer_current, family = \"binomial\")\n\n# Lump score linear regression\ncancer_current$gsva_lowhigh <- factor(cancer_current$gsva_lowhigh)\ncancer_current <- within(cancer_current, cohort <- relevel(cohort, ref=\"LGG\"))\nmylm <- lm(lump_score ~ cohort + days_to_birth + gender +blood_rpm,\n           data = cancer_current)\n\n### gsva low/high stepwise building\n# start with non-cohort factors\ncancer_current$gsva_lowhigh <- factor(cancer_current$gsva_lowhigh)\ncancer_current <- within(cancer_current, cohort <- relevel(cohort, ref=\"LGG\"))\ncancer_current$age <- cancer_current$days_to_birth/-365\nmylogit <- glm(gsva_lowhigh ~ age + gender + iDNA_blood_score,\n               data = cancer_current, family = \"binomial\")\n# age and gender significant\nmylogit <- glm(gsva_lowhigh ~ age + gender + iDNA_blood_score + nonsyn_score,\n               data = cancer_current, family = \"binomial\")\n# age significant (with burden)\nmylogit <- glm(gsva_lowhigh ~ age + gender + iDNA_blood_score + nonsyn_score + cohort,\n               data = cancer_current, family = \"binomial\")\n#write.table(round(exp(mylogit$coefficients),4), \"block_3.txt\", quote=FALSE, sep=\"\\t\")\n# significant in age and burden, still none in blood\n# pick top cohorts: BRCA, CESC, HNSC, KIRC, KIRP, LUAD, LUSC, OV, PRAD, STAD, TGCT\n#cancer_reduced <- filter(cancer_current, cohort %in% c(\"BRCA\", \"CESC\", \"HNSC\", \"KIRC\", \"KIRP\",\"LUAD\", \"LUSC\", \"OV\", \"PRAD\", \"STAD\", \"TGCT\"))\ncancer_reduced <- cancer_current\nmylogit <- glm(gsva_lowhigh ~ age + gender + nonsyn_score + iDNA_blood_score*cohort,\n               data = cancer_reduced, family = \"binomial\")\n#write.table(round(exp(mylogit$coefficients),4), \"block_4.txt\", quote=FALSE, sep=\"\\t\")\n# gender becomes significant, burden not, blood:CESC interaction significant (BRCA if only do interactions)\n# also blood with LUSC and STAD\n\n### lump score stepwise building\n# start with non-cohort factors\ncancer_current$gsva_lowhigh <- factor(cancer_current$gsva_lowhigh)\ncancer_current <- within(cancer_current, cohort <- relevel(cohort, ref=\"LGG\"))\nmylm <- lm(lump_score ~ days_to_birth + gender + blood_rpm + rate_non,\n               data = cancer_current)\n# age, blood, and burden significant, not gender\nmylm <- lm(lump_score ~ days_to_birth + gender + blood_rpm + rate_non + cohort,\n           data = cancer_current)\n# loses significance in age and blood, still in burden\n# all cohorts significant except: KICH, PRAD\ncancer_reduced <- filter(cancer_current, !(cohort %in% c(\"KICH\", \"PRAD\")))\nmylm <- lm(lump_score ~ days_to_birth + gender + rate_non + blood_rpm*cohort,\n           data = cancer_reduced)\n# burden still significant, all cohorts, LIHC:blood interaction\n\n\n# gender becomes significant, blood:CESC interaction significant (BRCA if only do interactions)",
    "created" : 1471036471758.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "542258545",
    "id" : "8ED9DA19",
    "lastKnownWriteTime" : 1474243212,
    "last_content_update" : 1474243212471,
    "path" : "~/tcrseq/new/rstudio_plots/predictive_models.R",
    "project_path" : "predictive_models.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}