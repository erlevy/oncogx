summary(cancer_split$LUAD$exome_rpm)
summary(cancer_split$HNSC$exome_rpm)
summary(cancer_split$GBM$exome_rpm)
summary(cancer_split$COAD$exome_rpm)
source('~/tcrseq/new/rstudio_plots/gsva_correlation.R')
source('~/tcrseq/new/rstudio_plots/gsva_correlation.R')
cancer_heatmap[1,]
ov <- filter(cancer_heatmap, cohort="OV")
ov <- filter(cancer_heatmap, cohort=="OV")
ov[1,]
library(OIsurv)
library(cgdsr)
library(cluster)
library(fpc)
library(gplots)
library(heatmap.plus)
library(reshape2)
library(dplyr)
library(ggplot2)
library(plotrix)
library(VennDiagram)
library(ggrepel)
results <- read.csv("/Users/Eric/tcrseq/new/final/pancan_results_8-10-2016.txt", sep="\t")
clonotypes <- read.csv("/Users/Eric/tcrseq/new/final/pancan_clonotypes_8-10-2016.txt", sep="\t")
cdr3_results_current <- results
cancer_current <- cdr3_results_current
# remove cohort size <400
# BLCA, BRCA, COAD, HNSC, KIRC, LGG, LUAD, LUSC, OV, PRAD, STAD, THCA, UCEC
#cancer_current <- filter(cdr3_results_current, cohort=="BLCA" | cohort=="BRCA" | cohort=="COAD" | cohort=="HNSC" |
#                       cohort=="KIRC" | cohort=="LGG" | cohort=="LUAD" | cohort=="LUSC" | cohort=="OV" |
#                       cohort=="PRAD" | cohort=="STAD" | cohort=="THCA" | cohort=="UCEC")
#cancer_current$cohort <- factor(cancer_current$cohort)
#cancer_split <- split(cancer_current, cancer_current$cohort)
# remove THYM since it only has ONE exome case, UVM and CHOL have no RNA
cancer_current <- filter(cdr3_results_current, cohort != "THYM", cohort != "UVM", cohort != "CHOL")
cancer_current$cohort <- factor(cancer_current$cohort)
cancer_split <- split(cancer_current, cancer_current$cohort)
# gsva table
#gsva_table <- sapply(gsva_cluster_split, table)
#gsva_percent <- prop.table(gsva_table, 2)
#barplot(gsva_percent) #, col=c("darkblue", "red"), legend=c("ifng low", "ifng high"), ylab="Percent high/low")
#gsva_table_df <- melt(gsva_table)
#ggplot(gsva_table_df, aes(x=Var2, y=value, fill=Var1)) + geom_bar(stat="identity", position="fill") + labs(title="Fraction of patients by GSVA immune signature groupings", x="Cohort", y="Fraction") + theme(axis.text.x = element_text(angle = 90, hjust = 1))
# gsva facet plots
cancer_heatmap <- cancer_current[!is.na(cancer_current$T.regs),]
cancer_heatmap$gsva_annotated <- as.character(cancer_heatmap$gsva_cluster)
cancer_heatmap<-mutate(cancer_heatmap,gsva_annotated=ifelse(gsva_annotated=="1","High",as.character(gsva_annotated)))
cancer_heatmap<-mutate(cancer_heatmap,gsva_annotated=ifelse(gsva_annotated=="2","Low",as.character(gsva_annotated)))
cancer_heatmap<-mutate(cancer_heatmap,gsva_annotated=ifelse(gsva_annotated=="3","Mixed_Innate",as.character(gsva_annotated)))
cancer_heatmap<-mutate(cancer_heatmap,gsva_annotated=ifelse(gsva_annotated=="4","Mixed_Adaptive",as.character(gsva_annotated)))
ov <- filter(cancer_heatmap, cohort=="OV")
ov[1,]
ov_gsva <- split(ov, ov$gsva_annotated)
t.test(ov_gsva$High$exome_rpm, ov_gsva$Low$exome_rpm)
t.test(c(ov_gsva$High$exome_rpm, ov_gsva$Mixed_Adaptive$exome_rpm), c(ov_gsva$Low$exome_rpm, ov_gsva$Mixed_Innate$exome_rpm))
t.test(ov_gsva$Low$exome_rpm, ov_gsva$Mixed_Innate$exome_rpm)
t.test(ov_gsva$Mixed_Innate$exome_rpm, ov_gsva$Mixed_Adaptive$exome_rpm)
t.test(ov_gsva$Mixed_Adaptive$exome_rpm, ov_gsva$High$exome_rpm)
cor.test(ov$exome_rpm, ov$gsva_cluster)
cor.test(ov$exome_rpm, ov$gsva_annotated)
plot(ov$gsva_cluster, ov$exome_rpm)
t.test(ov_gsva$Low, ov_gsva$High)
t.test(ov_gsva$Low$exome_rpm, ov_gsva$High$exome_rpm)
summary(ov_gsva$Low$exome_rpm)
summary(ov_gsva$High$exome_rpm)
ov <- filter(cancer_heatmap, cohort=="OV" & exome_cdr3 > 0)
ov_gsva <- split(ov, ov$gsva_annotated)
cor.test(ov$exome_rpm, ov$gsva_cluster)
nrow(ov)
nrow(ov_gsva)
table(ov$gsva_cluster)
ov <- filter(cancer_heatmap, cohort=="OV")
table(ov$gsva_cluster)
ov <- filter(cancer_heatmap, cohort=="OV")
ov_gsva <- split(ov, ov$gsva_annotated)
t.test(ov_gsva$Low$exome_rpm, ov_gsva$High$exome_rpm)
source('~/tcrseq/new/rstudio_plots/clonal_diversity.R')
mylm <- lm(exome_clonotypes~exome_cdr3, data=exome_pos_results)
summary(mylm)
exome_pos_results[1,]
summary(lm(exome_clonotypes~exome_cdr3, data=results))
mylm <- lm(exome_clonotypes~0 + exome_cdr3, data=exome_pos_results)
summary(mylm)
summary(lm(exome_clonotypes~0 + exome_cdr3, data=results))
summary(exome_pos_results$exome_cdr3-exome_pos_results$exome_clonotypes)
mylm <- lm(exome_clonotypes~exome_cdr3, data=exome_pos_results)
plot(mylm)
plot(exome_pos_results$exome_cdr3, exome_pos_results$exome_clonotypes)
mylm <- lm(exome_clonotypes-1~exome_cdr3-1, data=exome_pos_results)
summary(mylm)
plot(rna_pos_results$rna_cdr3, rna_pos_results$rna_clonotypes)
mylm <- lm(exome_clonotypes~exome_cdr3, data=exome_pos_results)
summary(mylm)
predict(mylm, 1)
predict.lm(mylm, 1)
predict.lm(mylm, exome_cdr3=1)
predict.lm(mylm)
mylm <- lm(exome_clonotypes~exome_cdr3, data=exome_pos_results)
summary(mylm)
predict(mylm)
predict(mylm, indterval="prediction")
lm.predict(mylm, exome_cdr3=1)
predict.lm(mylm, exome_cdr3=1)
predict.lm(mylm, exome_cdr3=c(1))
predict.lm(mylm, data.frame(exome_cdr3=c(1,2))
)
predict.lm(mylm, data.frame(exome_cdr3=c(1,2)))
predict.lm(mylm, data.frame(exome_cdr3=c(1:25)))
summary(mylm)
1/0.58
predict.lm(mylm, data.frame(exome_cdr3=c(1, 2.724)))
predict.lm(mylm, data.frame(exome_cdr3=c(1, 1.724138)))
predict.lm(mylm, data.frame(exome_cdr3=c(1, 2.724138)))
1/0.57692
predict.lm(mylm, data.frame(exome_cdr3=c(1, 1.733343)))
predict.lm(mylm, data.frame(exome_cdr3=c(1, 2.733343)))
mylm <- lm(rna_clonotypes~rna_cdr3, data=rna_pos_results)
summary(mylm)
1/0.47599
10^-1
log10(-1)
log10(1)
log10(10)
summary(results$exome_cdr3)
summary(results$blood_cdr3)
summary(results$blood_rpm)/summary(results$exome_rpm)
summary(results$blood_rpm)
1/8
20/100
source('~/tcrseq/new/rstudio_plots/dna_rna_infiltration.R')
exome_n
grid.newpage()
draw.triple.venn(area1 = exome_n, area2 = rna_n, area3 = blood_n,
n12 = exome_rna_n, n23 = blood_rna_n, n13 = exome_blood_n,
n123 = exome_rna_blood_n, fill = c("skyblue", "orange", "green"),
category = c("Tumor exome", "Tumor RNA", "Blood exome"), cex=2, cat.cex=2,
cat.pos=c(-10,10,180), cat.dist=c(0.05, 0.05, 0.05))
results[1]
results[1,]
length(unique(results$cohort))
length(unique(cancer_current$cohort))
nrow(cancer_current)
7109/10084
nrow(exome_pos)/nrow(exome_n)
nrow(eoxme_pos)
nrow(exome_pos)
nrow(exome_an)
nrow(exome_n)
exome_n[1,]
exome_n
nrow(exome_pos)/exome_n
nrow(rna_pos)/rna_n
nrow(blood_pos)/blood_n
summary(exome_pos$exome_cdr3)
exome_pos_rna_neg <- filter(cancer_current,D=="D+",R=="R-")
exome_pos_rna_pos <- filter(cancer_current,D=="D+",R=="R+")
nrow(exome_pos_rna_neg)
nrow(exome_pos_rna_pos)
exome_n
nrow(exome_pos)
rna_pos
nrow(rna_pos)
rna_n
ggplot(cohort_sizes, aes(x=reorder(Var1, -Freq), y=Freq)) + geom_bar(stat="identity") + labs(x="Cohort", y="Number of patients") + theme(axis.text.x = element_text(angle = 90, hjust = 1)) + theme(text=element_text(size=16))
nrow(cancer_current)
source('~/tcrseq/new/rstudio_plots/gsva_correlation.R')
ggplot(cancer_heatmap, aes(x=gsva_annotated, y=log(exome_rpm,10))) + geom_boxplot() + labs(x="", y="Normalized tumor DNA CDR3 fraction (log10)") + facet_wrap(~cohort, ncol=3) + theme(axis.text.x = element_text(angle = 90, hjust = 1)) + theme(text=element_text(size=14))
library(OIsurv)
library(cgdsr)
library(cluster)
library(fpc)
library(gplots)
library(heatmap.plus)
library(reshape2)
library(dplyr)
library(ggplot2)
library(plotrix)
library(VennDiagram)
library(ggrepel)
results <- read.csv("/Users/Eric/tcrseq/new/final/pancan_results_8-10-2016.txt", sep="\t")
clonotypes <- read.csv("/Users/Eric/tcrseq/new/final/pancan_clonotypes_8-10-2016.txt", sep="\t")
cdr3_results_current <- results
cancer_current <- cdr3_results_current
# remove cohort size <400
# BLCA, BRCA, COAD, HNSC, KIRC, LGG, LUAD, LUSC, OV, PRAD, STAD, THCA, UCEC
#cancer_current <- filter(cdr3_results_current, cohort=="BLCA" | cohort=="BRCA" | cohort=="COAD" | cohort=="HNSC" |
#                       cohort=="KIRC" | cohort=="LGG" | cohort=="LUAD" | cohort=="LUSC" | cohort=="OV" |
#                       cohort=="PRAD" | cohort=="STAD" | cohort=="THCA" | cohort=="UCEC")
#cancer_current$cohort <- factor(cancer_current$cohort)
#cancer_split <- split(cancer_current, cancer_current$cohort)
# remove THYM since it only has ONE exome case, UVM and CHOL have no RNA
cancer_current <- filter(cdr3_results_current, cohort != "THYM", cohort != "UVM", cohort != "CHOL")
cancer_current$cohort <- factor(cancer_current$cohort)
cancer_split <- split(cancer_current, cancer_current$cohort)
# gsva table
#gsva_table <- sapply(gsva_cluster_split, table)
#gsva_percent <- prop.table(gsva_table, 2)
#barplot(gsva_percent) #, col=c("darkblue", "red"), legend=c("ifng low", "ifng high"), ylab="Percent high/low")
#gsva_table_df <- melt(gsva_table)
#ggplot(gsva_table_df, aes(x=Var2, y=value, fill=Var1)) + geom_bar(stat="identity", position="fill") + labs(title="Fraction of patients by GSVA immune signature groupings", x="Cohort", y="Fraction") + theme(axis.text.x = element_text(angle = 90, hjust = 1))
# gsva facet plots
cancer_heatmap <- cancer_current[!is.na(cancer_current$T.regs),]
cancer_heatmap$gsva_annotated <- as.character(cancer_heatmap$gsva_cluster)
cancer_heatmap<-mutate(cancer_heatmap,gsva_annotated=ifelse(gsva_annotated=="1","High",as.character(gsva_annotated)))
cancer_heatmap<-mutate(cancer_heatmap,gsva_annotated=ifelse(gsva_annotated=="2","Low",as.character(gsva_annotated)))
cancer_heatmap<-mutate(cancer_heatmap,gsva_annotated=ifelse(gsva_annotated=="3","Mixed_Innate",as.character(gsva_annotated)))
cancer_heatmap<-mutate(cancer_heatmap,gsva_annotated=ifelse(gsva_annotated=="4","Mixed_Adaptive",as.character(gsva_annotated)))
# to exclude: ACC, COAD, DLBC, KICH, READ, TGCT
# most interesting ones: BLCA, BRCA, CESC, HNSC, LUAD, LUSC, OV, PAAD, STAD
cancer_heatmap$gsva_annotated <- factor(cancer_heatmap$gsva_annotated, levels=c("Low", "Mixed_Innate", "Mixed_Adaptive", "High"))
cancer_heatmap <- filter(cancer_heatmap, cohort == "BLCA" | cohort == "BRCA" | cohort == "CESC" |
cohort == "HNSC" | cohort == "LUAD" | cohort == "LUSC" |
cohort == "OV" | cohort == "PAAD" | cohort == "STAD")
ggplot(cancer_heatmap, aes(x=gsva_annotated, y=log(exome_rpm,10))) + geom_boxplot() + labs(x="", y="Normalized tumor DNA CDR3 fraction (log10)") + facet_wrap(~cohort, ncol=3) + theme(axis.text.x = element_text(angle = 90, hjust = 1)) + theme(text=element_text(size=14))
ov <- filter(cancer_heatmap, cohort=="OV")
ov_gsva <- split(ov, ov$gsva_annotated)
summary(ov_gsva$Low$exome_cdr3)
summary(ov_gsva$High$exome_cdr3)
summary(ov_gsva$Low$exome_rpm)
summary(ov_gsva$High$exome_rpm)
log10(0)
cancer_heatmap$gsva_annotated <- factor(cancer_heatmap$gsva_annotated, levels=c("Low", "Mixed_Innate", "Mixed_Adaptive", "High"))
cancer_heatmap[1,]
lapply(split(cancer_heatmap, cancer_heatmap$cohort*cancer_heatmap$gsva_annotated), nrow)
lapply(split(cancer_heatmap, cancer_heatmap$cohort:cancer_heatmap$gsva_annotated), nrow)
# check OV trend
ov <- filter(cancer_heatmap, cohort=="OV")
ov_gsva <- split(ov, ov$gsva_annotated)
t.test(ov_gsva$Low$exome_rpm, ov_gsva$High$exome_rpm)
# check OV trend
ov <- filter(cancer_heatmap, cohort=="OV")
ov_gsva <- split(ov, ov$gsva_annotated)
t.test(ov_gsva$Low$exome_rpm, ov_gsva$High$exome_rpm, alternative = "less")
# check OV trend
ov <- filter(cancer_heatmap, cohort=="OV")
ov_gsva <- split(ov, ov$gsva_annotated)
t.test(ov_gsva$Low$exome_rpm, ov_gsva$High$exome_rpm, alternative = "greater")
# check OV trend
ov <- filter(cancer_heatmap, cohort=="OV")
ov_gsva <- split(ov, ov$gsva_annotated)
t.test(ov_gsva$Low$exome_rpm, ov_gsva$High$exome_rpm, alternative = "less")
ggplot(cancer_heatmap, aes(x=gsva_annotated, y=log(rna_rpm,10))) + geom_boxplot() + labs(x="", y="Normalized tumor RNA CDR3 fraction (log10)") + facet_wrap(~cohort, ncol=3) + theme(axis.text.x = element_text(angle = 90, hjust = 1)) + theme(text=element_text(size=14))
source('~/tcrseq/new/rstudio_plots/clonal_diversity.R')
ggplot(exome_rna_pos_results, aes(log10(exome_clonotypes/exome_rpm), log10(rna_clonotypes/rna_rpm), colour=cohort)) + geom_point() + labs(x="Exome clonal diversity (log10)", y="RNA clonal diversity (log10)") + theme(text=element_text(size=16)) + scale_color_viridis(discrete=TRUE)
library(grDevices)
gray_colors(10)
grey.colors(1)
grey.colors(10)
length(unique(exome_rna_pos_results$cohort))
grays <- grey_colors(length(unique(exome_rna_pos_results$cohort)))
grays <- grey.colors(length(unique(exome_rna_pos_results$cohort)))
grays <- gray.colors(length(unique(exome_rna_pos_results$cohort)))
grays[1]
unique(exome_rna_pos_results$cohort)
ggplot(exome_rna_pos_results, aes(log10(exome_clonotypes/exome_rpm), log10(rna_clonotypes/rna_rpm), colour=cohort)) + geom_point() + labs(x="Exome clonal diversity (log10)", y="RNA clonal diversity (log10)") + theme(text=element_text(size=16)) + scale_color_manual(values=grays)
sort(unique(exome_rna_pos_results$cohort))
grays <- gray.colors(length(unique(exome_rna_pos_results$cohort)))
grays[3] <- "red" # should be COAD
grays[18] <- "blue" # should be UCEC
grays[11] <- "yellow" # should be PAAD
ggplot(exome_rna_pos_results, aes(log10(exome_clonotypes/exome_rpm), log10(rna_clonotypes/rna_rpm), colour=cohort)) + geom_point() + labs(x="Exome clonal diversity (log10)", y="RNA clonal diversity (log10)") + theme(text=element_text(size=16)) + scale_color_manual(values=grays)
grays <- gray.colors(length(unique(exome_rna_pos_results$cohort)))
grays[3] <- "red" # should be COAD
grays[18] <- "yellow" # should be UCEC
grays[11] <- "blue" # should be PAAD
ggplot(exome_rna_pos_results, aes(log10(exome_clonotypes/exome_rpm), log10(rna_clonotypes/rna_rpm), colour=cohort)) + geom_point() + labs(x="Exome clonal diversity (log10)", y="RNA clonal diversity (log10)") + theme(text=element_text(size=16)) + scale_color_manual(values=grays)
grays <- gray.colors(length(unique(exome_rna_pos_results$cohort)))
grays[16] <- "yellow" # should be STAD
grays[18] <- "red" # should be UCEC
grays[11] <- "blue" # should be PAAD
ggplot(exome_rna_pos_results, aes(log10(exome_clonotypes/exome_rpm), log10(rna_clonotypes/rna_rpm), colour=cohort)) + geom_point() + labs(x="Exome clonal diversity (log10)", y="RNA clonal diversity (log10)") + theme(text=element_text(size=16)) + scale_color_manual(values=grays)
clonotypes[1,]
shared_id <- filter(clonotypes, rna > 0 & blood > 0)$patient_id
share_id[1,]
length(shared_id)
shared_id <- filter(clonotypes, rna > 0 & exome > 0)$patient_id
length(shared_id)
shared_id <- unique(filter(clonotypes, rna > 0 & exome > 0)$patient_id)
length(shared_id)
shared_id
shared_id <- unique(filter(clonotypes, rna > 0 & exome > 0)$patient_id)
shared_id_results <- filter(exome_rna_pos_results, patient_uuid %in% shared_id)
non_shared_id_results <- filter(exome_rna_pos_results, !(patient_uuid %in% shared_id))
shared_id_results$shared_group <- 1
shared_id_results[1,]
shared_id_results[2,]
shared_id <- unique(filter(clonotypes, rna > 0 & exome > 0)$patient_id)
shared_id_results <- filter(exome_rna_pos_results, patient_uuid %in% shared_id)
non_shared_id_results <- filter(exome_rna_pos_results, !(patient_uuid %in% shared_id))
shared_id_results$shared_group <- 1
non_shared_id_results$shared_group <- 0
shared_annotation_results <- cbind(shared_id_results, non_shared_id_results)
shared_annotation_results <- rbind(shared_id_results, non_shared_id_results)
shared_anntation_results[1,]
shared_annotation_results[1,]
nrow(shared_annotation_results)
ggplot(shared_annotation_results, aes(log10(exome_clonotypes/exome_rpm), log10(rna_clonotypes/rna_rpm), colour=shared_group)) + geom_point() + labs(x="Exome clonal diversity (log10)", y="RNA clonal diversity (log10)") + theme(text=element_text(size=16)) + scale_color_manual(values=shared_annotation_colors)
shared_annotation_results <- rbind(shared_id_results, non_shared_id_results)
shared_annotation_colors <- c("gray", "red")
ggplot(shared_annotation_results, aes(log10(exome_clonotypes/exome_rpm), log10(rna_clonotypes/rna_rpm), colour=shared_group)) + geom_point() + labs(x="Exome clonal diversity (log10)", y="RNA clonal diversity (log10)") + theme(text=element_text(size=16)) + scale_color_manual(values=shared_annotation_colors)
shared_annotation_results$shared_group <- factor(shared_annotation_results$shared_group)
shared_annotation_results$shared_group
shared_annotation_colors <- c("gray", "red")
ggplot(shared_annotation_results, aes(log10(exome_clonotypes/exome_rpm), log10(rna_clonotypes/rna_rpm), colour=shared_group)) + geom_point() + labs(x="Exome clonal diversity (log10)", y="RNA clonal diversity (log10)") + theme(text=element_text(size=16)) + scale_color_manual(values=shared_annotation_colors)
shared_annotation_colors <- c("lightgray", "red")
ggplot(shared_annotation_results, aes(log10(exome_clonotypes/exome_rpm), log10(rna_clonotypes/rna_rpm), colour=shared_group)) + geom_point() + labs(x="Exome clonal diversity (log10)", y="RNA clonal diversity (log10)") + theme(text=element_text(size=16)) + scale_color_manual(values=shared_annotation_colors)
shared_id_results$shared_group <- 1
non_shared_id_results$shared_group <- 2
shared_annotation_results <- rbind(shared_id_results, non_shared_id_results)
shared_annotation_results$shared_group <- factor(shared_annotation_results$shared_group)
shared_annotation_colors <- c("lightgray", "red")
ggplot(shared_annotation_results, aes(log10(exome_clonotypes/exome_rpm), log10(rna_clonotypes/rna_rpm), colour=shared_group)) + geom_point() + labs(x="Exome clonal diversity (log10)", y="RNA clonal diversity (log10)") + theme(text=element_text(size=16)) + scale_color_manual(values=shared_annotation_colors)
shared_annotation_colors <- c("red", "lightgray")
ggplot(shared_annotation_results, aes(log10(exome_clonotypes/exome_rpm), log10(rna_clonotypes/rna_rpm), colour=shared_group)) + geom_point() + labs(x="Exome clonal diversity (log10)", y="RNA clonal diversity (log10)") + theme(text=element_text(size=16)) + scale_color_manual(values=shared_annotation_colors)
shared_id_results$shared_group <- 2
non_shared_id_results$shared_group <- 1
shared_annotation_results <- rbind(shared_id_results, non_shared_id_results)
shared_annotation_results$shared_group <- factor(shared_annotation_results$shared_group)
shared_annotation_colors <- c("lightgray", "red")
ggplot(shared_annotation_results, aes(log10(exome_clonotypes/exome_rpm), log10(rna_clonotypes/rna_rpm), colour=shared_group)) + geom_point() + labs(x="Exome clonal diversity (log10)", y="RNA clonal diversity (log10)") + theme(text=element_text(size=16)) + scale_color_manual(values=shared_annotation_colors)
shared_id_results$shared_group <- 1
non_shared_id_results$shared_group <- 0
shared_annotation_results <- rbind(shared_id_results, non_shared_id_results)
shared_annotation_results$shared_group <- factor(shared_annotation_results$shared_group)
shared_annotation_colors <- c("lightgray", "red")
shared_annotation_results$shared_group
shared_annotation_results$shared_group <- factor(shared_annotation_results$shared_group, levels = c(1,0))
shared_annotation_results$shared_group
shared_annotation_colors <- c("lightgray", "red")
ggplot(shared_annotation_results, aes(log10(exome_clonotypes/exome_rpm), log10(rna_clonotypes/rna_rpm), colour=shared_group)) + geom_point() + labs(x="Exome clonal diversity (log10)", y="RNA clonal diversity (log10)") + theme(text=element_text(size=16)) + scale_color_manual(values=shared_annotation_colors)
shared_annotation_colors <- c("red", "lightgray")
ggplot(shared_annotation_results, aes(log10(exome_clonotypes/exome_rpm), log10(rna_clonotypes/rna_rpm), colour=shared_group)) + geom_point() + labs(x="Exome clonal diversity (log10)", y="RNA clonal diversity (log10)") + theme(text=element_text(size=16)) + scale_color_manual(values=shared_annotation_colors)
ggplot(shared_annotation_results, aes(log10(exome_clonotypes/exome_rpm), log10(rna_clonotypes/rna_rpm), colour=shared_group)) + geom_point(alpha = 0.05) + labs(x="Exome clonal diversity (log10)", y="RNA clonal diversity (log10)") + theme(text=element_text(size=16)) + scale_color_manual(values=shared_annotation_colors)
ggplot(shared_annotation_results, aes(log10(exome_clonotypes/exome_rpm), log10(rna_clonotypes/rna_rpm), colour=shared_group)) + geom_point(alpha = 0.1) + labs(x="Exome clonal diversity (log10)", y="RNA clonal diversity (log10)") + theme(text=element_text(size=16)) + scale_color_manual(values=shared_annotation_colors)
ggplot(shared_annotation_results, aes(log10(exome_clonotypes/exome_rpm), log10(rna_clonotypes/rna_rpm), colour=shared_group)) + geom_point(alpha = 1) + labs(x="Exome clonal diversity (log10)", y="RNA clonal diversity (log10)") + theme(text=element_text(size=16)) + scale_color_manual(values=shared_annotation_colors)
ggplot(shared_annotation_results, aes(log10(exome_clonotypes/exome_rpm), log10(rna_clonotypes/rna_rpm), colour=shared_group)) + geom_point(alpha = 0.9) + labs(x="Exome clonal diversity (log10)", y="RNA clonal diversity (log10)") + theme(text=element_text(size=16)) + scale_color_manual(values=shared_annotation_colors)
shared_annotation_colors[1m]
shared_annotation_colors[1,]
shared_id_results$shared_group <- 1
non_shared_id_results$shared_group <- 0
shared_annotation_results <- rbind(non_shared_id_results, shared_id_results)
shared_annotation_results$shared_group <- factor(shared_annotation_results$shared_group, levels = c(1,0))
shared_annotation_colors <- c("red", "lightgray")
ggplot(shared_annotation_results, aes(log10(exome_clonotypes/exome_rpm), log10(rna_clonotypes/rna_rpm), colour=shared_group)) + geom_point(alpha = 0.9) + labs(x="Exome clonal diversity (log10)", y="RNA clonal diversity (log10)") + theme(text=element_text(size=16)) + scale_color_manual(values=shared_annotation_colors)
ggplot(shared_annotation_results, aes(log10(exome_clonotypes/exome_rpm), log10(rna_clonotypes/rna_rpm), colour=shared_group)) + geom_point(alpha = 0.9) + labs(x="Exome clonal diversity (log10)", y="RNA clonal diversity (log10)") + theme(text=element_text(size=16)) + scale_color_manual(values=shared_annotation_colors) + guides(fill=guide_legend(title=NULL))
ggplot(shared_annotation_results, aes(log10(exome_clonotypes/exome_rpm), log10(rna_clonotypes/rna_rpm), colour=shared_group)) + geom_point(alpha = 0.9) + labs(x="Exome clonal diversity (log10)", y="RNA clonal diversity (log10)") + theme(text=element_text(size=16)) + scale_color_manual(values=shared_annotation_colors) + theme(legend.title=element_blank())
ggplot(exome_rna_pos_results, aes(log10(exome_clonotypes/exome_rpm), log10(rna_clonotypes/rna_rpm), colour=cohort)) + geom_point() + labs(x="Exome clonal diversity (log10)", y="RNA clonal diversity (log10)") + theme(text=element_text(size=16)) + scale_color_manual(values=grays) + theme(legend.title=element_blank())
ggplot(exome_rna_pos_results, aes(log10(exome_clonotypes/exome_rpm), log10(rna_clonotypes/rna_rpm), colour=cohort)) + geom_point() + labs(x="Exome clonal diversity (log10)", y="RNA clonal diversity (log10)") + theme(text=element_text(size=16)) + scale_color_manual(values=grays)
shared_id_results$shared <- "shared"
non_shared_id_results$shared <- "not shared"
shared_annotation_results <- rbind(non_shared_id_results, shared_id_results)
shared_annotation_results$shared_group <- factor(shared_annotation_results$shared_group, levels = c(1,0))
shared_annotation_colors <- c("red", "lightgray")
ggplot(shared_annotation_results, aes(log10(exome_clonotypes/exome_rpm), log10(rna_clonotypes/rna_rpm), colour=shared_group)) + geom_point(alpha = 0.9) + labs(x="Exome clonal diversity (log10)", y="RNA clonal diversity (log10)") + theme(text=element_text(size=16)) + scale_color_manual(values=shared_annotation_colors) + theme(legend.title=element_blank())
shared_id <- unique(filter(clonotypes, rna > 0 & exome > 0)$patient_id)
shared_id_results <- filter(exome_rna_pos_results, patient_uuid %in% shared_id)
non_shared_id_results <- filter(exome_rna_pos_results, !(patient_uuid %in% shared_id))
shared_id_results$shared <- "shared"
non_shared_id_results$shared <- "not shared"
shared_annotation_results <- rbind(non_shared_id_results, shared_id_results)
shared_annotation_results$shared_group <- factor(shared_annotation_results$shared_group, levels = c("shared","not shared"))
shared_annotation_colors <- c("red", "lightgray")
ggplot(shared_annotation_results, aes(log10(exome_clonotypes/exome_rpm), log10(rna_clonotypes/rna_rpm), colour=shared_group)) + geom_point(alpha = 0.9) + labs(x="Exome clonal diversity (log10)", y="RNA clonal diversity (log10)") + theme(text=element_text(size=16)) + scale_color_manual(values=shared_annotation_colors) + theme(legend.title=element_blank())
shared_id <- unique(filter(clonotypes, rna > 0 & exome > 0)$patient_id)
shared_id_results <- filter(exome_rna_pos_results, patient_uuid %in% shared_id)
non_shared_id_results <- filter(exome_rna_pos_results, !(patient_uuid %in% shared_id))
shared_id_results$shared <- "shared"
non_shared_id_results$shared <- "not shared"
shared_annotation_results <- rbind(non_shared_id_results, shared_id_results)
shared_annotation_results$shared_group <- factor(shared_annotation_results$shared_group, levels = c("shared","not shared"))
shared_annotation_colors <- c("red", "lightgray")
ggplot(shared_annotation_results, aes(log10(exome_clonotypes/exome_rpm), log10(rna_clonotypes/rna_rpm), colour=shared)) + geom_point(alpha = 0.9) + labs(x="Exome clonal diversity (log10)", y="RNA clonal diversity (log10)") + theme(text=element_text(size=16)) + scale_color_manual(values=shared_annotation_colors)
shared_id <- unique(filter(clonotypes, rna > 0 & exome > 0)$patient_id)
shared_id_results <- filter(exome_rna_pos_results, patient_uuid %in% shared_id)
non_shared_id_results <- filter(exome_rna_pos_results, !(patient_uuid %in% shared_id))
shared_id_results$shared <- "shared"
non_shared_id_results$shared <- "not shared"
shared_annotation_results <- rbind(non_shared_id_results, shared_id_results)
shared_annotation_results$shared_group <- factor(shared_annotation_results$shared_group, levels = c("shared","not shared"))
shared_annotation_colors <- c("lightgray", "red")
ggplot(shared_annotation_results, aes(log10(exome_clonotypes/exome_rpm), log10(rna_clonotypes/rna_rpm), colour=shared)) + geom_point(alpha = 0.9) + labs(x="Exome clonal diversity (log10)", y="RNA clonal diversity (log10)") + theme(text=element_text(size=16)) + scale_color_manual(values=shared_annotation_colors)
shared_id <- unique(filter(clonotypes, rna > 0 & exome > 0)$patient_id)
shared_id_results <- filter(exome_rna_pos_results, patient_uuid %in% shared_id)
non_shared_id_results <- filter(exome_rna_pos_results, !(patient_uuid %in% shared_id))
shared_id_results$shared <- "shared"
non_shared_id_results$shared <- "no shared"
shared_annotation_results <- rbind(non_shared_id_results, shared_id_results)
shared_annotation_results$shared_group <- factor(shared_annotation_results$shared_group, levels = c("shared","no shared"))
shared_annotation_colors <- c("lightgray", "red")
ggplot(shared_annotation_results, aes(log10(exome_clonotypes/exome_rpm), log10(rna_clonotypes/rna_rpm), colour=shared)) + geom_point(alpha = 0.9) + labs(x="Exome clonal diversity (log10)", y="RNA clonal diversity (log10)") + theme(text=element_text(size=16)) + scale_color_manual(values=shared_annotation_colors)
source('~/tcrseq/new/rstudio_plots/dna_rna_infiltration.R')
ggplot(rna_tcrb_box, aes(x=L1, y=value)) + geom_boxplot() + labs(x="", y="TCRB gene expression (log10 RPM)") + theme(text=element_text(size=16))
ggplot(rna_exome_box, aes(x=L1, y=value)) + geom_boxplot() + labs(x="", y="Normalized CDR3 abundance in tumor DNA (log10)") + theme(text=element_text(size=16))
ggplot(rna_exome_box, aes(x=L1, y=value)) + geom_boxplot() + labs(x="", y="Tumor DNA CDR3 abundance (log10)") + theme(text=element_text(size=16))
ggplot(rna_tcrb_box, aes(x=L1, y=value)) + geom_boxplot() + labs(x="", y="TCRB gene expression (log10 RPM)") + theme(text=element_text(size=16))
plot(cancer_current$exome_rpm, cancer_current$rna_rpm)
plot(log10(cancer_current$exome_rpm), log10(cancer_current$rna_rpm))
source('~/tcrseq/new/rstudio_plots/clonal_diversity.R')
library(dplyr)
library(ggplot2)
library(colorspace)
library(viridis)
library(grDevices)
results <- read.csv("/Users/Eric/tcrseq/new/final/pancan_results_8-10-2016.txt", sep="\t")
clonotypes <- read.csv("/Users/Eric/tcrseq/new/final/pancan_clonotypes_8-10-2016.txt", sep="\t")
clonotypes$clonotype <- as.character(clonotypes$clonotype)
clonotypes$patient_id <- as.character(clonotypes$patient_id)
clonotypes$nuc <- as.character(clonotypes$nuc)
cancer_current <- filter(results, cohort != "THYM", cohort != "UVM", cohort != "CHOL",
cohort != "ACC", cohort != "CESC", cohort != "DLBC", cohort != "ESCA",
cohort != "KICH", cohort != "LGG", cohort != "LIHC", cohort != "MESO",
cohort != "PCPG", cohort != "TGCT", cohort != "UCS")
cancer_current$cohort <- factor(cancer_current$cohort)
results <- cancer_current
# clonal diversity by cohort
exome_pos_results <- filter(results, exome_clonotypes>0)
rna_pos_results <- filter(results, rna_clonotypes>0)
ggplot(exome_pos_results, aes(exome_cdr3, exome_clonotypes, colour=cohort)) + geom_point() + labs(x="Tumor DNA CDR3 reads", y="Number of clonotypes") + theme(text=element_text(size=16)) + scale_color_viridis(discrete=TRUE)
ggplot(rna_pos_results, aes(rna_cdr3, rna_clonotypes, colour=cohort)) + geom_point() + labs(x="Tumor RNA CDR3 reads", y="Number of clonotypes") + theme(text=element_text(size=16)) + scale_color_viridis(discrete=TRUE)
ggplot(rna_pos_results, aes(log10(tcrb_rpm), log10(rna_rpm), colour=cohort)) + geom_point() + labs(x="TCRB RNA rpm (log10)", y="RNA CDR3 rpm (log10)") + theme(text=element_text(size=16)) + scale_color_viridis(discrete=TRUE)
ggplot(rna_pos_results, aes(log10(tcrb_reads), log10(rna_cdr3), colour=cohort)) + geom_point() + labs(x="TCRB RNA reads (log10)", y="RNA CDR3 reads (log10)") + theme(text=element_text(size=16)) + scale_color_viridis(discrete=TRUE)
ggplot(rna_pos_results, aes(log10(tcrb_reads), log10(rna_clonotypes), colour=cohort)) + geom_point() + labs(x="TCRB RNA reads (log10)", y="RNA CDR3 clonotypes (log10)") + theme(text=element_text(size=16)) + scale_color_viridis(discrete=TRUE)
ggplot(rna_pos_results, aes(log10(tcrb_reads), log10(rna_clonotypes/rna_rpm), colour=cohort)) + geom_point() + labs(x="TCRB RNA reads (log10)", y="RNA clonal diversity (log10)") + theme(text=element_text(size=16)) + scale_color_viridis(discrete=TRUE)
exome_rna_pos_results <- filter(results, exome_clonotypes>0, rna_clonotypes>0)
ggplot(exome_rna_pos_results, aes(log10(exome_clonotypes/exome_rpm), log10(rna_clonotypes/rna_rpm), colour=cohort)) + geom_point() + labs(x="Exome clonal diversity (log10)", y="RNA clonal diversity (log10)") + theme(text=element_text(size=16)) + scale_color_viridis(discrete=TRUE)
grays <- gray.colors(length(unique(exome_rna_pos_results$cohort)))
grays[16] <- "yellow" # should be STAD
grays[18] <- "red" # should be UCEC
grays[11] <- "blue" # should be PAAD
ggplot(exome_rna_pos_results, aes(log10(exome_clonotypes/exome_rpm), log10(rna_clonotypes/rna_rpm), colour=cohort)) + geom_point() + labs(x="Exome clonal diversity (log10)", y="RNA clonal diversity (log10)") + theme(text=element_text(size=16)) + scale_color_manual(values=grays)
shared_id <- unique(filter(clonotypes, rna > 0 & exome > 0)$patient_id)
shared_id_results <- filter(exome_rna_pos_results, patient_uuid %in% shared_id)
non_shared_id_results <- filter(exome_rna_pos_results, !(patient_uuid %in% shared_id))
shared_id_results$shared <- "shared"
non_shared_id_results$shared <- "no shared"
shared_annotation_results <- rbind(non_shared_id_results, shared_id_results)
shared_annotation_results$shared_group <- factor(shared_annotation_results$shared_group, levels = c("shared","no shared"))
shared_annotation_colors <- c("lightgray", "red")
ggplot(shared_annotation_results, aes(log10(exome_clonotypes/exome_rpm), log10(rna_clonotypes/rna_rpm), colour=shared)) + geom_point(alpha = 0.9) + labs(x="Exome clonal diversity (log10)", y="RNA clonal diversity (log10)") + theme(text=element_text(size=16)) + scale_color_manual(values=shared_annotation_colors)
ggplot(exome_rna_pos_results, aes(log10(exome_reads), exome_clonotypes, colour=cohort)) + geom_point() + labs(x="Tumor DNA read count (log10)", y="Tumor DNA clonotypes") + theme(text=element_text(size=16)) + scale_color_viridis(discrete=TRUE)
ggplot(exome_rna_pos_results, aes(log10(rna_reads), rna_clonotypes, colour=cohort)) + geom_point() + labs(x="Tumor RNA read count (log10)", y="Tumor RNA clonotypes") + theme(text=element_text(size=16)) + scale_color_viridis(discrete=TRUE)
cor.test(exome_pos_results$exome_reads, exome_pos_results$exome_clonotypes)
cor.test(rna_pos_results$tcrb_rpm, rna_pos_results$rna_rpm)
cor.test(rna_pos_results$tcrb_reads, rna_pos_results$rna_clonotypes)
shared_id <- unique(filter(clonotypes, rna > 0 & exome > 0)$patient_id)
shared_id_results <- filter(exome_rna_pos_results, patient_uuid %in% shared_id)
non_shared_id_results <- filter(exome_rna_pos_results, !(patient_uuid %in% shared_id))
shared_id_results$shared <- "shared"
non_shared_id_results$shared <- "no shared"
shared_annotation_results <- rbind(non_shared_id_results, shared_id_results)
shared_annotation_results$shared_group <- factor(shared_annotation_results$shared_group, levels = c("shared","no shared"))
shared_annotation_colors <- c("lightgray", "red")
shared_annotation_results
shared_annotation_results[1,]
shared_id <- unique(filter(clonotypes, rna > 0 & exome > 0)$patient_id)
shared_id_results <- filter(exome_rna_pos_results, patient_uuid %in% shared_id)
non_shared_id_results <- filter(exome_rna_pos_results, !(patient_uuid %in% shared_id))
shared_id_results$shared <- "shared"
non_shared_id_results$shared <- "no shared"
shared_annotation_results <- rbind(non_shared_id_results, shared_id_results)
shared_annotation_results$shared <- factor(shared_annotation_results$shared, levels = c("shared","no shared"))
shared_annotation_colors <- c("lightgray", "red")
ggplot(shared_annotation_results, aes(log10(exome_clonotypes/exome_rpm), log10(rna_clonotypes/rna_rpm), colour=shared)) + geom_point(alpha = 0.9) + labs(x="Exome clonal diversity (log10)", y="RNA clonal diversity (log10)") + theme(text=element_text(size=16)) + scale_color_manual(values=shared_annotation_colors)
shared_annotation_colors <- c("red", "lightgray")
ggplot(shared_annotation_results, aes(log10(exome_clonotypes/exome_rpm), log10(rna_clonotypes/rna_rpm), colour=shared)) + geom_point(alpha = 0.9) + labs(x="Exome clonal diversity (log10)", y="RNA clonal diversity (log10)") + theme(text=element_text(size=16)) + scale_color_manual(values=shared_annotation_colors)
length(shared_id) # 196 with shared DNA RNA clonotype
nrow(exome_pos)
exome_pos_results[1,]
nrow(exome_pos_results)
nrow(rna_pos_results)
nrow(filter(cancer_current, exome_cdr3 > 0 & rna_cdr3 > 0))
length(unique(as.character(filter(clonotypes, exome > 0))))
length(unique(as.character(filter(clonotypes, exome > 0)$clonotype)))
length(unique(as.character(filter(clonotypes, rna > 0)$clonotype)))
exome_rna_both_patients <- as.character(filter(cancer_current, exome_cdr3 > 0 & rna_cdr3 > 0))
exome_rna_both_clonotypes <- unique(as.character(filter(clonotypes, patient_id %in% exome_rna_both_patients)$clonotype))
length(exome_rna_both_clonotypes)
clonotypes[1,]
exome_rna_both_patients <- as.character(filter(cancer_current, exome_cdr3 > 0 & rna_cdr3 > 0))
length(exome_rna_both_patients)
exome_rna_both_patients <- as.character(filter(cancer_current, exome_cdr3 > 0 & rna_cdr3 > 0)$patient_uuid)
exome_rna_both_clonotypes <- unique(as.character(filter(clonotypes, patient_id %in% exome_rna_both_patients)$clonotype))
length(exome_rna_both_clonotypes)
exome_rna_both_clonotypes <- filter(clonotypes, patient_id %in% exome_rna_both_patients)
length(unique(as.character(exome_rna_both_clonotypes$clonotype)))
length(unique(as.character(filter(exome_rna_both_clonotypes, exome > 0)$clonotype))) # 45996 clonotypes in patients with both exome and rna
length(unique(as.character(filter(exome_rna_both_clonotypes, rna > 0)$clonotype))) # 4616 exome clonotypes in patients with both exome and rna
summary(exome_rna_both
exome_rna_both_results <- filter(cancer_current, exome_cdr3 > 0 & rna_cdr3 > 0)
exome_rna_both_patients <- as.character(exome_rna_both_results$patient_uuid))
exome_rna_both_results <- filter(cancer_current, exome_cdr3 > 0 & rna_cdr3 > 0)
exome_rna_both_patients <- as.character(exome_rna_both_results$patient_uuid)
exome_rna_both_results <- filter(cancer_current, exome_cdr3 > 0 & rna_cdr3 > 0)
exome_rna_both_patients <- as.character(exome_rna_both_results$patient_uuid)
nrow(exome_rna_both_results)
summary(exome_rna_both_results$exome_clonotypes)
summary(exome_rna_both_results$rna_clonotypes)
summary(exome_rna_both_results$exome_clonotypes)
2/4616*16/37859
2/4616*16/37859*2502
wilcox.test(shared_id_results$exome_clonotypes/shared_id_results$exome_rpm, non_shared_id_results$exome_clonotypes/non_shared_id_results$exome_rpm)
wilcox.test(shared_id_results$rna_clonotypes/shared_id_results$rna_rpm, non_shared_id_results$rna_clonotypes/non_shared_id_results$rna_rpm)
length(unique(as.character(clonotypes, exome>0 & rna>0)))
length(unique(as.character(filter(clonotypes, exome>0 & rna>0)$clonotype)))
10000000*200
170*20
170*35
170*35-50*35
4200*12
4200*.12
7375*0.05
8*15
