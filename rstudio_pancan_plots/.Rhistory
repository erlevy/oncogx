lapply(split(exome_pos$tcrb_rpm, exome_pos$R), log10)
rna_tcrb_box <- melt(lapply(split(exome_pos$tcrb_rpm, exome_pos$R), log10))
rna_tcrb_box[1,]
rna_tcrb_box[2,]
rna_tcrb_box[3,]
rna_tcrb_box[4,]
ggplot(rna_tcrb_box, aes(x=L1, y=value)) + geom_boxplot()
ggplot(rna_tcrb_box, aes(x=L1, y=value)) + geom_boxplot() + labs(x="RNA CDR3", y="TCRB RPM (log10)")
ggplot(rna_tcrb_box, aes(x=L1, y=value)) + geom_boxplot() + labs(x="RNA CDR3", y="TCRB RPM (log10)") + theme(text=element_text(size=16))
library(dplyr)
results <- read.csv("/Users/Eric/tcrseq/new/final/pancan_results_8-10-2016.txt", sep="\t")
clonotypes <- read.csv("/Users/Eric/tcrseq/new/final/pancan_clonotypes_8-10-2016.txt", sep="\t")
clonotypes$clonotype <- as.character(clonotypes$clonotype)
clonotypes$patient_id <- as.character(clonotypes$patient_id)
clonotypes$nuc <- as.character(clonotypes$nuc)
exome_pos <- filter(clonotypes, exome > 0)
exome_pos[1,]
length(unique(exome_pos$clonotype))
length(unique(exome_pos$patient_id))
results[1,]
length(filter(results, exome_rpm>0))
nrow(filter(results, exome_rpm>0))
tumor_exome_shared_aa <- names(which(table(exome_pos)>1))
table(exome_pos)
tumor_exome_shared_aa <- names(which(table(exome_pos$clonotype)>1))
tumor_exome_shared_aa
table(exome_pos$clonotype)>1
table(exome_pos$clonotype)
table(exome_pos$clonotype)[1,]
table(exome_pos$clonotype)[1]
table(exome_pos$clonotype)[2]
table(exome_pos$clonotype)[3]
tumor_exome_shared_aa <- names(which(table(exome_pos$clonotype)>1))
exome_tumor_shared <- filter(exome_pos, clonotype %in% tumor_exome_shared_aa)
exome_tumor_shared
[1,]
exome_tumor_shared[1,]
lengthlength(unique(exome_tumor_shared$clonotype))
length(unique(exome_tumor_shared$patient_id))
length(unique(exome_tumor_shared$clonotype))
table(exome_tumor_shared$clonotype)
sort(table(exome_tumor_shared$clonotype))
rna_pos <- filter(clonotypes, rna > 0)
tumor_rna_cl <- unique(rna_pos$clonotype)
length(tumor_rna_cl)
length(unique(rna_pos$patient_id))
tumor_rna_shared_aa <- names(which(table(rna_pos$clonotype)>1))
rna_tumor_shared <- filter(rna_pos, clonotype %in% tumor_rna_shared_aa)
length(unique(rna_tumor_shared$clonotype))
length(unique(rna_tumor_shared$patient_id))
table(rna_tumor_shared$clonotype)
sort(table(rna_tumor_shared$clonotype)
)
tumor_rna_shared_aa <- names(which(table(rna_pos$clonotype)>1))
rna_tumor_shared <- filter(rna_pos, clonotype %in% tumor_rna_shared_aa)
length(unique(rna_tumor_shared$clonotype))
length(unique(rna_tumor_shared$patient_id))
table(rna_tumor_shared$clonotype)
length(unique(rna_tumor_shared$clonotype))
length(unique(rna_tumor_shared$patient_id))
table(rna_tumor_shared$clonotype)
sort(table(rna_tumor_shared$clonotype)
)
hist(table(rna_tumor_shared$clonotype)
)
table(table(rna_tumor_shared$clonotype)
)
tumor_exome_rna_shared <- intersect(tumor_exome_cl, tumor_rna_cl)
length(tumor_exome_rna_shared)
tumor_exome_rna_shared <- intersect(tumor_exome_cl, tumor_rna_cl)
length(tumor_exome_rna_shared)
tumor_exome_rna_shared <- intersect(tumor_exome_cl, tumor_rna_cl)
tumor_exome_cl <- unique(exome_pos$clonotype)
tumor_exome_rna_shared <- intersect(tumor_exome_cl, tumor_rna_cl)
length(tumor_exome_rna_shared)
length(tumor_exome_cl)
tumor_rna_cl
length(unique(tumor_exome_rna_shared))
lenght(tumor_exome_rna_shared)
length(tumor_exome_rna_shared)
exome_rna_tumor_shared <- filter(clonotypes, clonotype %in% tumor_rna_shared_aa)
nrow(exome_rna_tumor_shared)
length(unique(rna_tumor_shared$clonotype))
length(unique(rna_tumor_shared$patient_id))
tumor_exome_rna_shared <- intersect(tumor_exome_cl, tumor_rna_cl)
length(tumor_exome_rna_shared)
exome_rna_tumor_shared <- filter(clonotypes, clonotype %in% tumor_exome_rna_shared)
nrow(exome_rna_tumor_shared)
exome_rna_tumor_shared <- filter(clonotypes, clonotype %in% tumor_exome_rna_shared)
length(unique(exome_rna_tumor_shared$clonotype))
length(unique(exome_rna_tumor_shared$patient_id))
table(exome_rna_tumor_shared$clonotype)
length(unique(exome_rna_tumor_shared$clonotype))
length(unique(exome_rna_tumor_shared$patient_id))
table(exome_rna_tumor_shared$clonotype)
sort(table(exome_rna_tumor_shared$clonotype))
sort(table(exome_rna_tumor_shared$clonotype))
clonotype_common <- "CATSRDTELQCFLLSVHKPHCFPDPGAFS"
filter(rna_pos, clonotype==clonotype_common)
blood_pos <- filter(clonotypes, blood > 0)
tumor_blood_cl <- unique(blood_pos$clonotype)
length(tumor_blood_cl)
length(unique(blood_pos$patient_id))
tumor_exome_blood_shared <- intersect(tumor_exome_cl, tumor_blood_cl)
length(tumor_exome_blood_shared)
exome_blood_tumor_shared <- filter(clonotypes, clonotype %in% tumor_exome_blood_shared)
length(unique(exome_blood_tumor_shared$clonotype))
length(unique(exome_blood_tumor_shared$patient_id))
exome_blood_tumor_shared[1,]
sort(table(exome_blood_tumor_shared$clonotype))
exome_blood_tumor_shared <- filter(clonotypes, clonotype %in% tumor_exome_blood_shared)
length(unique(exome_blood_tumor_shared$clonotype))
length(unique(exome_blood_tumor_shared$patient_id))
sort(table(exome_blood_tumor_shared$clonotype))
length(unique(exome_blood_tumor_shared$clonotype))
length(unique(exome_blood_tumor_shared$patient_id))
library(ggplot2)
results[1,]
ggplot(results, aes(tcrb_reads, exome_clonotypes)) + geom_point()
exome_pos
exome_pos_results <- filter(results, exome_clonotypes>0)
ggplot(exome_pos_results, aes(tcrb_reads, exome_clonotypes)) + geom_point() + labs(x="exome CDR3 rpm (log10)", y="RNA CDR3 rpm (log10)") + geom_text_repel(data=avgs_plot, aes(label=rownames(avgs_plot)), size=6) + theme(text=element_text(size=16))
ggplot(exome_pos_results, aes(tcrb_reads, exome_clonotypes)) + geom_point()
exome_pos_results
exome_pos_results$exome_clonotypes
rna_pos_results <- filter(results, rna_clonotypes>0)
ggplot(rna_pos_results, aes(tcrb_reads, rna_clonotypes)) + geom_point()
ggplot(rna_pos_results, aes(tcrb_reads, rna_cdr3)) + geom_point()
ggplot(rna_pos_results, aes(log(tcrb_reads), log(rna_cdr3))) + geom_point()
ggplot(rna_pos_results, aes(log(tcrb_reads), log(rna_clonotypes))) + geom_point()
ggplot(exome_pos_results, aes(log(tcrb_reads), log(exome_clonotypes))) + geom_point()
ggplot(exome_pos_results, aes(log(exome_reads), log(exome_clonotypes))) + geom_point()
ggplot(rna_pos_results, aes(log(rna_reads), log(rna_clonotypes))) + geom_point()
ggplot(rna_pos_results, aes(log(tcrb_rpm), log(rna_rpm))) + geom_point()
ggplot(exome_pos_results, aes(log(exome_reads), log(exome_clonotypes))) + geom_point()
ggplot(rna_pos_results, aes(log10(tcrb_rpm), log10(rna_rpm))) + geom_point()
rna_pos_results[1,]
ggplot(rna_pos_results, aes(log10(tcrb_rpm), log10(rna_rpm), colour=cohort)) + geom_point() + labs(x="TCRB RNA rpm (log10)", y="RNA CDR3 rpm (log10)") + theme(text=element_text(size=16))
library(RColorBrewer)
ggplot(rna_pos_results, aes(log10(tcrb_rpm), log10(rna_rpm), colour=cohort)) + geom_point() + labs(x="TCRB RNA rpm (log10)", y="RNA CDR3 rpm (log10)") + theme(text=element_text(size=16)) + scale_color_brewer(palette = "Set1")
library(colorspace)
rainbow_hcl(22)
rainbow_hcl(30)
rna_pos_results[1,]
length(unique(rna_pos_results$cohort))
ggplot(rna_pos_results, aes(log10(tcrb_rpm), log10(rna_rpm), colour=cohort)) + geom_point() + labs(x="TCRB RNA rpm (log10)", y="RNA CDR3 rpm (log10)") + theme(text=element_text(size=16)) + scale_colour_manual(values=rainbow_hcl(30))
ggplot(rna_pos_results, aes(log10(tcrb_rpm), log10(rna_rpm), colour=cohort)) + geom_point() + labs(x="TCRB RNA rpm (log10)", y="RNA CDR3 rpm (log10)") + theme(text=element_text(size=16)) + scale_colour_manual(values=diverge_hcl(30))
install.packages("viridis")
library(viridis)
ggplot(rna_pos_results, aes(log10(tcrb_rpm), log10(rna_rpm), colour=cohort)) + geom_point() + labs(x="TCRB RNA rpm (log10)", y="RNA CDR3 rpm (log10)") + theme(text=element_text(size=16)) + scale_fill_viridis()
ggplot(rna_pos_results, aes(log10(tcrb_rpm), log10(rna_rpm), colour=cohort)) + geom_point() + labs(x="TCRB RNA rpm (log10)", y="RNA CDR3 rpm (log10)") + theme(text=element_text(size=16)) + scale_color_viridis()
ggplot(rna_pos_results, aes(log10(tcrb_rpm), log10(rna_rpm), colour=cohort)) + geom_point() + labs(x="TCRB RNA rpm (log10)", y="RNA CDR3 rpm (log10)") + theme(text=element_text(size=16)) + scale_color_viridis(discrete=TRUE)
ggplot(rna_pos_results, aes(log10(tcrb_rpm), log10(rna_rpm), colour=cohort)) + geom_point() + labs(x="TCRB RNA rpm (log10)", y="RNA CDR3 rpm (log10)") + theme(text=element_text(size=16)) + scale_color_viridis(discrete=TRUE, option="magma")
cor.test(exome_pos_results$exome_reads, exome_pos_results$exome_clonotypes)
cor.test(exome_pos_results$tcrb_rpm, exome_pos_results$rna_rpm)
cor.test(rna_pos_results$tcrb_rpm, rna_pos_results$rna_rpm)
ggplot(exome_pos_results, aes(log10(exome_cdr3), log10(exome_clonotypes))) + geom_point()
ggplot(exome_pos_results, aes(exome_cdr3, exome_clonotypes)) + geom_point()
ggplot(exome_pos_results, aes(exome_cdr3, exome_clonotypes)) + geom_point() + labs(x="exome CDR3 reads", y="Number of clonotypes") + theme(text=element_text(size=16)) + scale_color_viridis(discrete=TRUE)
ggplot(rna_pos_results, aes(rna_cdr3, rna_clonotypes)) + geom_point() + labs(x="exome CDR3 rpm (log10)", y="RNA CDR3 rpm (log10)") + theme(text=element_text(size=16)) + scale_color_viridis(discrete=TRUE)
ggplot(rna_pos_results, aes(log10(tcrb_reads), log10(rna_cdr3))) + geom_point()
ggplot(rna_pos_results, aes(log10(tcrb_reads), log10(rna_clonotypes))) + geom_point()
cor.test(rna_pos_results$tcrb_reads, rna_pos_results$rna_clonotypes)
ggplot(rna_pos_results, aes(log10(tcrb_reads), log10(rna_clonotypes))) + geom_point() + labs(x="TCRB RNA reads (log10)", y="RNA CDR3 clonotypes (log10)") + theme(text=element_text(size=16)) + scale_color_viridis(discrete=TRUE)
ggplot(exome_pos_results, aes(exome_cdr3, exome_clonotypes, colour=cohort)) + geom_point() + labs(x="exome CDR3 reads", y="Number of clonotypes") + theme(text=element_text(size=16)) + scale_color_viridis(discrete=TRUE)
ggplot(rna_pos_results, aes(rna_cdr3, rna_clonotypes, colour=cohort)) + geom_point() + labs(x="RNA CDR3 reads", y="Number of clonotypes") + theme(text=element_text(size=16)) + scale_color_viridis(discrete=TRUE)
ggplot(rna_pos_results, aes(log10(tcrb_reads), log10(rna_clonotypes), colour=cohort)) + geom_point() + labs(x="TCRB RNA reads (log10)", y="RNA CDR3 clonotypes (log10)") + theme(text=element_text(size=16)) + scale_color_viridis(discrete=TRUE)
ggplot(rna_pos_results, aes(log10(tcrb_reads), log10(rna_clonotypes), colour=gender)) + geom_point()
ggplot(rna_pos_results, aes(log10(tcrb_rpm), log10(rna_rpm), colour=gender)) + geom_point()
types
source('~/tcrseq/new/rstudio_plots/dna_rna_infiltration.R')
cancer_split[[1]]
cancer_split$ACC
testy <- cancer_split$ACC
testy[1,]
df
df_in
df_in <- testy
gender_split <- split(df_in, gender)
gender_split <- split(df_in, df_ingender)
gender_split <- split(df_in, df_in$gender)
gender_split[1,]
gender_split$female
gender_split$male
gender_fc <- average(gender_split$male$rna_rpm, na.rm=TRUE)/average(gender_split$female$rna_rpm, na.rm=TRUE)
gender_fc <- mean(gender_split$male$rna_rpm, na.rm=TRUE)/mean(gender_split$female$rna_rpm, na.rm=TRUE)
gender_fc
gender_split$male$rna_rpm, na.rm=TRUE
mean(gender_split$male$rna_rpm, na.rm=TRUE)
mean(gender_split$female$rna_rpm, na.rm=TRUE)
gender_fc
log(gender_fc)
log10(gender_fc)
source('~/tcrseq/new/rstudio_plots/clonotypes_analysis.R')
ggplot(exome_pos_results, aes(exome_cdr3, exome_clonotypes, colour=cohort)) + geom_point() + labs(x="exome CDR3 reads", y="Number of clonotypes") + theme(text=element_text(size=16)) + scale_color_viridis(discrete=TRUE)
ggplot(rna_pos_results, aes(rna_cdr3, rna_clonotypes, colour=cohort)) + geom_point() + labs(x="RNA CDR3 reads", y="Number of clonotypes") + theme(text=element_text(size=16)) + scale_color_viridis(discrete=TRUE)
source('~/tcrseq/new/rstudio_plots/tumor_blood_clonotypes.R')
source('~/tcrseq/new/rstudio_plots/tumor_blood_clonotypes.R')
source('~/tcrseq/new/rstudio_plots/tumor_blood_clonotypes.R')
source('~/tcrseq/new/rstudio_plots/clonotypes_analysis.R')
source('~/tcrseq/new/rstudio_plots/tumor_blood_clonotypes.R')
blood_clonotype_diversity <- results$blood_clonotypes/results$blood_cdr3
tumor_exome_clonotype_diversity <- results$exome_clonotypes/results$exome_cdr3
blood_clonotype_diversity
cor.test(blood_clonotype_diversity, tumor_exome_clonotype_diversity)
tumor_blood_exome_pos <- filter(results, !is.na(blood_clonotypes) & !is.na(exome_clonotypes))
blood_clonotype_diversity <- tumor_blood_exome_pos$blood_clonotypes/tumor_blood_exome_pos$blood_cdr3
tumor_exome_clonotype_diversity <- tumor_blood_exome_pos$exome_clonotypes/tumor_blood_exome_pos$exome_cdr3
tumor_blooc_exome_pos[1,]
tumor_blood_exome_pos[1,]
tumor_blood_exome_pos[2,]
tumor_blood_exome_pos[3,]
blood_clonotype_diversity
tumor_blood_exome_pos <- filter(results, blood_clonotypes > 0 & exome_clonotypes > 0)
blood_clonotype_diversity <- tumor_blood_exome_pos$blood_clonotypes/tumor_blood_exome_pos$blood_cdr3
tumor_exome_clonotype_diversity <- tumor_blood_exome_pos$exome_clonotypes/tumor_blood_exome_pos$exome_cdr3
nrow(tumor_blood_exome_pos)
blood_clonotype_diversity <- tumor_blood_exome_pos$blood_clonotypes/tumor_blood_exome_pos$blood_cdr3
tumor_exome_clonotype_diversity <- tumor_blood_exome_pos$exome_clonotypes/tumor_blood_exome_pos$exome_cdr3
cor.test(blood_clonotype_diversity, tumor_exome_clonotype_diversity)
plot(blood_clonotype_diversity, tumor_exome_clonotype_diversity)
plot(tumor_blood_exome_pos$blood_rpm, tumor_blood_exome_pos$exome_rpm)
cor.test(tumor_blood_exome_pos$blood_rpm, tumor_blood_exome_pos$exome_rpm)
cor.test(tumor_blood_exome_pos$blood_rpm, tumor_blood_exome_pos$exome_rpm, method="spearman")
cor.test(blood_clonotype_diversity, tumor_exome_clonotype_diversity, method="spearman")
results[1,]
cor.test(results$exome_rpm, results$blood_rpm)
nrow(filter(clonotypes, blood > 0 | exome > 0))
length(unique(filter(clonotypes, blood > 0 | exome > 0)$patient_id)_
length(unique(filter(clonotypes, blood > 0 | exome > 0)$patient_id))
source('~/tcrseq/new/rstudio_plots/clonotypes_analysis.R')
ggplot(non_shared_patients_df, aes(x=reorder(Cohort, -Freq.2), y=Freq.2, fill=gender)) + geom_bar(stat="identity") + labs(x="Cohort", y="Fraction of patients") + theme(axis.text.x = element_text(angle = 90, hjust = 1)) + theme(text=element_text(size=16))
shared_patients_df
table(shared_patients_results$cohort)
table(exome_blood_baseline$cohort)
table(shared_patients_results$gender)
table(shared_patients_results$cohort, shared_patients_results$gender)
shared_patients_df$Cohort <- factor(shared_patients_df$Cohort)
shared_patients_df[1,]
exome_blood_baseline[1,]
nrow(exome_blood_baseline)
exome_blood_baseline <- mutate(exome_blood_baseline,hasc66=ifelse(patient_uuid %in% shared_patients,"1","0"))
exome_blood_baseline[1,]
exome_blood_baseline[2,]
exome_blood_baseline[3,]
exome_blood_baseline <- mutate(exome_blood_baseline,has_c66=ifelse(patient_uuid %in% shared_patients,"1","0"))
ggplot(exome_blood_baseline, aes(x=cohort, y=has_c66, fill=gender)) + geom_bar()
exome_blood_baseline[1,]
### FIGURE: c66 cohort fraction barplot by gender
ggplot(exome_blood_baseline, aes(x=cohort, y=has_c66)) + geom_bar() +
ggplot(exome_blood_baseline, aes(x=cohort, y=has_c66)) + geom_bar()
ggplot(exome_blood_baseline, aes(x=cohort, y=has_c66)) + geom_bar(stat="identity")
ggplot(exome_blood_baseline, aes(x=reorder(cohort), y=has_c66)) + geom_bar(stat="identity")
ggplot(exome_blood_baseline, aes(x=cohort, y=has_c66, fill=gender))
ggplot(exome_blood_baseline, aes(x=cohort, y=has_c66, fill=gender)) + geom_bar(stat="identity")
ggplot(exome_blood_baseline, aes(x=cohort, y=has_c66, fill=factor(gender))) + geom_bar(stat="identity")
source('~/tcrseq/new/rstudio_plots/dna_rna_infiltration.R')
ggplot(cancer_current,aes(as.factor(iDNA_score)))+geom_bar()+facet_wrap(~cohort, ncol=4, scales="free_y")
ggplot(exome_pos_vs_rna_df_melt, aes(x=Cohort, y=value, fill=variable)) + geom_bar(stat="identity", position="fill") + labs(x="Cohort", y="Fraction") + theme(axis.text.x = element_text(angle = 90, hjust = 1)) + theme(text=element_text(size=16))
exome_pos_vs_rna_df_melt[1,]
exome_pos_vs_rna_df_melt[2,]
exome_pos_vs_rna_df_melt[3,]
exome_pos_vs_rna_df_melt[4,]
ggplot(exome_pos_vs_rna_df_melt, aes(x=Cohort, y=value, fill=variable)) + geom_bar(stat="identity")
source('~/tcrseq/new/rstudio_plots/clonotypes_analysis.R')
source('~/tcrseq/new/rstudio_plots/tumor_blood_clonotypes.R')
source('~/tcrseq/new/rstudio_plots/dna_rna_infiltration.R')
exome_pos_vs_rna_df[1,]
exome_pos_vs_rna_df[2,]
exome_pos_vs_rna_df[3,]
exome_pos_vs_rna_df_melt <- melt(exome_pos_vs_rna_df)
exome_pos_vs_rna_df_melt[1,]
exome_pos_vs_rna_df_melt
source('~/tcrseq/new/rstudio_plots/clonotypes_analysis.R')
source('~/tcrseq/new/rstudio_plots/tumor_blood_clonotypes.R')
shared_patients_df[1,]
shared_patients[1,]
shared_patients_df[1,]
shared_patients_gender_df <- table(shared_patients_results$cohort, shared_patients_results$gender)
shared_patients_gender_df[1,]
shared_patients_gender_df[2,]
shared_patients_gender_df[3,]
shared_patients_gender_df
shared_patients_gender_melt <- melt(shared_patients_gender_df)
shared_patients_gender_melt[1,]
shared_patients_gender_melt[2,]
shared_patients_gender_melt[3,]
shared_patients_gender_melt[4,]
ggplot(shared_patients_gender_melt, aes(x=Var1, y=value, fill=Var2)) + geom_bar(stat="identity")
ggplot(shared_patients_gender_melt, aes(x=reorder(Var1, -value), y=value, fill=Var2)) + geom_bar(stat="identity"
)
shared_patients_gender_melt[1,]
shared_patients_gender_df[1,]
shared_patients_gender_df[2,]
shared_patients_gender_df[3,]
shared_patients_gender_df <- filter(shared_patients_gender_df, female>0 | male>0)
shared_patients_gender_df <- data.frame(table(shared_patients_results$cohort, shared_patients_results$gender))
shared_patients_gender_df <- filter(shared_patients_gender_df, female>0 | male>0)
shared_patients_gender_df[1,]
shared_patients_gender_df[2,]
shared_patients_gender_df[3,]
shared_patients_gender_df[4,]
shared_patients_gender_df <- data.frame(table(shared_patients_results$cohort, shared_patients_results$gender))
shared_patients_gender_df[1,]
shared_patients_gender_df[2,]
shared_patients_gender_df <- table(shared_patients_results$cohort, shared_patients_results$gender)
shared_patients_gender_df[1,]
shared_patients_gender_df[2,]
shared_patients_gender_df[3,]
as.data.frame(shared_patients_gender_df)
shared_patients_gender_melt[1,]
shared_patients_gender_melt[2,]
shared_patients_gender_melt[3,]
non_shared_patients_gender_df <- table(non_shared_patients_results$cohort, non_shared_patients_results$gender)
non_shared_patients_gender_melt <- melt(non_shared_patients_gender_df)
ggplot(non_shared_patients_gender_melt, aes(x=reorder(Var1, -value), y=value, fill=Var2)) + geom_bar(stat="identity")
### FIGURE: c66 cohort fraction barplot by gender
shared_patients_gender_df <- table(shared_patients_results$cohort, shared_patients_results$gender)
shared_patients_gender_melt <- melt(shared_patients_gender_df)
ggplot(shared_patients_gender_melt, aes(x=reorder(Var1, -value), y=value, fill=Var2)) + geom_bar(stat="identity") + labs(x="Cohort", y="Fraction of patients") + theme(axis.text.x = element_text(angle = 90, hjust = 1)) + theme(text=element_text(size=16))
shared_patients_gender_df[1,]
shared_patients_gender_df[1,]
shared_patients_gender_df[2,]
shared_patients_gender_df[2,]==c(0,0)
as.data.frame(shared_patients_gender_df)
shared_patients_gender_df <- data.frame(table(shared_patients_results$cohort, shared_patients_results$gender))
shared_patients_gender_df <- filter(shared_patients_gender_df, Freq>0)
ggplot(shared_patients_gender_df, aes(x=reorder(Var1, -value), y=value, fill=Var2)) + geom_bar(stat="identity") + labs(x="Cohort", y="Fraction of patients") + theme(axis.text.x = element_text(angle = 90, hjust = 1)) + theme(text=element_text(size=16))
shared_patients_gender_df <- data.frame(table(shared_patients_results$cohort, shared_patients_results$gender))
shared_patients_gender_df <- filter(shared_patients_gender_df, Freq>0)
shared_patients_df[1,]
shared_patients_gender_df[1,]
ggplot(shared_patients_gender_df, aes(x=reorder(Var1, -Freq), y=Freq, fill=Var2)) + geom_bar(stat="identity") + labs(x="Cohort", y="Fraction of patients") + theme(axis.text.x = element_text(angle = 90, hjust = 1)) + theme(text=element_text(size=16))
ggplot(shared_patients_gender_df, aes(x=reorder(Var1, -Freq), y=Freq, fill=Var2)) + geom_bar(stat="identity") + labs(x="Cohort", y="Number of patients") + theme(axis.text.x = element_text(angle = 90, hjust = 1)) + theme(text=element_text(size=16))
non_shared_patients_gender_df <- data.frame(table(non_shared_patients_results$cohort, non_shared_patients_results$gender))
non_shared_patients_gender_df <- filter(non_shared_patients_gender_df, Freq>0)
ggplot(non_shared_patients_gender_df, aes(x=reorder(Var1, -Freq), y=Freq, fill=Var2)) + geom_bar(stat="identity") + labs(x="Cohort", y="Number of patients") + theme(axis.text.x = element_text(angle = 90, hjust = 1)) + theme(text=element_text(size=16))
results[1,]
results <- read.csv("/Users/Eric/tcrseq/new/final/pancan_results_8-10-2016.txt", sep="\t")
results_out <- results[,c("sample_barcode", "cohort", "exome_reads", "exome_cdr3", "rna_reads",
"rna_cdr3", "blood_reads", "blood_cdr3", "gender")]
results_out[1,]
nrow(results_out)
write.table(results_out, "pancan_cdr3_results_8-23-2106.txt", sep="\t", quote=FALSE)
write.table(results_out, "pancan_cdr3_results_8-23-2106.txt", sep="\t", quote=FALSE, row.names=FALSE)
kruskal.test(exome_rpm ~ cohort, data=cancer_current)
dunnTest(exome_rpm ~ cohort, data=cancer_current, method="bh")
library(OIsurv)
library(cgdsr)
library(cluster)
library(fpc)
library(gplots)
library(heatmap.plus)
library(reshape2)
library(dplyr)
library(ggplot2)
library(plotrix)
library(VennDiagram)
library(ggrepel)
library(FSA)
results <- read.csv("/Users/Eric/tcrseq/new/final/pancan_results_8-10-2016.txt", sep="\t")
clonotypes <- read.csv("/Users/Eric/tcrseq/new/final/pancan_clonotypes_8-10-2016.txt", sep="\t")
cdr3_results_current <- results
cancer_current <- cdr3_results_current
# remove cohort size <400
# BLCA, BRCA, COAD, HNSC, KIRC, LGG, LUAD, LUSC, OV, PRAD, STAD, THCA, UCEC
#cancer_current <- filter(cdr3_results_current, cohort=="BLCA" | cohort=="BRCA" | cohort=="COAD" | cohort=="HNSC" |
#                       cohort=="KIRC" | cohort=="LGG" | cohort=="LUAD" | cohort=="LUSC" | cohort=="OV" |
#                       cohort=="PRAD" | cohort=="STAD" | cohort=="THCA" | cohort=="UCEC")
#cancer_current$cohort <- factor(cancer_current$cohort)
#cancer_split <- split(cancer_current, cancer_current$cohort)
# remove THYM since it only has ONE exome case, UVM and CHOL have no RNA
cancer_current <- filter(cdr3_results_current, cohort != "THYM", cohort != "UVM", cohort != "CHOL")
cancer_current$cohort <- factor(cancer_current$cohort)
cancer_split <- split(cancer_current, cancer_current$cohort)
# medians of nonzero pancan
nonzero_pancan_exome <- filter(cancer_current, exome_cdr3 > 0)
nonzero_pancan_rna <- filter(cancer_current, rna_cdr3 > 0)
nonzero_pancan_blood <- filter(cancer_current, blood_cdr3 > 0)
nonzero_pancan_tils <- filter(cancer_current, percent_tils > 0)
median(nonzero_pancan_exome$exome_cdr3)
quantile(nonzero_pancan_exome$exome_cdr3, 0.9)
max(nonzero_pancan_exome$exome_cdr3)
median(nonzero_pancan_rna$rna_cdr3)
quantile(nonzero_pancan_rna$rna_cdr3, 0.9)
max(nonzero_pancan_rna$rna_cdr3)
median(nonzero_pancan_blood$blood_cdr3)
quantile(nonzero_pancan_blood$blood_cdr3, 0.9)
max(nonzero_pancan_blood$blood_cdr3)
median(nonzero_pancan_tils$percent_tils)
quantile(nonzero_pancan_tils$percent_tils, 0.9)
max(nonzero_pancan_tils$percent_tils)
nrow(nonzero_pancan_exome)
nrow(filter(cancer_current, exome_cdr3==0))
nrow(nonzero_pancan_rna)
nrow(filter(cancer_current, rna_cdr3==0))
nrow(nonzero_pancan_blood)
nrow(filter(cancer_current, blood_cdr3==0))
nrow(nonzero_pancan_tils)
nrow(filter(cancer_current, percent_tils==0))
# correlations with TILs and purity
cor.test(cancer_current$exome_rpm, cancer_current$percent_tils, method="spearman")
cor.test(cancer_current$rna_rpm, cancer_current$percent_tils, method="spearman")
cor.test(cancer_current$blood_rpm, cancer_current$percent_tils, method="spearman")
cor.test(cancer_current$exome_rpm, cancer_current$patient_purity, method="spearman")
cor.test(cancer_current$rna_rpm, cancer_current$patient_purity, method="spearman")
cor.test(cancer_current$blood_rpm, cancer_current$patient_purity, method="spearman")
# kruskal-wallis by cohort
kruskal.test(exome_rpm ~ cohort, data=cancer_current)
dunnTest(exome_rpm ~ cohort, data=cancer_current, method="bh")
write.table(dunnTest(exome_rpm ~ cohort, data=cancer_current, method="bh"), "test.txt", sep="\t", quote=FALSE)
testy <- dunnTest(exome_rpm ~ cohort, data=cancer_current, method="bh")
testy
testy$dtres
write.table(testy$dtres, "text.txt", sep="\t", quote=FALSE)
source('~/tcrseq/new/rstudio_plots/predictive_models.R')
cancer_current$gsva_cluster <- factor(cancer_current$gsva_cluster)
mylogit <- glm(exome_level ~ cohort + days_to_birth + gender + gsva_cluster + patient_purity + rna_rpm +
blood_rpm + tcrb_rpm + exome_reads, data = cancer_current, family = "binomial")
summary(mylogit)
cancer_current$gsva_cluster <- factor(cancer_current$gsva_cluster)
cancer_current <- within(cancer_current, cohort <- relevel(cohort, ref="LGG"))
mylogit <- glm(exome_level ~ cohort + days_to_birth + gender + gsva_cluster + patient_purity + rna_rpm +
blood_rpm + tcrb_rpm + exome_reads, data = cancer_current, family = "binomial")
summary(mylogit)
cancer_current$gsva_lowhigh <- factor(cancer_current$gsva_lowhigh)
cancer_current <- within(cancer_current, cohort <- relevel(cohort, ref="LGG"))
mylogit <- glm(gsva_lowhigh ~ cohort + days_to_birth + gender + blood_rpm,
data = cancer_current, family = "binomial")
summary(mylogit)
results[1,]
patient_purity <- c()
data_list <- c("LUMP")
for (i in 1:nrow(results))
{
sample_id <- substr(as.character(results$sample_barcode[i]),1,16)
matching <- which(rownames(purity)==sample_id)
if (length(matching)>0)
{
matching_purity <- purity[matching, data_list]
}
else
{
matching_purity <- rep(NA, length(data_list))
}
patient_purity <- rbind(patient_purity, matching_purity)
}
rownames(patient_purity) <- seq(1,nrow(patient_purity))
mode(patient_purity) <- 'numeric'
# add in LUMP score
### purity
purity <- read.csv("/Users/Eric/tcrseq/new/purity/pancancer_purity_butte.txt", sep="\t")
# process purity matrix
purity <- as.matrix(purity)
rownames(purity) <- purity[,1]
purity <- purity[,-1]
# match samples
patient_purity <- c()
data_list <- c("LUMP")
for (i in 1:nrow(results))
{
sample_id <- substr(as.character(results$sample_barcode[i]),1,16)
matching <- which(rownames(purity)==sample_id)
if (length(matching)>0)
{
matching_purity <- purity[matching, data_list]
}
else
{
matching_purity <- rep(NA, length(data_list))
}
patient_purity <- rbind(patient_purity, matching_purity)
}
rownames(patient_purity) <- seq(1,nrow(patient_purity))
mode(patient_purity) <- 'numeric'
patient_purity
rownames(patient_purity) <- seq(1,nrow(patient_purity))
mode(patient_purity) <- 'numeric'
lump_score <- patient_purity
results <- cbind(results, lump_score)
results$lump_score <- as.numeric(as.character(results$lump_score))
results[1,]
sum(is.na(results$lump_score))
source('~/tcrseq/new/rstudio_plots/predictive_models.R')
cancer_current[1,]
cancer_current$gsva_lowhigh <- factor(cancer_current$gsva_lowhigh)
cancer_current <- within(cancer_current, cohort <- relevel(cohort, ref="LGG"))
mylogit <- lm(lump_score ~ cohort + days_to_birth + gender + gsva_cluster + patient_purity + exome_rpm +
rna_rpm + blood_rpm + tcrb_rpm, data = cancer_current)
cancer_current$gsva_lowhigh <- factor(cancer_current$gsva_lowhigh)
cancer_current <- within(cancer_current, cohort <- relevel(cohort, ref="LGG"))
mylm <- lm(lump_score ~ cohort + days_to_birth + gender + gsva_cluster + patient_purity + exome_rpm +
rna_rpm + blood_rpm + tcrb_rpm, data = cancer_current)
summary(mylm)
cancer_current$gsva_lowhigh <- factor(cancer_current$gsva_lowhigh)
cancer_current <- within(cancer_current, cohort <- relevel(cohort, ref="LGG"))
mylm <- lm(lump_score ~ cohort + days_to_birth + gender + gsva_cluster + exome_rpm +
rna_rpm + blood_rpm + tcrb_rpm, data = cancer_current)
summary(mylm)
source('~/tcrseq/new/rstudio_plots/dna_rna_infiltration.R')
wilcox.test(exome_pos_new$tcrb_rpm, exome_pos_new$R2
)
exome_pos_new[1,]
wilcox.test(exome_pos_new$exome_rpm, exome_pos_new$R2)
boxplot(lapply(split(exome_pos$tcrb_rpm, exome_pos$R), log10))
boxplot(lapply(split(exome_pos$exome_rpm, exome_pos$R), log10))
rna_exome_box <- melt(lapply(split(exome_pos$exome_rpm, exome_pos$R), log10))
ggplot(rna_exome_box, aes(x=L1, y=value)) + geom_boxplot() + labs(x="RNA CDR3", y="Tumor Exome RPM (log10)") + theme(text=element_text(size=16))
source('~/tcrseq/new/rstudio_plots/predictive_models.R')
mylm <- lm(lump_score ~ cohort + days_to_birth + gender +blood_rpm,
data = cancer_current)
summary(mylm)
