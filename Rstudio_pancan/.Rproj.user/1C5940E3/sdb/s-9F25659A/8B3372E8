{
    "collab_server" : "",
    "contents" : "\nexome_ref <- read.csv(\"/Users/Eric/tcrseq/new/reference/exome_ref_unique.txt\", sep=\"\\t\")\nrna_ref <- read.csv(\"/Users/Eric/tcrseq/new/reference/rna_ref_unique.txt\", sep=\"\\t\")\nblood_ref <- read.csv(\"/Users/Eric/tcrseq/new/reference/blood_ref_unique.txt\", sep=\"\\t\")\n\ngsva_dir <- \"/Users/Eric/tcrseq/new/gsva/\"\nclinical_dir <- \"/Users/Eric/tcrseq/new/clinical_processed/\"\nexome_imseq_dir <- \"/Users/Eric/tcrseq/new/imseq/exome/\"\nexome_summary_dir <- \"/Users/Eric/tcrseq/new/summaries/exome/\"\nrna_imseq_dir <- \"/Users/Eric/tcrseq/new/imseq/rna/\"\nrna_summary_dir <- \"/Users/Eric/tcrseq/new/summaries/rna/\"\nrna_tcrb_dir <- \"/Users/Eric/tcrseq/new/summaries/tcrb/\"\nblood_imseq_dir <- \"/Users/Eric/tcrseq/new/imseq/blood/\"\nblood_summary_dir <- \"/Users/Eric/tcrseq/new/summaries/blood/\"\n\ncancer_type_last <- \"\"\ngsva_file <- \"\"\nclinical_file <- \"\"\nresults <- matrix(NA, nrow=nrow(exome_ref), ncol=42)\nfor (i in 1:nrow(exome_ref))\n{\n  cancer_type <- as.character(exome_ref$disease[i])\n  if (cancer_type!=cancer_type_last) {\n    gsva_path <- paste(gsva_dir, cancer_type, sep=\"\")\n    gsva_extension <- paste(gsva_path, \"_gsva.txt\", sep=\"\")\n    gsva_file <- read.csv(gsva_extension, sep=\"\\t\")\n    clinical_path <- paste(clinical_dir, cancer_type, sep=\"\")\n    clinical_extension <- paste(clinical_path, \"_clinical.txt\", sep=\"\")\n    clinical_file <- read.csv(clinical_extension, sep=\"\\t\", header=FALSE) \n    rownames(clinical_file) <- clinical_file[,1]\n    clinical_file <- clinical_file[,-1]\n  }\n  \n  exome_imseq_reads <- NA\n  exome_imseq_clonotypes <- NA\n  exome_id <- as.character(exome_ref$analysis_id[i])\n  exome_imseq_path <- paste(exome_imseq_dir, exome_id, sep=\"\")\n  exome_imseq_extension <- paste(exome_imseq_path, \".tsv\", sep=\"\")\n  if (file.exists(exome_imseq_extension)) {\n    if (file.info(exome_imseq_extension)$size>0)\n    {\n      exome_imseq_file <- read.csv(exome_imseq_extension, sep=\"\\t\")\n      exome_imseq_reads <- nrow(exome_imseq_file)\n      if (exome_imseq_reads>0) {\n        exome_imseq_clonotypes <- length(unique(exome_imseq_file[,10]))\n      } else {\n        exome_imseq_clonotypes <- 0\n      }      \n    }\n  }\n  \n  exome_summary_reads <- NA\n  exome_summary_path <- paste(exome_summary_dir, exome_id, sep=\"\")\n  exome_summary_extension <- paste(exome_summary_path, \".txt\", sep=\"\")\n  if (file.exists(exome_summary_extension)) {\n    if (file.info(exome_summary_extension)$size>0)\n    {\n      exome_summary_file <- read.csv(exome_summary_extension, sep=\"\\t\", header=FALSE)\n      exome_summary_reads <- sum(c(exome_summary_file[,3], exome_summary_file[,4]))      \n    }\n  }\n  \n  rna_id <- NA\n  rna_imseq_reads <- NA\n  rna_imseq_clonotypes <- NA\n  rna_summary_reads <- NA\n  rna_tcrb_reads <- NA\n  rna_match <- which(as.character(rna_ref$participant_id)==as.character(exome_ref$participant_id[i]))\n  if (length(rna_match)!=0)\n  {\n    rna_id <- as.character(rna_ref$analysis_id[rna_match])\n    rna_imseq_path <- paste(rna_imseq_dir, rna_id, sep=\"\")\n    rna_imseq_extension <- paste(rna_imseq_path, \".tsv\", sep=\"\")\n    if (file.exists(rna_imseq_extension)) {\n      if (file.info(rna_imseq_extension)$size>0)\n      {\n        rna_imseq_file <- read.csv(rna_imseq_extension, sep=\"\\t\")\n        rna_imseq_reads <- nrow(rna_imseq_file)\n        if (rna_imseq_reads>0) {\n          rna_imseq_clonotypes <- length(unique(rna_imseq_file[,10]))\n        } else {\n          rna_imseq_clonotypes <- 0\n        }        \n      }\n    } \n    rna_summary_path <- paste(rna_summary_dir, rna_id, sep=\"\")\n    rna_summary_extension <- paste(rna_summary_path, \".txt\", sep=\"\")\n    if (file.exists(rna_summary_extension)) {\n      if (file.info(rna_summary_extension)$size>0)\n      {\n        rna_summary_file <- read.csv(rna_summary_extension, sep=\"\\t\", header=FALSE)\n        rna_summary_reads <- sum(c(rna_summary_file[,3], rna_summary_file[,4]))        \n      }\n    }\n    rna_tcrb_path <- paste(rna_tcrb_dir, rna_id, sep=\"\")\n    rna_tcrb_extension <- paste(rna_tcrb_path, \".idxstats.txt\", sep=\"\")\n    if (file.exists(rna_tcrb_extension)) {\n      if (file.info(rna_tcrb_extension)$size>0)\n      {\n        rna_tcrb_file <- read.csv(rna_tcrb_extension, sep=\"\\t\", header=FALSE, row.names=1)\n        rna_tcrb_reads <- rna_tcrb_file[\"chr7\",2]       \n      }\n    }\n  }\n  \n  blood_id <- NA\n  blood_imseq_reads <- NA\n  blood_imseq_clonotypes <- NA\n  blood_summary_reads <- NA\n  blood_match <- which(as.character(blood_ref$participant_id)==as.character(exome_ref$participant_id[i]))\n  if (length(blood_match)!=0)\n  {\n    blood_id <- as.character(blood_ref$analysis_id[blood_match])\n    blood_imseq_path <- paste(blood_imseq_dir, blood_id, sep=\"\")\n    blood_imseq_extension <- paste(blood_imseq_path, \".tsv\", sep=\"\")\n    if (file.exists(blood_imseq_extension)) {\n      if (file.info(blood_imseq_extension)$size>0)\n      {\n        blood_imseq_file <- read.csv(blood_imseq_extension, sep=\"\\t\")\n        blood_imseq_reads <- nrow(blood_imseq_file)\n        if (blood_imseq_reads>0) {\n          blood_imseq_clonotypes <- length(unique(blood_imseq_file[,10]))\n        } else {\n          blood_imseq_clonotypes <- 0\n        }        \n      }\n    } \n    blood_summary_path <- paste(blood_summary_dir, blood_id, sep=\"\")\n    blood_summary_extension <- paste(blood_summary_path, \".txt\", sep=\"\")\n    if (file.exists(blood_summary_extension)) {\n      if (file.info(blood_summary_extension)$size>0)\n      {\n        blood_summary_file <- read.csv(blood_summary_extension, sep=\"\\t\", header=FALSE)\n        blood_summary_reads <- sum(c(blood_summary_file[,3], blood_summary_file[,4]))        \n      }\n    }\n  }\n\n  barcode <- exome_ref$barcode[i]\n  barcode <- substr(barcode, 1, 16)\n  gsva_barcodes <- gsub(\".\", \"-\", colnames(gsva_file), fixed=TRUE)\n  gsva_barcodes <- substr(gsva_barcodes,1,16)\n  gsva_index <- which(gsva_barcodes==barcode)\n  gsva_results <- rep(NA, 22)\n  if (length(gsva_index)>0)\n  {\n    gsva_results <- gsva_file[,gsva_index]\n  }\n  \n  uuid <- as.character(exome_ref$participant_id[i])\n  clinical_col <- which(as.matrix(clinical_file[2,])==uuid)\n  clinical_results <- rep(NA, 4)\n  if (length(clinical_col>0)) {\n    clinical_results <- as.numeric(as.matrix(clinical_file[c(3,4,5,6), clinical_col]))\n  }\n  \n  results_row <- c(uuid, barcode, cancer_type, exome_id, exome_summary_reads, exome_imseq_reads,\n                   exome_imseq_clonotypes, rna_id, rna_summary_reads, rna_imseq_reads, rna_imseq_clonotypes,\n                   rna_tcrb_reads, blood_id, blood_summary_reads, blood_imseq_reads, blood_imseq_clonotypes, \n                   clinical_results, gsva_results)\n  results[i,] <- results_row\n}\n\npancan_colnames <- c(\"patient_uuid\", \"sample_barcode\", \"cohort\", \"exome_uuid\", \"exome_reads\",\n                     \"exome_cdr3\", \"exome_clonotypes\", \"rna_uuid\", \"rna_reads\", \"rna_cdr3\", \"rna_clonotypes\",\n                     \"tcrb_reads\", \"blood_uuid\", \"blood_reads\", \"blood_cdr3\", \"blood_clonotypes\",\n                     \"days_to_birth\", \"days_to_death\",\"days_to_last_followup\", \"percent_tils\", \n                     \"T-regs\", \"T-CD8d\", \"T-CD4n\", \"T-CD4mr\", \"T-CD4ma\", \"T-hf\", \"T-gd\", \"B-n\", \n                     \"B-m\", \"Plasma\",\"NK-r\", \"NK-a\", \"Mono\", \"Macro-0\", \"Macro-1\", \"Macro-2\", \n                     \"Den-r\", \"Den-a\", \"Mast-r\", \"Mast-a\",\"Eos\", \"Neut\")\ncolnames(results) <- pancan_colnames\n\nwrite.table(results, \"/Users/Eric/tcrseq/new/processed/pancan_exome_rna_blood_tcrb_gsva_clinical_7-5-2016_exome.txt\", sep=\"\\t\", \n            row.names=FALSE, quote=FALSE)\n\n",
    "created" : 1468471627791.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3710866414",
    "id" : "8B3372E8",
    "lastKnownWriteTime" : 1467850396,
    "last_content_update" : 1467850396,
    "path" : "~/tcrseq/new/rstudio/data_compilation_exome.R",
    "project_path" : "data_compilation_exome.R",
    "properties" : {
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}