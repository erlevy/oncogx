{
    "collab_server" : "",
    "contents" : "library(OIsurv)\nlibrary(cgdsr)\nlibrary(cluster)\nlibrary(fpc)\nlibrary(gplots)\nlibrary(heatmap.plus)\nlibrary(car)\nlibrary(gvlma)\nlibrary(MASS)\nlibrary(leaps)\nlibrary(relaimpo)\nlibrary(dplyr)\nlibrary(RColorBrewer)\nlibrary(plotrix)\n\ngsva_dir <- \"/Users/Eric/tcrseq/new/gsva\"\n\nfiles_gsva <- list.files(path=gsva_dir, pattern=\"*.txt\", full.names=T, recursive=FALSE)\n\ngsva1 <- read.csv(files_gsva[1], sep=\"\\t\")\n\nheatmap.plus(t(as.matrix(gsva1)), col=bluered(51), scale=\"none\", Colv=NA, labRow=\"\")\n\nheatmaps <- function(file_path)\n{\n  gsva_file <- read.csv(file_path, sep=\"\\t\")\n  cancer_type <- basename(strsplit(file_path, '[.]')[[1]][1])\n  samples <- paste(\"_n=\", ncol(gsva_file), sep=\"\")\n  heatmap_title <- paste(cancer_type, samples, sep=\"\")\n#  heatmap.plus(t(as.matrix(gsva_file)), col=bluered(51), scale=\"none\", Colv=NA, labRow=\"\", main=heatmap_title)\n  hist(as.matrix(gsva_file[1,]))\n}\n\nlapply(files_gsva, heatmaps)\n\n\nresults <- read.csv(\"/Users/Eric/tcrseq/new/processed/pancan_exome_gsva_clinical_dedup.txt\", sep=\"\\t\")\nresults_heatmap <- results[!is.na(results$T.regs),]\n\nsignatures <- results_heatmap[,c(3,12:33)]\nsignatures <- unique(signatures)\ncohorts <- signatures[,1]\nsignatures <- signatures[,-1]\n\nsignature_cols <- c(\"T Regs\", \"T CD8\", \"T CD4 Naive\", \"T CD4 Mem. Resting\", \"T CD4 Mem. Activated\",\n                    \"T Folicular Helper\", \"T Gamma Delta\", \"B Naive\", \"B Memory\", \"Plasma\", \"NK Resting\",\n                    \"NK Activated\", \"Monocytes\", \"Macrophages M0\", \"Macrophages M1\", \"Macrophages M2\",\n                    \"Dendritic Resting\", \"Dendritic Activated\", \"Mast Resting\", \"Mast Activated\",\n                    \"Eosinophils\", \"Neutrophils\")\n\ncohort_numbers <- as.numeric(cohorts)\n#cohort_colors <- color.scale(cohort_numbers, c(0,1,1),c(1,1,0),0)\n\ncohort_colors <- cbind(cohort_colors, cohort_colors)\n\nheatmap.plus(as.matrix(signatures), col=bluered(51), scale=\"none\", Colv=NA, labRow=\"\", labCol=signature_cols, cexCol=2, margins=c(22,6))\n             \nheatmap.plus(as.matrix(signatures), col=bluered(51), RowSideColors=cohort_colors,\n             scale=\"none\", Colv=NA, labRow=\"\", labCol=signature_cols)\n\nheatmap.plus(as.matrix(signatures), col=bluered(51), RowSideColors=col_mat, scale=\"none\",\n             Colv=NA, labRow=\"\", cexCol=4.5, margins=c(36,6), labCol=signature_cols)\n\n\n\n# # heatmap of gsva clusters\n# #results_clustering <- results[!is.na(results$gsva_cluster),]\n# #results_clustering <- results_clustering[!is.na(results_clustering$rna_reads),]\n# #results_clustering <- results_clustering[which(results_clustering$clinical_group!=\"other\"),]\n# #results_clustering <- results_clustering[!is.na(results_clustering$clinical_group),]\n# #col_mat <- matrix(nrow=nrow(results_clustering), ncol=4)\n# #rna_freq <- results_clustering$rna_imseq/results_clustering$rna_reads\n# #rna_med <- median(rna_freq)\n# for (i in 1:nrow(col_mat))\n# {\n#   group <- as.character(results_clustering$clinical_group[i])\n#   exome <- results_clustering$exome_imseq[i]\n#   rna <- rna_freq[i]\n#   cluster_patient <- results_clustering$gsva_cluster[i]\n#   if (exome==0) {col_mat[i,2]=\"white\"}\n#   else {col_mat[i,2]=\"black\"}\n#   if (rna<=rna_med) {col_mat[i,3]=\"white\"}\n#   else {col_mat[i,3]=\"purple\"}\n#   if (group==\"her2+\") {col_mat[i,1]=\"red\"}\n#   else if (group==\"her2-\") {col_mat[i,1]=\"green\"}\n#   else if (group==\"triple-\") {col_mat[i,1]=\"blue\"}\n#   if (cluster_patient==1) {col_mat[i,4]=\"red\"}\n#   else if (cluster_patient==2) {col_mat[i,4]=\"green\"}\n#   else if (cluster_patient==3) {col_mat[i,4]=\"blue\"}\n# }\n# \n# ggplotColours <- function(n=6, h=c(0, 360) +15){\n#   if ((diff(h)%%360) < 1) h[2] <- h[2] - 360/n\n#   hcl(h = (seq(h[1], h[2], length = n)), c = 100, l = 65)\n# }\n# \n# brewer.pal(4, \"YlOrRd\")\n# \n# for (i in 1:nrow(col_mat))\n# {\n#   exome <- results_clustering$exome_imseq[i]\n#   cluster_patient <- results_clustering$gsva_cluster[i]\n#   #  cluster_patient <- results_clustering$mycl[i]\n#   if (exome==0) {col_mat[i,2]=\"white\"}\n#   else {col_mat[i,2]=\"black\"}\n#   if (cluster_patient==1) {col_mat[i,4]=\"#FECC5C\"}  # middle/innate\n#   else if (cluster_patient==2) {col_mat[i,4]=\"#FD8D3C\"} # middle/adaptive\n#   else if (cluster_patient==3) {col_mat[i,4]=\"#E31A1C\"} # high\n#   else if (cluster_patient==4) {col_mat[i,4]=\"#FFFFB2\"}  # low\n# }\n# \n# col_mat[,2] <- col_mat[,4]\n# col_mat[,3] <- col_mat[,4]\n# col_mat[1072,1] <- NA\n# \n# signatures <- results_clustering[,50:71] # new cdr3_results with dedup\n# rownames(signatures) <- results_clustering[,1]\n# signatures <- scale(signatures)\n# \n# signature_cols <- c(\"T Regs\", \"T CD8\", \"T CD4 Naive\", \"T CD4 Mem. Resting\", \"T CD4 Mem. Activated\",\n#                     \"T Folicular Helper\", \"T Gamma Delta\", \"B Naive\", \"B Memory\", \"Plasma\", \"NK Resting\",\n#                     \"NK Activated\", \"Monocytes\", \"Macrophages M0\", \"Macrophages M1\", \"Macrophages M2\",\n#                     \"Dendritic Resting\", \"Dendritic Activated\", \"Mast Resting\", \"Mast Activated\",\n#                     \"Eosinophils\", \"Neutrophils\")\n# \n# heatmap.plus(as.matrix(signatures), col=bluered(51), RowSideColors=col_mat, scale=\"none\",\n#              Colv=NA, labRow=\"\", cexCol=4.5, margins=c(36,6), labCol=signature_cols)\n# \n\n# es.dif_col <- c()\n# es.dif_all <- gsub(\".\", \"-\", colnames(es.dif), fixed=TRUE)\n# es.dif_all <- substr(es.dif_all,1,16)\n# #es.dif_all <- gsub(\"X\", \"\", es.dif_all, fixed=TRUE)\n# for (i in 1:nrow(cdr3))\n# {\n#   sample_id <- substr(as.character(cdr3$sample_id[i]),1,16)\n#   es.dif_index <- which(sample_id==es.dif_all)\n#   if (length(es.dif_index)>0)\n#   {\n#     es.dif_value <- es.dif[,es.dif_index]\n#     es.dif_col <- rbind(es.dif_col, es.dif_value)\n#   }\n#   else\n#   {\n#     es.dif_col <- rbind(es.dif_col, rep(NA, 22))\n#   }\n# }\n# rownames(es.dif_col) <- seq(1,nrow(cdr3))\n# cdr3_new <- cbind(cdr3, es.dif_col)\n# write.csv(cdr3_new, \"cdr3_results_with_expression_blood_ptprc_burden_purity_gsva_1078.txt\", quote=FALSE, row.names=FALSE)\n",
    "created" : 1460138678732.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3236381989",
    "id" : "B2902739",
    "lastKnownWriteTime" : 1460506428,
    "last_content_update" : 1460506428871,
    "path" : "~/tcrseq/new/rstudio/gsva_plotting.R",
    "project_path" : "gsva_plotting.R",
    "properties" : {
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}