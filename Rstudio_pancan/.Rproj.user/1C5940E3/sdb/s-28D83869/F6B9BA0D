{
    "collab_server" : "",
    "contents" : "library(stringdist)\n\n### put together both RNA and DNA\nresults_exome <- read.csv(\"/Users/Eric/tcrseq/new/processed/pancan_exome_rna_blood_tcrb_gsva_clinical_7-5-2016_exome.txt\", sep=\"\\t\")\nresults_RNA <- read.csv(\"/Users/Eric/tcrseq/new/processed/pancan_exome_rna_blood_tcrb_gsva_clinical_7-5-2016_RNA.txt\", sep=\"\\t\")\n\npatients_exome_to_add <- setdiff(as.character(results_exome$patient_uuid), as.character(results_RNA$patient_uuid))\nrownames(results_exome) <- as.character(results_exome$patient_uuid)\nrows_exome_to_add <- results_exome[patients_exome_to_add,]\nrownames(rows_exome_to_add) <- NULL\nresults_both <- rbind(results_RNA, rows_exome_to_add)\nwrite.table(results, \"/Users/Eric/tcrseq/new/processed/pancan_exome_rna_blood_tcrb_gsva_clinical_7-6-2016.txt\", sep=\"\\t\", \n            row.names=FALSE, quote=FALSE)\n\n### compare\nresults_new <- read.csv(\"/Users/Eric/tcrseq/new/processed/pancan_exome_rna_blood_tcrb_gsva_clinical_7-13-2016.txt\", sep=\"\\t\")\n\n#results_old <- read.csv(\"/Users/Eric/tcrseq/new/processed/pancan_exome_gsva_clinical_dedup.txt\", sep=\"\\t\")\nresults_old <- read.csv(\"/Users/Eric/BRCA/cdr3_results_with_expression_blood_ptprc_burden_purity_gsva_clustering_four_groups_1078.txt\", sep=\"\\t\")\n\nresults_holt <- read.csv(\"/Users/Eric/tcrseq/new/holt/TCGA_mitcr_cdr3_result_160401.tsv.datafreeze1.3.filtered.tsv\", sep=\"\\t\")\n\nclonotypes_new <- read.csv(\"/Users/Eric/tcrseq/new/processed/pancan_clonotypes_all_7-14-2016.txt\", sep=\"\\t\")\n\n### comparing to BRCA\ncomparison <- c()\ncomparison_ids <- c()\ntcr <- c()\nfor (i in 1:nrow(results_old))\n{\n  patient_id_old <- as.character(results_old$patient_id[i])\n  patient_id_match <- which(as.character(results_new$patient_uuid)==patient_id_old)\n  if (length(patient_id_match==1) && !is.na(results_old$exome_imseq[i]) \n      && !is.na(results_old$rna_imseq[i]) && !is.na(results_old$blood_cdr3[i]))\n  {\n    old_results <- results_old[i,c(\"exome_reads\", \"exome_imseq\", \"exome_clonotypes\",\n                                   \"rna_reads\", \"rna_imseq\", \"rna_clonotypes\", \"tcrb_reads\",\n                                   \"blood_reads\", \"blood_cdr3\", \"blood_clonotypes\")]\n    new_results <- results_new[patient_id_match,c(\"exome_reads\", \"exome_cdr3\", \"exome_clonotypes\",\n                                                \"rna_reads\", \"rna_cdr3\", \"rna_clonotypes\", \"tcrb_reads\",\n                                                \"blood_reads\", \"blood_cdr3\", \"blood_clonotypes\")]\n    subtraction <- as.matrix(old_results-new_results)\n    comparison <- rbind(comparison, subtraction)\n    comparison_ids <- c(comparison_ids, patient_id_old)\n    tcr <- rbind(tcr, c(old_results$tcrb_reads, new_results$tcrb_reads, old_results$rna_imseq))\n  }\n}\n\ncomparison_ids[which(comparison[,2]!=0)]\n\n### comparing to Holt\n\nclonotypes_rna <- clonotypes_new[clonotypes_new$rna>0,]\npancan_rna_unique_nuc <- as.character(unique(clonotypes_rna$clonotype))\nholt_unique_nuc <- as.character(unique(results_holt$nucSeq))\nlength(intersect(pancan_rna_unique_nuc, holt_unique_nuc))\n\npancan_rna_unique_aa <- as.character(unique(clonotypes_rna$aa))\npancan_rna_unique_aa <- pancan_rna_unique_aa[complete.cases((pancan_rna_unique_aa))]\nholt_unique_aa <- as.character(unique(results_holt$aaSeq))\nlength(intersect(pancan_rna_unique_aa, holt_unique_aa))\n\n# distances_mat <- matrix(NA, nrow=length(pancan_rna_unique_aa), ncol=3)\n# for (i in 1:length(pancan_rna_unique_aa))\n# {\n#   distances <- stringdist(pancan_rna_unique_aa[i], holt_unique_aa)\n#   distance <- min(distances)\n#   aa_holt <- holt_unique_aa[which(distances==distance)][1]\n#   aa_pancan <- pancan_rna_unique_aa[i]\n#   distances_mat[i,] <- c(distance, aa_pancan, aa_holt)\n#}\n\n#write.table(distances_mat, \"pancan_clonotypes_holt_edit_distances.txt\", quote=FALSE, row.names=FALSE, col.names=FALSE, sep=\"\\t\")\n\ndistances_mat <- read.csv(\"/Users/Eric/tcrseq/new/processed/pancan_clonotypes_holt_edit_distances.txt\", sep=\"\\t\", header=FALSE)\n\ndistances <- distances_mat[,1]\n\nhist(distances, xlab=\"Minimum string distance\", main=\"Distances with Holt\")\n\n# within distances\n# distances_mat <- matrix(NA, nrow=length(pancan_rna_unique_aa), ncol=3)\n# for (i in 1:length(pancan_rna_unique_aa))\n# {\n#   pancan_rna_unique_without <- pancan_rna_unique_aa[-i]\n#   distances <- stringdist(pancan_rna_unique_aa[i], pancan_rna_unique_without)\n#   distance <- min(distances)\n#   aa_without <- pancan_rna_unique_without[which(distances==distance)][1]\n#   aa_pancan <- pancan_rna_unique_aa[i]\n#   distances_mat[i,] <- c(distance, aa_pancan, aa_without)\n# }\n# \n# \n# write.table(distances_mat, \"pancan_clonotypes_within_edit_distances.txt\", quote=FALSE, row.names=FALSE, col.names=FALSE, sep=\"\\t\")\n\ndistances_mat <- read.csv(\"/Users/Eric/tcrseq/new/processed/pancan_clonotypes_within_edit_distances.txt\", sep=\"\\t\", header=FALSE)\n\ndistances <- distances_mat[,1]\n\nhist(distances, xlab=\"Minimum string distance\", main=\"Distances within pancan\")\n\n# compare to Li\nli_file <- \"/Users/Eric/tcrseq/new/li/Supplementary_Table_1.fa\"\ncon <- file(li_file, open=\"r\")\nlines <- readLines(con)\nclose(con, type=\"r\")\n\npancan_rna_aa_c_f <- c()\nfor (i in 1:length(pancan_rna_unique_aa))\n{\n  aa <- pancan_rna_unique_aa[i]\n  first <- regexpr(\"C\", aa)\n  last <- regexpr(\"F\", aa)\n  if (first != -1 && last != -1 && first<last) {\n    aa_c_f <- substr(aa, first, last)\n    pancan_rna_aa_c_f <- c(pancan_rna_aa_c_f, aa_c_f)\n  }\n}\n\nli_table <- matrix(data=NA, nrow=length(lines)/2, ncol=2)\nheader <- c()\nfor (i in 1:length(lines))\n{\n  line <- lines[i]\n  if (substr(line, 1, 1) == \">\") {\n    header <- line\n  } else {\n    li_table[i/2,] <- c(header, line)\n  }\n}\n\nli_aa <- unique(li_table[,2])\nli_aa_c_f <- c()\nfor (i in 1:length(li_aa))\n{\n  aa <- li_aa[i]\n  first <- regexpr(\"C\", aa)\n  last <- regexpr(\"F\", aa)\n  if (first != -1 && last != -1 && first<last) {\n    aa_c_f <- substr(aa, first, last)\n    li_aa_c_f <- c(li_aa_c_f, aa_c_f)\n    }\n}\npancan_rna_aa_c_f_unique <- unique(pancan_rna_aa_c_f)\nli_aa_c_f_unique <- unique(li_aa_c_f)\nlength(intersect(pancan_rna_aa_c_f_unique, li_aa_c_f_unique))\n\ndistances_mat <- matrix(NA, nrow=length(pancan_rna_aa_c_f_unique), ncol=3)\nfor (i in 1:length(pancan_rna_aa_c_f_unique))\n{\n  distances <- stringdist(pancan_rna_aa_c_f_unique[i], li_aa_c_f_unique)\n  distance <- min(distances)\n  aa_li <- li_aa_c_f_unique[which(distances==distance)][1]\n  aa_pancan <- pancan_rna_aa_c_f_unique[i]\n  distances_mat[i,] <- c(distance, aa_pancan, aa_li)\n}\n\nwrite.table(distances_mat, \"/Users/Eric/tcrseq/new/processed/pancan_clonotypes_li_edit_distances.txt\", quote=FALSE, row.names=FALSE, col.names=FALSE, sep=\"\\t\")\n\ndistances_mat <- read.csv(\"/Users/Eric/tcrseq/new/processed/pancan_clonotypes_li_edit_distances.txt\", sep=\"\\t\", header=FALSE)\n\nhist(distances_mat[,1], main=\"Histogram of string distances\", xlab=\"String distance\")\n  \n  \n  ",
    "created" : 1465420172997.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2195822848",
    "id" : "F6B9BA0D",
    "lastKnownWriteTime" : 1469047580,
    "last_content_update" : 1469047580648,
    "path" : "~/tcrseq/new/rstudio/data_comparisons.R",
    "project_path" : "data_comparisons.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 3,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}