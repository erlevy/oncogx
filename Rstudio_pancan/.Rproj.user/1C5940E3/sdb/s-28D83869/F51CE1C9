{
    "collab_server" : "",
    "contents" : "library(dplyr)\nlibrary(ggplot2)\n\n#copying the data into working table\nlymphocyte_results_table_with_clonotypes <- read.csv(\"/Users/Eric/tcrseq/new/processed/pancan_exome_gsva_clinical_dedup.txt\", sep=\"\\t\")\n\n#pancancer<-lymphocyte_results_table\npancancer<-lymphocyte_results_table_with_clonotypes\n\n# calculating RPM\npancancer<-mutate(pancancer,exome_rpm=exome_imseq*10^6/exome_reads)\nggplot(pancancer,aes(cancer_type,log10(exome_rpm),fill=cancer_type))+geom_violin()+geom_boxplot(width=0.1,fill=\"black\")\n\n#calculating iDNAscore\n\ntmp<-select(filter(pancancer,exome_rpm!=0),patient_id,exome_rpm)\ntmp<-mutate(tmp,iDNA_score=ntile(exome_rpm,10))\npancancer<-left_join(pancancer,tmp)\npancancer<-mutate(pancancer,iDNA_score=ifelse(is.na(iDNA_score),0,iDNA_score))\n\n#aggregating\npancan_aggregate<-aggregate(patient_id~iDNA_score+cancer_type,data=pancancer,FUN=length)\ncancer_type_agg<-aggregate(patient_id~cancer_type,data=pancancer,FUN=length)\ncancer_type_agg<-rename(cancer_type_agg,Total=patient_id)\npancan_aggregate<-rename(pancan_aggregate,Num=patient_id)\npancan_aggregate<-left_join(pancan_aggregate,cancer_type_agg)\npancan_aggregate<-mutate(pancan_aggregate,fraction=Num/Total)\n\n#aggregating CDR3>0\npancan_aggregate_wCDR3<-aggregate(patient_id~iDNA_score+cancer_type,data=filter(pancancer,iDNA_score>0),FUN=length)\ncancer_type_agg_wCDR3<-aggregate(patient_id~cancer_type,data=filter(pancancer,iDNA_score>0),FUN=length)\ncancer_type_agg_wCDR3<-rename(cancer_type_agg_wCDR3,Total=patient_id)\npancan_aggregate_wCDR3<-rename(pancan_aggregate_wCDR3,Num=patient_id)\npancan_aggregate_wCDR3<-left_join(pancan_aggregate_wCDR3,cancer_type_agg)\npancan_aggregate_wCDR3<-mutate(pancan_aggregate_wCDR3,fraction=Num/Total)\n\n#plot CDR3 nonNull\ntmp<-filter(pancan_aggregate,iDNA_score==0)\ntmp$cancer_type<-factor(tmp$cancer_type, levels = tmp$cancer_type[order(tmp$fraction)])\ntmp<-mutate(tmp,color=ifelse(cancer_type==\"BRCA\"|cancer_type==\"PAAD\"|cancer_type==\"LUAD\"|cancer_type==\"PRAD\",\"red\",\"black\"))\n#tmp$color<-factor(tmp$color, levels = tmp$color[order(tmp$fraction)])\nggplot(tmp,aes(cancer_type,1-(Num/Total)))+geom_bar(stat=\"identity\",fill=tmp$color[order(tmp$fraction)])+theme_classic(base_size=20)+theme(axis.line.x=element_line(size=2),axis.line.y=element_line(size=2),axis.ticks.x=element_line(size=2),axis.ticks.y=element_line(size=2),axis.text.x=element_text(angle=90, hjust = 1))+ylab(\"Fraction of patients with iDNA\")\n\n#plot the CDR3 positive\nggplot(filter(pancan_aggregate,iDNA_score==0),aes(cancer_type,Num/Total))+geom_bar(stat=\"identity\")\nggplot(filter(pancan_aggregate,iDNA_score>0),aes(as.factor(iDNA_score),Num/Total))+geom_bar(stat=\"identity\")+facet_wrap(~cancer_type)\n\n#plot all\n#ggplot(pancancer,aes(factor(iDNA_score),log10(exome_rpm),color=cancer_type))+geom_point()+geom_jitter()+theme_classic(base_size=20)+theme(axis.line.x=element_line(size=2),axis.line.y=element_line(size=2),axis.ticks.x=element_line(size=2),axis.ticks.y=element_line(size=2))+ylab(\"CDR3 abundance (log10(RPM))\")+xlab(\"iDNA score\")\n\n#plot\ntmp2<-aggregate(exome_reads~cancer_type,data=pancancer,FUN=mean)\ncancer_type_agg$exome_reads<-tmp2$exome_reads\ntmp3<-filter(pancan_aggregate,iDNA_score==0)\ntmp3<-rename(tmp3,noCDR3=Num)\ncancer_type_agg_iDNA0<-left_join(cancer_type_agg,tmp3)\nggplot(cancer_type_agg_iDNA0,aes(log10(exome_reads),1-fraction,label=cancer_type))+geom_point(aes(size=Total,color=tmp$color))+geom_text(hjust=-0.1,size=6)+theme_classic(base_size=32)+theme(axis.line.x=element_line(size=2),axis.line.y=element_line(size=2),axis.ticks.x=element_line(size=2),axis.ticks.y=element_line(size=2))+ylab(\"Fraction of patients with iDNA\")+xlab(\"Number of reads (log10)\")\n\n\n#plot four\nggplot(filter(pancancer,(cancer_type==\"PAAD\" | cancer_type==\"BRCA\" | cancer_type==\"LUAD\" | cancer_type==\"PRAD\") & iDNA_score>0),aes(cancer_type,log10(exome_rpm),fill=cancer_type))+geom_violin()+geom_boxplot(width=0.1,fill=\"black\")+theme_classic(base_size=20)+theme(axis.line.x=element_line(size=2),axis.line.y=element_line(size=2),axis.ticks.x=element_line(size=2),axis.ticks.y=element_line(size=2))+ylab(\"CDR3 abundance (log10(RPM))\")+xlab(\"\")\n\n#plot diversity\n\nggplot(pancancer,aes(exome_clonotypes/exome_rpm,fill=cancer_type))+geom_boxplot()\n\n\n",
    "created" : 1464211539634.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "524744062",
    "id" : "F51CE1C9",
    "lastKnownWriteTime" : 1464211914,
    "last_content_update" : 1464211914307,
    "path" : "~/tcrseq/new/rstudio/Analysis.R",
    "project_path" : "Analysis.R",
    "properties" : {
    },
    "relative_order" : 10,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}