{
    "collab_server" : "",
    "contents" : "library(OIsurv)\nlibrary(cgdsr)\nlibrary(cluster)\nlibrary(fpc)\nlibrary(gplots)\nlibrary(heatmap.plus)\nlibrary(reshape)\n\nresults <- read.csv(\"/Users/Eric/tcrseq/new/processed/pancan_exome_rna_gsva_clinical_6-14-2016.txt\", sep=\"\\t\")\n\n### FROM OLD BRCA ###\n#set the table working on\nlibrary(dplyr)\nlibrary(ggplot2)\n\ncdr3_results_current<-results\n\n#renaming groups\n#cdr3_results_current<-mutate(cdr3_results_current,clinical_group=ifelse(clinical_group==\"her2-\",\"HR+/Her2-\",as.character(clinical_group)))\n#cdr3_results_current<-mutate(cdr3_results_current,clinical_group=ifelse(clinical_group==\"her2+\",\"Her2+\",as.character(clinical_group)))\n#cdr3_results_current<-mutate(cdr3_results_current,clinical_group=ifelse(clinical_group==\"triple-\",\"TNBC\",as.character(clinical_group)))\n\n# calculating the iDNA score, rna_rpm, R and D groups\ncdr3_results_current<-mutate(cdr3_results_current,exome_rpm=exome_cdr3*10^6/exome_reads)\ntmp<-select(filter(cdr3_results_current,exome_rpm!=0),patient_uuid,exome_rpm)\ntmp<-mutate(tmp,iDNA_score=ntile(exome_rpm,10))\ncdr3_results_current<-left_join(cdr3_results_current,tmp)\ncdr3_results_current<-mutate(cdr3_results_current,iDNA_score=ifelse(is.na(iDNA_score),0,iDNA_score))\n\ncdr3_results_current<-mutate(cdr3_results_current,rna_rpm=rna_cdr3*10^6/rna_reads)\ncdr3_results_current<-mutate(cdr3_results_current,D=ifelse(exome_rpm==0,\"D-\",\"D+\"),R=ifelse(rna_rpm==0,\"R-\",\"R+\"))\n#cdr3_results_current<-mutate(cdr3_results_current,blood_rpm=blood_cdr3*10^6/blood_reads)\n#cdr3_results_current<-mutate(cdr3_results_current,tcrb_rpm=tcrb_reads*10^6/rna_reads)\n\n#fraction of 5% TILs in each bin\n\n#cdr3_results_current %>% group_by(iDNA_score) %>% summarize(length(percent_tils[percent_tils>=5])/length(percent_tils))\n\n#association with TIL content\n#wilcox.test(as.vector(unlist(select(filter(cdr3_results_current,percent_tils<=2),exome_rpm))),as.vector(unlist(select(filter(cdr3_results_current,percent_tils>2),exome_rpm))))\n\n# comparing D+R+\n#tmp<-select(mutate(cdr3_results_current,D=ifelse(exome_rpm==0,\"D-\",\"D+\"),R=ifelse(rna_rpm==0,\"R-\",\"R+\")),D,R)\n\n#table(interaction(cdr3_results_current$D,cdr3_results_current$R))\n\n#################################################\n#Plotting \n#######################################\n\n#figure RNA vs DNA\nggplot(filter(cdr3_results_current,rna_rpm>0),aes(factor(reorder(iDNA_score,as.numeric(iDNA_score))),log10(rna_rpm)))+geom_boxplot(fill=\"grey\")+theme(text=element_text(size=32))+xlab(\"iDNA score\")+ylab(\"log10(RNA CDR3(RPM))\")+theme_classic(base_size = 24)\n\n# figure FracRNA pos vs DNA\nfrac_withRNA<-aggregate(rna_rpm~iDNA_score,data=filter(cdr3_results_current,!is.na(rna_rpm)),FUN=function(x) length(x[x>0.0255])/length(x))\nggplot(frac_withRNA,aes(factor(reorder(iDNA_score,as.numeric(iDNA_score))),rna_rpm))+geom_bar(stat=\"identity\")+theme(text=element_text(size=32))+xlab(\"iDNA score\")+ylab(\"Fraction of tumors \\n with high RNA CDR3 RPM\")+theme_classic(base_size = 24)\n\n#figure FracTIL vs DNA\nfrac_withTILs<-aggregate(percent_tils~iDNA_score,data=cdr3_results_current,FUN=function(x) length(x[x>=5])/length(x))\nggplot(frac_withTILs,aes(factor(reorder(iDNA_score,as.numeric(iDNA_score))),percent_tils))+geom_bar(stat=\"identity\")+theme(text=element_text(size=32))+xlab(\"iDNA score\")+ylab(\"Fraction of tumors with ≥5% TILs\")+theme_classic(base_size = 24)\n\n# distribution by clinical groups\nggplot(cdr3_results_current,aes(as.factor(iDNA_score),fill=cohort))+geom_bar(position=\"fill\")+theme_classic(base_size = 24)+ylab(\"Fraction of tumors\")+xlab(\"iDNA score\")+theme(legend.title=element_blank())\n\n#figurre TIL ave vs DNA\n#ggplot(cdr3_results_with_groups,aes(factor(reorder(tile.y,as.numeric(tile.y))),percent_tils))+geom_boxplot()+theme(text=element_text(size=32))+xlab(\"DNA CDR3(RPM) bin (increasing)\")+ylab(\"percent TILs\")\n\n# # figure FracPurity vs DNA\n# frac_pure<-aggregate(patient_purity~iDNA_score,data=cdr3_results_current,FUN=function(x) length(x[x>=0.80])/length(x))\n# ggplot(frac_pure,aes(factor(reorder(iDNA_score,as.numeric(iDNA_score))),patient_purity))+geom_bar(stat=\"identity\")+theme(text=element_text(size=32))+xlab(\"iDNA score\")+ylab(\"Fraction of tumors with ≥80% purity\")+theme_classic(base_size = 24)\n# \n# # figure FracNon vs DNA\n# frac_non<-aggregate(rate_non~iDNA_score,data=cdr3_results_current,FUN=function(x) length(x[x>=8.323135e-07])/length(x))\n# ggplot(frac_non,aes(factor(reorder(iDNA_score,as.numeric(iDNA_score))),rate_non))+geom_bar(stat=\"identity\")+theme(text=element_text(size=32))+xlab(\"iDNA score\")+ylab(\"Fraction of tumors with high nonsyn\")+theme_classic(base_size = 24)\n# \n# # distribution by mRNAseq clusters\n# cdr3_results_mRNA_clusters <- cdr3_results_current[!(is.na(cdr3_results_current$CLUS_mRNAseq_cNMF)),]\n# mode(cdr3_results_mRNA_clusters$CLUS_mRNAseq_cNMF) <- \"character\"\n# ggplot(cdr3_results_mRNA_clusters,aes(as.factor(iDNA_score),fill=CLUS_mRNAseq_cNMF))+geom_bar(position=\"fill\")+theme_classic(base_size = 24)+ylab(\"Fraction of tumors\")+xlab(\"iDNA score\")+theme(legend.title=element_blank())+scale_fill_manual(values=c(\"blue\", \"red\", \"black\"))\n# \n# # distribution by methylation clusters\n# cdr3_results_methylation_clusters <- cdr3_results_current[!(is.na(cdr3_results_current$CLUS_Methlyation_cNMF)),]\n# mode(cdr3_results_methylation_clusters$CLUS_Methlyation_cNMF) <- \"character\"\n# ggplot(cdr3_results_methylation_clusters,aes(as.factor(iDNA_score),fill=CLUS_Methlyation_cNMF))+geom_bar(position=\"fill\")+theme_classic(base_size = 24)+ylab(\"Fraction of tumors\")+xlab(\"iDNA score\")+theme(legend.title=element_blank())+scale_fill_manual(values=c(\"gray16\", \"gray32\", \"gray48\", \"red\", \"gray64\", \"gray80\"))\n# \n# # figure cytolytic vs DNA\n# frac_cyto<-aggregate(cytolytic~iDNA_score,data=cdr3_results_current,FUN=function(x) length(x[x>=72.48])/length(x))\n# ggplot(frac_cyto,aes(factor(reorder(iDNA_score,as.numeric(iDNA_score))),cytolytic))+geom_bar(stat=\"identity\")+theme(text=element_text(size=32))+xlab(\"iDNA score\")+ylab(\"Fraction of tumors with high cytolytic activity\")+theme_classic(base_size = 24)\n# \n# # distribution by gsva clusters\n# cdr3_results_current$gsva_cluster <- as.factor(cdr3_results_current$gsva_cluster)\n# ggplot(cdr3_results_current,aes(as.factor(iDNA_score),fill=gsva_cluster))+geom_bar(position=\"fill\")+theme_classic(base_size = 24)+ylab(\"Fraction of tumors\")+xlab(\"iDNA score\")+theme(legend.title=element_blank())+scale_fill_manual(values=c(\"blue\", \"red\", \"black\"))\n# \n# ### associations uncovered by linear models ###\n# restriction_cdr3_columns <- c(\"iDNA_score\", \"foxp3\", \"rate_non\", \"rna_rpm\", \"blood_rpm\", \"clinical_group\")\n# cdr3_results_cdr3_restricted <- cdr3_results_current[,restriction_cdr3_columns]\n# cdr3_results_cdr3_restricted <- cdr3_results_cdr3_restricted[complete.cases(cdr3_results_cdr3_restricted),]\n# \n# ### cdr3\n# # frac foxp3 vs idna\n# frac_foxp3<-aggregate(foxp3~iDNA_score,data=cdr3_results_cdr3_restricted,FUN=function(x) length(x[x>=53.21])/length(x))\n# ggplot(frac_foxp3,aes(factor(reorder(iDNA_score,as.numeric(iDNA_score))),foxp3))+geom_bar(stat=\"identity\")+theme(text=element_text(size=32))+xlab(\"iDNA score\")+ylab(\"Fraction of tumors with high foxp3\")+theme_classic(base_size = 24)\n# \n# # figure FracNon vs DNA\n# frac_non<-aggregate(rate_non~iDNA_score,data=cdr3_results_cdr3_restricted,FUN=function(x) length(x[x>=8.323135e-07])/length(x))\n# ggplot(frac_non,aes(factor(reorder(iDNA_score,as.numeric(iDNA_score))),rate_non))+geom_bar(stat=\"identity\")+theme(text=element_text(size=32))+xlab(\"iDNA score\")+ylab(\"Fraction of tumors with high nonsyn\")+theme_classic(base_size = 24)\n# \n# # frac rna_rpm vs idna\n# frac_rna<-aggregate(rna_rpm~iDNA_score,data=cdr3_results_cdr3_restricted,FUN=function(x) length(x[x>=0.028650])/length(x))\n# ggplot(frac_rna,aes(factor(reorder(iDNA_score,as.numeric(iDNA_score))),rna_rpm))+geom_bar(stat=\"identity\")+theme(text=element_text(size=32))+xlab(\"iDNA score\")+ylab(\"Fraction of tumors with high rna rpm\")+theme_classic(base_size = 24)\n# \n# # frac blood_rpm vs idna\n# frac_blood<-aggregate(blood_rpm~iDNA_score,data=cdr3_results_cdr3_restricted,FUN=function(x) length(x[x>=0.014250])/length(x))\n# ggplot(frac_blood,aes(factor(reorder(iDNA_score,as.numeric(iDNA_score))),blood_rpm))+geom_bar(stat=\"identity\")+theme(text=element_text(size=32))+xlab(\"iDNA score\")+ylab(\"Fraction of tumors with high blood_rpm\")+theme_classic(base_size = 24)\n# \n# # distribution by clinical groups\n# ggplot(filter(cdr3_results_cdr3_restricted,clinical_group!=\"other\"),aes(as.factor(iDNA_score),fill=clinical_group))+geom_bar(position=\"fill\")+theme_classic(base_size = 24)+ylab(\"Fraction of tumors\")+xlab(\"iDNA score\")+theme(legend.title=element_blank())+scale_fill_manual(values=c(\"blue\", \"red\", \"black\"))\n# \n# ### cytolytic\n# restriction_cytolytic_columns <- c(\"cytolytic_score\", \"tcrb_rpm\", \"cd4\", \"cd8a\", \"foxp3\", \"rna_rpm\", \"clinical_group\")\n# cdr3_results_cytolytic_restricted <- cdr3_results_current[,restriction_cytolytic_columns]\n# cdr3_results_cytolytic_restricted <- cdr3_results_cytolytic_restricted[complete.cases(cdr3_results_cytolytic_restricted),]\n# \n# # frac tcrb vs cytolytic\n# frac_tcrb<-aggregate(tcrb_rpm~cytolytic_score,data=cdr3_results_cytolytic_restricted,FUN=function(x) length(x[x>=30.560])/length(x))\n# ggplot(frac_tcrb,aes(factor(reorder(cytolytic_score,as.numeric(cytolytic_score))),tcrb_rpm))+geom_bar(stat=\"identity\")+theme(text=element_text(size=32))+xlab(\"cytolytic score\")+ylab(\"Fraction of tumors with high tcrb\")+theme_classic(base_size = 24)\n# \n# # figure cd4 vs cytolytic\n# frac_cd4<-aggregate(cd4~cytolytic_score,data=cdr3_results_cytolytic_restricted,FUN=function(x) length(x[x>=1102])/length(x))\n# ggplot(frac_cd4,aes(factor(reorder(cytolytic_score,as.numeric(cytolytic_score))),cd4))+geom_bar(stat=\"identity\")+theme(text=element_text(size=32))+xlab(\"cytolytic score\")+ylab(\"Fraction of tumors with high cd4\")+theme_classic(base_size = 24)\n# \n# # frac cd8a vs cytolytic\n# frac_cd8a<-aggregate(cd8a~cytolytic_score,data=cdr3_results_cytolytic_restricted,FUN=function(x) length(x[x>=159.6])/length(x))\n# ggplot(frac_cd8a,aes(factor(reorder(cytolytic_score,as.numeric(cytolytic_score))),cd8a))+geom_bar(stat=\"identity\")+theme(text=element_text(size=32))+xlab(\"cytolytic score\")+ylab(\"Fraction of tumors with high cd8a\")+theme_classic(base_size = 24)\n# \n# # frac foxp3 vs cytolytic\n# frac_foxp3<-aggregate(foxp3~cytolytic_score,data=cdr3_results_cytolytic_restricted,FUN=function(x) length(x[x>=56.3600])/length(x))\n# ggplot(frac_foxp3,aes(factor(reorder(cytolytic_score,as.numeric(cytolytic_score))),foxp3))+geom_bar(stat=\"identity\")+theme(text=element_text(size=32))+xlab(\"cytolytic score\")+ylab(\"Fraction of tumors with high foxp3\")+theme_classic(base_size = 24)\n# \n# # frac rna_rpm vs cytolytic\n# frac_rna<-aggregate(rna_rpm~cytolytic_score,data=cdr3_results_cytolytic_restricted,FUN=function(x) length(x[x>=0.027990])/length(x))\n# ggplot(frac_rna,aes(factor(reorder(cytolytic_score,as.numeric(cytolytic_score))),rna_rpm))+geom_bar(stat=\"identity\")+theme(text=element_text(size=32))+xlab(\"cytolytic score\")+ylab(\"Fraction of tumors with high rna rpm\")+theme_classic(base_size = 24)\n# \n# # distribution by clinical groups\n# ggplot(filter(cdr3_results_cytolytic_restricted,clinical_group!=\"other\"),aes(as.factor(cytolytic_score),fill=clinical_group))+geom_bar(position=\"fill\")+theme_classic(base_size = 24)+ylab(\"Fraction of tumors\")+xlab(\"cytolytic score\")+theme(legend.title=element_blank())+scale_fill_manual(values=c(\"blue\", \"red\", \"black\"))\n# \n# \n# # output supp table\n# cols <- c(\"sample_id\", \"exome_reads\", \"exome_imseq\", \"exome_clonotypes\", \"iDNA_score\")\n# output <- cdr3_results_current[,cols]\n# output$sample_id <- substr(output$sample_id, 1, 16)\n# write.table(output, \"tcrseq_brca_output_table.txt\", quote=FALSE, sep=\"\\t\")\n\n### intial analysis\ntable(cdr3_results_current$cohort)\nsum(!is.na(cdr3_results_current$exome_cdr3))\nsum(!is.na(cdr3_results_current$rna_cdr3))\nsummary(cdr3_results_current$exome_cdr3)\nsummary(cdr3_results_current$rna_cdr3)\nlength(which(cdr3_results_current$exome_cdr3==0))\nlength(which(cdr3_results_current$rna_cdr3==0))\ntable(cdr3_results_current[,c(\"D\", \"R\")])\n\ncohorts <- split(cdr3_results_current, cdr3_results_current$cohort)\ncohorts_limited_df <- rbind(cohorts$BLCA, cohorts$BRCA, cohorts$COAD, cohorts$GBM,\n                        cohorts$HNSC, cohorts$LGG, cohorts$LUAD, cohorts$LUSC,\n                        cohorts$OV, cohorts$PRAD, cohorts$STAD, cohorts$THCA)\ncohorts_limited_list <- list(cohorts$BLCA, cohorts$BRCA, cohorts$COAD, cohorts$GBM,\n                            cohorts$HNSC, cohorts$LGG, cohorts$LUAD, cohorts$LUSC,\n                            cohorts$OV, cohorts$PRAD, cohorts$STAD, cohorts$THCA)\ncohorts_limited_df$cohort <- factor(cohorts_limited_df$cohort)\nboxplot(exome_reads ~ cohort, data=cdr3_results_current)\nboxplot(exome_cdr3 ~ cohort, data=cdr3_results_current)\nboxplot(log(rna_cdr3, 10) ~ cohort, data=cdr3_results_current)\nboxplot(log(rna_rpm, 10) ~ cohort, data=cdr3_results_current)\nboxplot(percent_tils ~ cohort, data=cdr3_results_current)\n\ncohorts_limited_df$exome_cdr3[which(cohorts_limited$exome_cdr3==0)] <- NA\ncohorts_limited_df$rna_cdr3[which(cohorts_limited$rna_cdr3==0)] <- NA\nboxplot(log(exome_cdr3,10) ~ cohort, data=cohorts_limited_df)\nboxplot(log(rna_cdr3,10) ~ cohort, data=cohorts_limited_df)\n\ncdr3_profile <- function(cdr3_results)\n{\n  c(mean(cdr3_results$exome_cdr3, na.rm = TRUE), max(cdr3_results$exome_cdr3, na.rm = TRUE),\n    mean(cdr3_results$rna_cdr3, na.rm = TRUE), max(cdr3_results$rna_cdr3, na.rm = TRUE),\n    length(which(cdr3_results$exome_cdr3==0)), length(which(cdr3_results$rna_cdr3==0)))\n}\n\ncohorts_limited_profiling <- lapply(cohorts_limited_list, cdr3_profile)\ndf <- do.call(\"rbind\", cohorts_limited_profiling)\nwrite.table(df, \"12_cohorts_profiling.txt\", sep=\"\\t\", quote=FALSE, row.names=FALSE, col.names=FALSE)\n\n### survival\n### process days\ncdr3_results_surv <- c()\nfor (i in 1:nrow(cdr3_results_current))\n{\n  surv_row <- rep(NA, 3)\n  idna <- cdr3_results_current$iDNA_score[i]\n  days_to_death <- cdr3_results_current$days_to_death[i]\n  days_to_last_followup <- cdr3_results_current$days_to_last_followup[i]\n  vital <- NA\n  days <- NA\n  if (idna>0) {idna <- 1}\n  if (!is.na(days_to_death)) {\n    days <- days_to_death\n    vital <- 1\n  } else if (!is.na(days_to_last_followup)) {\n    days <- days_to_last_followup\n    vital <- 0\n    }\n  surv_row <- c(idna, days, vital)\n  cdr3_results_surv <- rbind(cdr3_results_surv, surv_row)\n}\ncolnames(cdr3_results_surv) <- c(\"iDNA_nonzero\", \"days_compound\", \"vital_status\")\nrownames(cdr3_results_surv) <- seq(1:nrow(cdr3_results_surv))\ncdr3_results_surv <- cbind(cdr3_results_current, cdr3_results_surv)\n\nsurv_results <- function(surv_matrix)\n{\n  surv <- surv_matrix[,c(\"iDNA_nonzero\", \"days_compound\", \"vital_status\")]\n  surv$days_compound <- surv_matrix$days_compound/365\n  my.surv <- Surv(as.numeric(surv[,2]), as.numeric(surv[,3]))\n  my.fit <- survfit(my.surv ~ surv[,1])\n#  plot(my.fit, col=c(1,2), main=\"Survival of HR+ by CDR3 groups\", xlab=\"Survival Time (years)\", ylab=\"Survival Probability\")\n#  legend(0.5,0.4, c(\"nonzero\", \"zero\"), fill=c(1,2), cex=0.75)\n  coxph(my.surv ~ surv[,1], method=\"breslow\")  \n}\n\ntypes <- split(cdr3_results_surv, cdr3_results_surv$cohort)\ntypes_surv <- lapply(types, surv_results)\n\n# looks like only COAD is significant\n# close: SKCM, CESC, ACC\nsurv_matrix <- types$COAD\nsurv <- surv_matrix[,c(\"iDNA_nonzero\", \"days_compound\", \"vital_status\")]\nsurv$days_compound <- surv_matrix$days_compound/365\nmy.surv <- Surv(as.numeric(surv[,2]), as.numeric(surv[,3]))\nmy.fit <- survfit(my.surv ~ surv[,1])\nplot(my.fit, col=c(1,2), main=\"Survival of COAD by CDR3 presence\", xlab=\"Survival Time (years)\", ylab=\"Survival Probability\")\nlegend(5,0.4, c(\"nonzero\", \"zero\"), fill=c(1,2), cex=0.75)\ncoxph(my.surv ~ surv[,1], method=\"breslow\")  \n\nsurv_matrix <- types$SKCM\nsurv <- surv_matrix[,c(\"iDNA_nonzero\", \"days_compound\", \"vital_status\")]\nsurv$days_compound <- surv_matrix$days_compound/365\nmy.surv <- Surv(as.numeric(surv[,2]), as.numeric(surv[,3]))\nmy.fit <- survfit(my.surv ~ surv[,1])\nplot(my.fit, col=c(1,2), main=\"Survival of SKCM by CDR3 presence\", xlab=\"Survival Time (years)\", ylab=\"Survival Probability\")\nlegend(1,0.4, c(\"nonzero\", \"zero\"), fill=c(1,2), cex=0.75)\ncoxph(my.surv ~ surv[,1], method=\"breslow\")  \n\nsurv_matrix <- types$CESC\nsurv <- surv_matrix[,c(\"iDNA_nonzero\", \"days_compound\", \"vital_status\")]\nsurv$days_compound <- surv_matrix$days_compound/365\nmy.surv <- Surv(as.numeric(surv[,2]), as.numeric(surv[,3]))\nmy.fit <- survfit(my.surv ~ surv[,1])\nplot(my.fit, col=c(1,2), main=\"Survival of CESC by CDR3 presence\", xlab=\"Survival Time (years)\", ylab=\"Survival Probability\")\nlegend(8,0.4, c(\"nonzero\", \"zero\"), fill=c(1,2), cex=0.75)\ncoxph(my.surv ~ surv[,1], method=\"breslow\")  \n\nsurv_matrix <- types$ACC\nsurv <- surv_matrix[,c(\"iDNA_nonzero\", \"days_compound\", \"vital_status\")]\nsurv$days_compound <- surv_matrix$days_compound/365\nmy.surv <- Surv(as.numeric(surv[,2]), as.numeric(surv[,3]))\nmy.fit <- survfit(my.surv ~ surv[,1])\nplot(my.fit, col=c(1,2), main=\"Survival of ACC by CDR3 presence\", xlab=\"Survival Time (years)\", ylab=\"Survival Probability\")\nlegend(5,0.4, c(\"nonzero\", \"zero\"), fill=c(1,2), cex=0.75)\ncoxph(my.surv ~ surv[,1], method=\"breslow\")  \n\n### gsva pca\ncdr3_results_gsva <- cdr3_results_current[,c(3, 16:37)]\ncdr3_results_gsva <- cdr3_results_gsva[complete.cases(cdr3_results_gsva),]\ncdr3_results_gsva_cohorts <- cdr3_results_gsva$cohort\ncdr3_results_gsva <- t(cdr3_results_gsva[,-1])\npca <- prcomp(cdr3_results_gsva)\nplot(pca[[2]][,1], pca[[2]][,2], col=cdr3_results_gsva_cohorts)\n\n### rna vs. dna clonal diversity\ncdr3_results_clonality <-mutate(cdr3_results_current,exome_clonality=exome_clonotypes/exome_rpm)\ncdr3_results_clonality <-mutate(cdr3_results_clonality,rna_clonality=rna_clonotypes/rna_rpm)\nplot(cdr3_results_clonality$exome_rpm, cdr3_results_clonality$exome_clonotypes)\nplot(cdr3_results_clonality$rna_rpm, cdr3_results_clonality$rna_clonotypes)\nplot(cdr3_results_clonality$exome_clonality, cdr3_results_clonality$rna_clonality)\n\ncohorts_limited_df <- rbind(cohorts$BRCA, cohorts$HNSC,cohorts$LUAD, cohorts$LUSC,\n                            cohorts$OV, cohorts$STAD)\ncohorts_limited_df$cohort <- factor(cohorts_limited_df$cohort)\ncdr3_results_clonality <-mutate(cohorts_limited_df,exome_clonality=exome_clonotypes/exome_rpm)\ncdr3_results_clonality <-mutate(cdr3_results_clonality,rna_clonality=rna_clonotypes/rna_rpm)\nplot(cdr3_results_clonality$exome_clonality, cdr3_results_clonality$rna_clonality,\n     col=c(\"blue\", \"red\", \"black\", \"purple\", \"green\", \"lightblue\"), pch=16,\n     main=\"Clonal diversity of RNA vs. DNA\", xlab=\"Exome clonal diversity\", ylab=\"RNA clonal diversity\")\nlegend(x=400, y=500, legend=levels(cdr3_results_clonality$cohort), pch=16,\n       col=c(\"blue\", \"red\", \"black\", \"purple\", \"green\", \"lightblue\"))\n\n",
    "created" : 1468472052185.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3548832822",
    "id" : "766445D2",
    "lastKnownWriteTime" : 1465964367,
    "last_content_update" : 1465964367,
    "path" : "~/tcrseq/new/rstudio/data_analysis.R",
    "project_path" : "data_analysis.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 6,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}