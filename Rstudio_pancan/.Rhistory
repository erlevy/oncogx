### survival
### process days
cdr3_results_surv <- c()
for (i in 1:nrow(cdr3_results_current))
{
surv_row <- rep(NA, 3)
idna <- cdr3_results_current$iDNA_score[i]
days_to_death <- cdr3_results_current$days_to_death[i]
days_to_last_followup <- cdr3_results_current$days_to_last_followup[i]
vital <- NA
days <- NA
if (idna>0) {idna <- 1}
if (!is.na(days_to_death)) {
days <- days_to_death
vital <- 1
} else if (!is.na(days_to_last_followup)) {
days <- days_to_last_followup
vital <- 0
}
surv_row <- c(idna, days, vital)
cdr3_results_surv <- rbind(cdr3_results_surv, surv_row)
}
colnames(cdr3_results_surv) <- c("iDNA_nonzero", "days_compound", "vital_status")
rownames(cdr3_results_surv) <- seq(1:nrow(cdr3_results_surv))
cdr3_results_surv <- cbind(cdr3_results_current, cdr3_results_surv)
surv_results <- function(surv_matrix)
{
surv <- surv_matrix[,c("iDNA_nonzero", "days_compound", "vital_status")]
surv$days_compound <- surv_matrix$days_compound/365
my.surv <- Surv(as.numeric(surv[,2]), as.numeric(surv[,3]))
my.fit <- survfit(my.surv ~ surv[,1])
#  plot(my.fit, col=c(1,2), main="Survival of HR+ by CDR3 groups", xlab="Survival Time (years)", ylab="Survival Probability")
#  legend(0.5,0.4, c("nonzero", "zero"), fill=c(1,2), cex=0.75)
coxph(my.surv ~ surv[,1], method="breslow")
}
types <- split(cdr3_results_surv, cdr3_results_surv$cohort)
types_surv <- lapply(types, surv_results)
# looks like only COAD is significant
# close: SKCM, CESC, ACC
surv_matrix <- types$COAD
surv <- surv_matrix[,c("iDNA_nonzero", "days_compound", "vital_status")]
surv$days_compound <- surv_matrix$days_compound/365
my.surv <- Surv(as.numeric(surv[,2]), as.numeric(surv[,3]))
my.fit <- survfit(my.surv ~ surv[,1])
plot(my.fit, col=c(1,2), main="Survival of COAD by CDR3 presence", xlab="Survival Time (years)", ylab="Survival Probability")
legend(5,0.4, c("nonzero", "zero"), fill=c(1,2), cex=0.75)
coxph(my.surv ~ surv[,1], method="breslow")
### rna vs. dna clonal diversity
cdr3_results_clonality <-mutate(cdr3_results_current,exome_clonality=exome_clonotypes/exome_rpm)
cdr3_results_clonality <-mutate(cdr3_results_clonality,rna_clonality=rna_clonotypes/rna_rpm)
plot(cdr3_results_clonality$exome_rpm, cdr3_results_clonality$exome_clonotypes)
plot(cdr3_results_clonality$rna_rpm, cdr3_results_clonality$rna_clonotypes)
plot(cdr3_results_clonality$exome_clonality, cdr3_results_clonality$rna_clonality)
cohorts_limited_df <- rbind(cohorts$BLCA, cohorts$BRCA, cohorts$COAD, cohorts$GBM,
cohorts$HNSC, cohorts$LGG, cohorts$LUAD, cohorts$LUSC,
cohorts$OV, cohorts$PRAD, cohorts$STAD, cohorts$THCA)
cdr3_results_clonality <-mutate(cohorts_limited_df,exome_clonality=exome_clonotypes/exome_rpm)
cdr3_results_clonality <-mutate(cohorts_limited_df,rna_clonality=rna_clonotypes/rna_rpm)
plot(cdr3_results_clonality$exome_clonality, cdr3_results_clonality$rna_clonality)
cdr3_results_clonality[1,]
cdr3_results_clonality <-mutate(cohorts_limited_df,exome_clonality=exome_clonotypes/exome_rpm)
cdr3_results_clonality <-mutate(cdr3_results_clonality,rna_clonality=rna_clonotypes/rna_rpm)
plot(cdr3_results_clonality$exome_clonality, cdr3_results_clonality$rna_clonality)
plot(cdr3_results_clonality$exome_clonality, cdr3_results_clonality$rna_clonality, col=cdr3_results_clonality$cohort)
cohorts_limited_df <- rbind(cohorts$BRCA, cohorts$HNSC,cohorts$LUAD, cohorts$LUSC,
cohorts$OV, cohorts$STAD)
cdr3_results_clonality <-mutate(cohorts_limited_df,exome_clonality=exome_clonotypes/exome_rpm)
cdr3_results_clonality <-mutate(cdr3_results_clonality,rna_clonality=rna_clonotypes/rna_rpm)
plot(cdr3_results_clonality$exome_clonality, cdr3_results_clonality$rna_clonality, col=cdr3_results_clonality$cohort)
help(plot)
cdr3_results_clonality$cohort
cohorts_limited_df <- rbind(cohorts$BRCA, cohorts$HNSC,cohorts$LUAD, cohorts$LUSC,
cohorts$OV, cohorts$STAD)
cohorts_limited_df$cohort <- factor(cohorts_limited_df$cohort)
cdr3_results_clonality <-mutate(cohorts_limited_df,exome_clonality=exome_clonotypes/exome_rpm)
cdr3_results_clonality <-mutate(cdr3_results_clonality,rna_clonality=rna_clonotypes/rna_rpm)
plot(cdr3_results_clonality$exome_clonality, cdr3_results_clonality$rna_clonality, col=cdr3_results_clonality$cohort)
legend(legend = levels(cdr3_results_clonality$cohort))
legend(x="topright", legend = levels(cdr3_results_clonality$cohort))
plot(cdr3_results_clonality$exome_clonality, cdr3_results_clonality$rna_clonality, col=cdr3_results_clonality$cohort, pch=2)
plot(cdr3_results_clonality$exome_clonality, cdr3_results_clonality$rna_clonality, col=cdr3_results_clonality$cohort, pch=16)
length(table(cdr3_results_clonality$cohort))
plot(cdr3_results_clonality$exome_clonality, cdr3_results_clonality$rna_clonality,
col=c("blue", "red", "black", "purple", "green", "lightblue"))
help(legend)
legend(x="topright", legend=levels(cdr3_results_clonality$cohort),
col=c("blue", "red", "black", "purple", "green", "lightblue"))
legend(x=200, y=400, legend=levels(cdr3_results_clonality$cohort),
col=c("blue", "red", "black", "purple", "green", "lightblue"))
help(legend)
legend(x=200, y=400, legend=levels(cdr3_results_clonality$cohort), pch=16,
col=c("blue", "red", "black", "purple", "green", "lightblue"))
plot(cdr3_results_clonality$exome_clonality, cdr3_results_clonality$rna_clonality,
col=c("blue", "red", "black", "purple", "green", "lightblue"), pch=16)
legend(x=200, y=400, legend=levels(cdr3_results_clonality$cohort), pch=16,
col=c("blue", "red", "black", "purple", "green", "lightblue"))
plot(cdr3_results_clonality$exome_clonality, cdr3_results_clonality$rna_clonality,
col=c("blue", "red", "black", "purple", "green", "lightblue"), pch=16)
legend(x=400, y=500, legend=levels(cdr3_results_clonality$cohort), pch=16,
col=c("blue", "red", "black", "purple", "green", "lightblue"))
plot(cdr3_results_clonality$exome_clonality, cdr3_results_clonality$rna_clonality,
col=c("blue", "red", "black", "purple", "green", "lightblue"), pch=16,
main="Clonal diversity of RNA vs. DNA", xlab="Exome clonal diversity", ylab="RNA clonal diversity")
legend(x=400, y=500, legend=levels(cdr3_results_clonality$cohort), pch=16,
col=c("blue", "red", "black", "purple", "green", "lightblue"))
results_new <- read.csv("/Users/Eric/tcrseq/new/processed/pancan_exome_rna_gsva_clinical_6-7-2016.txt", sep="\t")
results_old <- read.csv("/Users/Eric/tcrseq/new/processed/pancan_exome_gsva_clinical_dedup.txt", sep="\t")
results_holt <- read.csv("/Users/Eric/tcrseq/new/holt/TCGA_mitcr_cdr3_result_160401.tsv.datafreeze1.3.filtered.tsv", sep="\t")
clonotypes_new <- read.csv("/Users/Eric/tcrseq/new/processed/pancan_clonotypes_all_6-14.txt", sep="\t")
pancan_rna_unique_aa <- unique(clonotypes_rna$aa)
holt_unique_aa <- unique(results_holt$aaSeq)
clonotypes_new <- read.csv("/Users/Eric/tcrseq/new/processed/pancan_clonotypes_all_6-14.txt", sep="\t")
### comparing to Holt
clonotypes_rna <- clonotypes_new[clonotypes_new$rna>0,]
pancan_rna_unique_nuc <- unique(clonotypes_rna$clonotype)
holt_unique_nuc <- unique(results_holt$nucSeq)
length(intersect(pancan_rna_unique_nuc, holt_unique_nuc))
pancan_rna_unique_aa <- unique(clonotypes_rna$aa)
holt_unique_aa <- unique(results_holt$aaSeq)
pancan_rna_unique_aa[1,]
pancan_rna_unique_aa[1]
holt_unique_aa[1]
pancan_rna_unique_aa <- as.character(unique(clonotypes_rna$aa))
holt_unique_aa <- as.character(unique(results_holt$aaSeq))
length(intersect(pancan_rna_unique_aa, holt_unique_aa))
library(stringdist)
testy1 <- pancan_rna_unique_aa[1]
testy1
stringdist(testy1, holt_unique_aa)
min(stringdist(testy1, holt_unique_aa))
min(stringdist(pancan_rna_unique_aa[1], holt_unique_aa))
min(stringdist(pancan_rna_unique_aa[2], holt_unique_aa))
min(stringdist(pancan_rna_unique_aa[3], holt_unique_aa))
min(stringdist(pancan_rna_unique_aa[4], holt_unique_aa))
min(stringdist(pancan_rna_unique_aa[5], holt_unique_aa))
min(stringdist(pancan_rna_unique_aa[6], holt_unique_aa))
min(stringdist(pancan_rna_unique_aa[7], holt_unique_aa))
min(stringdist(pancan_rna_unique_aa[8], holt_unique_aa))
min(stringdist(pancan_rna_unique_aa[9], holt_unique_aa))
min(stringdist(pancan_rna_unique_aa[10], holt_unique_aa))
min(stringdist(pancan_rna_unique_aa[11], holt_unique_aa))
distances <- c()
for (i in 1:nrow(pancan_rna_unique_aa))
{
distance <- min(stringdist(pancan_rna_unique_aa[i], holt_unique_aa))
distances <- c(distance, distances)
}
distances <- c()
for (i in 1:length(pancan_rna_unique_aa))
{
distance <- min(stringdist(pancan_rna_unique_aa[i], holt_unique_aa))
distances <- c(distance, distances)
}
length(distances)
distances
length(which(distances<2))
length(which(distances<3))
length(which(distances<4))
length(which(distances<5))
length(which(distances<6))
length(which(distances<7))
write.table(distances, "pancan_clonotypes_holt_edit_distances.txt", quote=FALSE, row.names=FALSE, col.names=FALSE)
help("stringdist")
hist(distances)
length(which(distances==0))
length(intersect(pancan_rna_unique_aa, holt_unique_aa))
length(which(distances==1))
length(which(distances==2))
length(which(distances==3))
length(which(distances==4))
length(which(distances==5))
length(which(distances==6))
length(which(distances==7))
length(which(distances==8))
length(which(distances==9))
length(which(distances==10))
length(which(distances==11))
length(which(distances==12))
length(which(distances==13))
length(which(distances==1))
length(which(distances==14))
length(which(distances==15))
length(which(distances==16))
max(distances)
distnaces
distances
summary(distances)
li_file <- "/Users/Eric/tcrseq/new/li/Supplementary_Table_1.fa"
con <- file(li_file, open="r")
line <- readLines(con)
line[1]
line[2]
line[3]
results <- read.csv("/Users/Eric/tcrseq/new/processed/pancan_exome_rna_blood_tcrb_gsva_clinical_7-13-2016.txt", sep="\t")
nrow(results)
results[1,]
length(~is.na(results$exome_cdr3))
length(!is.na(results$exome_cdr3))
length(!is.na(results$rna_cdr3))
length(!is.na(results$blood_cdr3))
results$exome_cdr3
nrow(results)
sum(!is.na(results$exome_cdr3))
sum(!is.na(results$rna_cdr3))
sum(!is.na(results$blood_cdr3))
sum(!is.na(results$exome_cdr3)&&!is.na(results$blood_cdr3))
sum(!is.na(results$exome_cdr3)&!is.na(results$blood_cdr3))
clonotypes_new <- read.csv("/Users/Eric/tcrseq/new/processed/pancan_clonotypes_all_7-14-2016.txt", sep="\t")
clonotypes_new[1,]
nrow(clonotypes(new))
nrow(clonotypes_new)
distances_mat <- read.csv("pancan_clonotypes_li_edit_distances.txt", sep="\t")
distances_mat[1,]
distances_mat <- read.csv("pancan_clonotypes_li_edit_distances.txt", sep="\t", row.names=FALSE, col.names=FALSE)
distances_mat <- read.csv("pancan_clonotypes_li_edit_distances.txt", sep="\t", col.names=FALSE)
help(read.csv)
distances_mat <- read.csv("pancan_clonotypes_li_edit_distances.txt", sep="\t", header=FALSE)
distances_matp1,
distances_mat[1,]
# compare to Li
li_file <- "/Users/Eric/tcrseq/new/li/Supplementary_Table_1.fa"
con <- file(li_file, open="r")
lines <- readLines(con)
close(con, type="r")
pancan_rna_aa_c_f <- c()
for (i in 1:length(pancan_rna_unique_aa))
{
aa <- pancan_rna_unique_aa[i]
first <- regexpr("C", aa)
last <- regexpr("F", aa)
if (first != -1 && last != -1 && first<last) {
aa_c_f <- substr(aa, first, last)
pancan_rna_aa_c_f <- c(pancan_rna_aa_c_f, aa_c_f)
}
}
li_table <- matrix(data=NA, nrow=length(lines)/2, ncol=2)
header <- c()
for (i in 1:length(lines))
{
line <- lines[i]
if (substr(line, 1, 1) == ">") {
header <- line
} else {
li_table[i/2,] <- c(header, line)
}
}
li_aa <- unique(li_table[,2])
li_aa_c_f <- c()
for (i in 1:length(li_aa))
{
aa <- li_aa[i]
first <- regexpr("C", aa)
last <- regexpr("F", aa)
if (first != -1 && last != -1 && first<last) {
aa_c_f <- substr(aa, first, last)
li_aa_c_f <- c(li_aa_c_f, aa_c_f)
}
}
### compare
results_new <- read.csv("/Users/Eric/tcrseq/new/processed/pancan_exome_rna_blood_tcrb_gsva_clinical_7-13-2016.txt", sep="\t")
#results_old <- read.csv("/Users/Eric/tcrseq/new/processed/pancan_exome_gsva_clinical_dedup.txt", sep="\t")
results_old <- read.csv("/Users/Eric/BRCA/cdr3_results_with_expression_blood_ptprc_burden_purity_gsva_clustering_four_groups_1078.txt", sep="\t")
results_holt <- read.csv("/Users/Eric/tcrseq/new/holt/TCGA_mitcr_cdr3_result_160401.tsv.datafreeze1.3.filtered.tsv", sep="\t")
clonotypes_new <- read.csv("/User
### comparing to Holt
clonotypes_rna <- clonotypes_new[clonotypes_new$rna>0,]
pancan_rna_unique_nuc <- as.character(unique(clonotypes_rna$clonotype))
holt_unique_nuc <- as.character(unique(results_holt$nucSeq))
length(intersect(pancan_rna_unique_nuc, holt_unique_nuc))
pancan_rna_unique_aa <- as.character(unique(clonotypes_rna$aa))
pancan_rna_unique_aa <- pancan_rna_unique_aa[complete.cases((pancan_rna_unique_aa))]
holt_unique_aa <- as.character(unique(results_holt$aaSeq))
length(intersect(pancan_rna_unique_aa, holt_unique_aa))
)
### compare
results_new <- read.csv("/Users/Eric/tcrseq/new/processed/pancan_exome_rna_blood_tcrb_gsva_clinical_7-13-2016.txt", sep="\t")
#results_old <- read.csv("/Users/Eric/tcrseq/new/processed/pancan_exome_gsva_clinical_dedup.txt", sep="\t")
results_old <- read.csv("/Users/Eric/BRCA/cdr3_results_with_expression_blood_ptprc_burden_purity_gsva_clustering_four_groups_1078.txt", sep="\t")
results_holt <- read.csv("/Users/Eric/tcrseq/new/holt/TCGA_mitcr_cdr3_result_160401.tsv.datafreeze1.3.filtered.tsv", sep="\t")
clonotypes_new <- read.csv("/Users/Eric/tcrseq/new/processed/pancan_clonotypes_all_7-14-2016.txt", sep="\t")
### comparing to Holt
clonotypes_rna <- clonotypes_new[clonotypes_new$rna>0,]
pancan_rna_unique_nuc <- as.character(unique(clonotypes_rna$clonotype))
holt_unique_nuc <- as.character(unique(results_holt$nucSeq))
length(intersect(pancan_rna_unique_nuc, holt_unique_nuc))
pancan_rna_unique_aa <- as.character(unique(clonotypes_rna$aa))
pancan_rna_unique_aa <- pancan_rna_unique_aa[complete.cases((pancan_rna_unique_aa))]
holt_unique_aa <- as.character(unique(results_holt$aaSeq))
length(intersect(pancan_rna_unique_aa, holt_unique_aa))
# compare to Li
li_file <- "/Users/Eric/tcrseq/new/li/Supplementary_Table_1.fa"
con <- file(li_file, open="r")
lines <- readLines(con)
close(con, type="r")
pancan_rna_aa_c_f <- c()
for (i in 1:length(pancan_rna_unique_aa))
{
aa <- pancan_rna_unique_aa[i]
first <- regexpr("C", aa)
last <- regexpr("F", aa)
if (first != -1 && last != -1 && first<last) {
aa_c_f <- substr(aa, first, last)
pancan_rna_aa_c_f <- c(pancan_rna_aa_c_f, aa_c_f)
}
}
li_table <- matrix(data=NA, nrow=length(lines)/2, ncol=2)
header <- c()
for (i in 1:length(lines))
{
line <- lines[i]
if (substr(line, 1, 1) == ">") {
header <- line
} else {
li_table[i/2,] <- c(header, line)
}
}
li_aa <- unique(li_table[,2])
li_aa_c_f <- c()
for (i in 1:length(li_aa))
{
aa <- li_aa[i]
first <- regexpr("C", aa)
last <- regexpr("F", aa)
if (first != -1 && last != -1 && first<last) {
aa_c_f <- substr(aa, first, last)
li_aa_c_f <- c(li_aa_c_f, aa_c_f)
}
}
pancan_rna_aa_c_f_unique <- unique(pancan_rna_aa_c_f)
li_aa_c_f_unique <- unique(li_aa_c_f)
length(intersect(pancan_rna_aa_c_f_unique, li_aa_c_f_unique))
distances_mat <- read.csv("/Users/Eric/tcrseq/new/processed/pancan_clonotypes_li_edit_distances.txt", sep="\t", header=FALSE)
distances_mat[1,]
nrow(li_table)
nrow(li_aa_c_f_unique)
length(li_aa_c_f_unique)
length(pancan_rna_aa_c_f_unique)
length(intersect(pancan_rna_aa_c_f_unique, li_aa_c_f_unique))
distances_mat[1,]
hist(distances_mat[,1])
hist(distances_mat[,1], main="Histogram of string distances", xlab="String distance")
table(distances_mat[,1])
library(OIsurv)
library(cgdsr)
library(cluster)
library(fpc)
library(gplots)
library(heatmap.plus)
library(reshape)
library(dplyr)
library(ggplot2)
library(plotrix)
results <- read.csv("/Users/Eric/tcrseq/new/processed/pancan_exome_rna_blood_tcrb_gsva_clinical_7-13-2016.txt", sep="\t")
### recreate figures from BRCA paper
cdr3_results_current<-results
# calculating the iDNA score, rna_rpm, R and D groups
cdr3_results_current<-mutate(cdr3_results_current,exome_rpm=exome_cdr3*10^6/exome_reads)
tmp<-select(filter(cdr3_results_current,exome_rpm!=0),patient_uuid,exome_rpm)
tmp<-mutate(tmp,iDNA_score=ntile(exome_rpm,10))
cdr3_results_current<-left_join(cdr3_results_current,tmp)
cdr3_results_current<-mutate(cdr3_results_current,iDNA_score=ifelse(is.na(iDNA_score),0,iDNA_score))
cdr3_results_current<-mutate(cdr3_results_current,rna_rpm=rna_cdr3*10^6/rna_reads)
cdr3_results_current<-mutate(cdr3_results_current,blood_rpm=blood_cdr3*10^6/blood_reads)
cdr3_results_current<-mutate(cdr3_results_current,D=ifelse(exome_rpm==0,"D-","D+"),R=ifelse(rna_rpm==0,"R-","R+"))
### recreate relevant results report
cancer_current <- cdr3_results_current
# remove cohort size <400
# BLCA, BRCA, COAD, HNSC, KIRC, LGG, LUAD, LUSC, OV, PRAD, STAD, THCA, UCEC
cancer_current <- filter(cdr3_results_current, cohort=="BLCA" | cohort=="BRCA" | cohort=="COAD" | cohort=="HNSC" |
cohort=="KIRC" | cohort=="LGG" | cohort=="LUAD" | cohort=="LUSC" | cohort=="OV" |
cohort=="PRAD" | cohort=="STAD" | cohort=="THCA" | cohort=="UCEC")
cancer_current$cohort <- factor(cancer_current$cohort)
cancer_split <- split(cancer_current, cancer_current$cohort)
# contrast infiltration of cancer types
exome_split <- lapply(cancer_split, '[[', "exome_rpm")
rna_split <- lapply(cancer_split, '[[', "rna_rpm")
blood_split <- lapply(cancer_split, '[[', "blood_rpm")
idna_split <- lapply(cancer_split, '[[', "iDNA_score")
exome_split
ggplot(cancer_current, aes(x=exome_rpm, y=rna_rpm, colour=cohort)) + geom_point()
exome_avg <- sapply(exome_split, mean, na.rm=TRUE)
rna_avg <- sapply(rna_split, mean, na.rm=TRUE)
cohort_sizes <- table(cancer_current$cohort)
avgs_plot <- as.data.frame(cbind(exome_avg, rna_avg, cohort_sizes))
ggplot(avgs_plot, aes(exome_avg, rna_avg, size=cohort_sizes, colour=rownames(avgs_plot))) + geom_point()
tmp <- filter(cancer_current,D=="D+",R=="R-")
tmp
tmp[1,]
tmp <- filter(cancer_current,D=="D+",R=="R-")
nrow(tmp)
clonotypes <- read.csv("/Users/Eric/tcrseq/new/processed/pancan_clonotypes_all_7-14-2016.txt", sep="\t", header=FALSE)
clonotypes[1,]
clonotypes <- read.csv("/Users/Eric/tcrseq/new/processed/pancan_clonotypes_all_7-14-2016.txt", sep="\t")
clonotypes[1,]
source('~/tcrseq/new/rstudio/clonotypes_analysis.R')
exome_pos_rna_pos
nrow(exome_pos_blood_pos)
nrow(exome_neg_blood_pos)
nrow(exome_pos_blood_neg)
exome_pos_blood_pos[1,]
length(unique(exome_pos_blood_pos$aa))
length(unique(exome_pos_blood_neg$aa))
length(unique(exome_neg_blood_pos$aa))
length(unique(exome_neg_blood_pos$patient_id))
length(unique(exome_pos_blood_pos$patient_id))
length(unique(exome_pos_blood_neg$patient_id))
clonotype_common <- "TGTGCCACCAGCAGAGACACAGAGCTGCAGTGCTTCCTGCTCTCTGTTCATAAACCTCATTGTTTCCCAGATCCAGGTGCTTTCTCT"
shared <- clonotypes[which(clonotypes$clonotype==clonotype_common),]
shared
nrow(shared)
length(unique(shared$patient_id))
exome_pos_rna_pos <- filter(clonotypes, rna > 0 & exome > 0)
exome_neg_rna_pos <- filter(clonotypes, rna > 0 & exome == 0)
exome_pos_rna_neg <- filter(clonotypes, rna == 0 & exome > 0)
nrow(exome_pos_rna_pos)
nrow(exome_neg_rna_pos)
nrow(exome_pos_rna_neg)
length(unique(exome_pos_rna_pos$aa))
length(unique(exome_pos_rna_neg$aa))
length(unique(exome_neg_rna_pos$aa))
results[1,]
library(OIsurv)
library(cgdsr)
library(cluster)
library(fpc)
library(gplots)
library(heatmap.plus)
library(reshape)
library(dplyr)
library(ggplot2)
library(plotrix)
results <- read.csv("/Users/Eric/tcrseq/new/processed/pancan_exome_rna_blood_tcrb_gsva_clinical_7-13-2016.txt", sep="\t")
clonotypes <- read.csv("/Users/Eric/tcrseq/new/processed/pancan_clonotypes_all_7-14-2016.txt", sep="\t")
### recreate figures from BRCA paper
cdr3_results_current<-results
# calculating the iDNA score, rna_rpm, R and D groups
cdr3_results_current<-mutate(cdr3_results_current,exome_rpm=exome_cdr3*10^6/exome_reads)
tmp<-select(filter(cdr3_results_current,exome_rpm!=0),patient_uuid,exome_rpm)
tmp<-mutate(tmp,iDNA_score=ntile(exome_rpm,10))
cdr3_results_current<-left_join(cdr3_results_current,tmp)
cdr3_results_current<-mutate(cdr3_results_current,iDNA_score=ifelse(is.na(iDNA_score),0,iDNA_score))
cdr3_results_current<-mutate(cdr3_results_current,rna_rpm=rna_cdr3*10^6/rna_reads)
cdr3_results_current<-mutate(cdr3_results_current,blood_rpm=blood_cdr3*10^6/blood_reads)
cdr3_results_current<-mutate(cdr3_results_current,D=ifelse(exome_rpm==0,"D-","D+"),R=ifelse(rna_rpm==0,"R-","R+"))
### recreate relevant results report
cancer_current <- cdr3_results_current
# remove cohort size <400
# BLCA, BRCA, COAD, HNSC, KIRC, LGG, LUAD, LUSC, OV, PRAD, STAD, THCA, UCEC
cancer_current <- filter(cdr3_results_current, cohort=="BLCA" | cohort=="BRCA" | cohort=="COAD" | cohort=="HNSC" |
cohort=="KIRC" | cohort=="LGG" | cohort=="LUAD" | cohort=="LUSC" | cohort=="OV" |
cohort=="PRAD" | cohort=="STAD" | cohort=="THCA" | cohort=="UCEC")
cancer_current$cohort <- factor(cancer_current$cohort)
cancer_split <- split(cancer_current, cancer_current$cohort)
# contrast infiltration of cancer types
exome_split <- lapply(cancer_split, '[[', "exome_rpm")
rna_split <- lapply(cancer_split, '[[', "rna_rpm")
blood_split <- lapply(cancer_split, '[[', "blood_rpm")
idna_split <- lapply(cancer_split, '[[', "iDNA_score")
ggplot(cancer_current, aes(x=exome_rpm, y=rna_rpm, colour=cohort)) + geom_point()
exome_avg <- sapply(exome_split, mean, na.rm=TRUE)
rna_avg <- sapply(rna_split, mean, na.rm=TRUE)
cohort_sizes <- table(cancer_current$cohort)
avgs_plot <- as.data.frame(cbind(exome_avg, rna_avg, cohort_sizes))
ggplot(avgs_plot, aes(exome_avg, rna_avg, size=cohort_sizes, colour=rownames(avgs_plot))) + geom_point()
# exome CDR3 high without RNA
tmp <- filter(cancer_current,D=="D+",R=="R-")
# exome vs. blood
exome_only <- filter(clonotypes, exome > 0)
63*0.14
library(stringdist)
### put together both RNA and DNA
results_exome <- read.csv("/Users/Eric/tcrseq/new/processed/pancan_exome_rna_blood_tcrb_gsva_clinical_7-5-2016_exome.txt", sep="\t")
results_RNA <- read.csv("/Users/Eric/tcrseq/new/processed/pancan_exome_rna_blood_tcrb_gsva_clinical_7-5-2016_RNA.txt", sep="\t")
patients_exome_to_add <- setdiff(as.character(results_exome$patient_uuid), as.character(results_RNA$patient_uuid))
rownames(results_exome) <- as.character(results_exome$patient_uuid)
rows_exome_to_add <- results_exome[patients_exome_to_add,]
rownames(rows_exome_to_add) <- NULL
results_both <- rbind(results_RNA, rows_exome_to_add)
write.table(results, "/Users/Eric/tcrseq/new/processed/pancan_exome_rna_blood_tcrb_gsva_clinical_7-6-2016.txt", sep="\t",
row.names=FALSE, quote=FALSE)
### compare
results_new <- read.csv("/Users/Eric/tcrseq/new/processed/pancan_exome_rna_blood_tcrb_gsva_clinical_7-13-2016.txt", sep="\t")
#results_old <- read.csv("/Users/Eric/tcrseq/new/processed/pancan_exome_gsva_clinical_dedup.txt", sep="\t")
results_old <- read.csv("/Users/Eric/BRCA/cdr3_results_with_expression_blood_ptprc_burden_purity_gsva_clustering_four_groups_1078.txt", sep="\t")
results_holt <- read.csv("/Users/Eric/tcrseq/new/holt/TCGA_mitcr_cdr3_result_160401.tsv.datafreeze1.3.filtered.tsv", sep="\t")
clonotypes_new <- read.csv("/Users/Eric/tcrseq/new/processed/pancan_clonotypes_all_7-14-2016.txt", sep="\t")
### comparing to Holt
clonotypes_rna <- clonotypes_new[clonotypes_new$rna>0,]
pancan_rna_unique_nuc <- as.character(unique(clonotypes_rna$clonotype))
holt_unique_nuc <- as.character(unique(results_holt$nucSeq))
length(intersect(pancan_rna_unique_nuc, holt_unique_nuc))
pancan_rna_unique_aa <- as.character(unique(clonotypes_rna$aa))
pancan_rna_unique_aa <- pancan_rna_unique_aa[complete.cases((pancan_rna_unique_aa))]
holt_unique_aa <- as.character(unique(results_holt$aaSeq))
length(intersect(pancan_rna_unique_aa, holt_unique_aa))
# within distances
distances_mat <- matrix(NA, nrow=length(pancan_rna_unique_aa), ncol=3)
for (i in 1:length(pancan_rna_unique_aa))
{
pancan_rna_unique_without <- pancan_rna_unique_aa[-i]
distances <- stringdist(pancan_rna_unique_aa[i], pancan_rna_unique_without)
distance <- min(distances)
aa_without <- pancan_rna_unique_without[which(distances==distance)][1]
aa_pancan <- pancan_rna_unique_aa[i]
distances_mat[i,] <- c(distance, aa_pancan, aa_without)
}
distances_mat[1,]
write.table(distances_mat, "pancan_clonotypes_within_edit_distances.txt", quote=FALSE, row.names=FALSE, col.names=FALSE, sep="\t")
distances_mat <- read.csv("/Users/Eric/tcrseq/new/processed/pancan_clonotypes_within_edit_distances.txt", sep="\t", header=FALSE)
distances <- distances_mat[,1]
hist(distances, xlab="Minimum string distance", main="Distances within pancan")
table(distances)
