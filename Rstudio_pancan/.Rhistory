min(stringdist(pancan_rna_unique_aa[2], holt_unique_aa))
min(stringdist(pancan_rna_unique_aa[3], holt_unique_aa))
min(stringdist(pancan_rna_unique_aa[4], holt_unique_aa))
min(stringdist(pancan_rna_unique_aa[5], holt_unique_aa))
min(stringdist(pancan_rna_unique_aa[6], holt_unique_aa))
min(stringdist(pancan_rna_unique_aa[7], holt_unique_aa))
min(stringdist(pancan_rna_unique_aa[8], holt_unique_aa))
min(stringdist(pancan_rna_unique_aa[9], holt_unique_aa))
min(stringdist(pancan_rna_unique_aa[10], holt_unique_aa))
min(stringdist(pancan_rna_unique_aa[11], holt_unique_aa))
distances <- c()
for (i in 1:nrow(pancan_rna_unique_aa))
{
distance <- min(stringdist(pancan_rna_unique_aa[i], holt_unique_aa))
distances <- c(distance, distances)
}
distances <- c()
for (i in 1:length(pancan_rna_unique_aa))
{
distance <- min(stringdist(pancan_rna_unique_aa[i], holt_unique_aa))
distances <- c(distance, distances)
}
length(distances)
distances
length(which(distances<2))
length(which(distances<3))
length(which(distances<4))
length(which(distances<5))
length(which(distances<6))
length(which(distances<7))
write.table(distances, "pancan_clonotypes_holt_edit_distances.txt", quote=FALSE, row.names=FALSE, col.names=FALSE)
help("stringdist")
hist(distances)
length(which(distances==0))
length(intersect(pancan_rna_unique_aa, holt_unique_aa))
length(which(distances==1))
length(which(distances==2))
length(which(distances==3))
length(which(distances==4))
length(which(distances==5))
length(which(distances==6))
length(which(distances==7))
length(which(distances==8))
length(which(distances==9))
length(which(distances==10))
length(which(distances==11))
length(which(distances==12))
length(which(distances==13))
length(which(distances==1))
length(which(distances==14))
length(which(distances==15))
length(which(distances==16))
max(distances)
distnaces
distances
summary(distances)
li_file <- "/Users/Eric/tcrseq/new/li/Supplementary_Table_1.fa"
con <- file(li_file, open="r")
line <- readLines(con)
line[1]
line[2]
line[3]
results <- read.csv("/Users/Eric/tcrseq/new/processed/pancan_exome_rna_blood_tcrb_gsva_clinical_7-13-2016.txt", sep="\t")
nrow(results)
results[1,]
length(~is.na(results$exome_cdr3))
length(!is.na(results$exome_cdr3))
length(!is.na(results$rna_cdr3))
length(!is.na(results$blood_cdr3))
results$exome_cdr3
nrow(results)
sum(!is.na(results$exome_cdr3))
sum(!is.na(results$rna_cdr3))
sum(!is.na(results$blood_cdr3))
sum(!is.na(results$exome_cdr3)&&!is.na(results$blood_cdr3))
sum(!is.na(results$exome_cdr3)&!is.na(results$blood_cdr3))
clonotypes_new <- read.csv("/Users/Eric/tcrseq/new/processed/pancan_clonotypes_all_7-14-2016.txt", sep="\t")
clonotypes_new[1,]
nrow(clonotypes(new))
nrow(clonotypes_new)
distances_mat <- read.csv("pancan_clonotypes_li_edit_distances.txt", sep="\t")
distances_mat[1,]
distances_mat <- read.csv("pancan_clonotypes_li_edit_distances.txt", sep="\t", row.names=FALSE, col.names=FALSE)
distances_mat <- read.csv("pancan_clonotypes_li_edit_distances.txt", sep="\t", col.names=FALSE)
help(read.csv)
distances_mat <- read.csv("pancan_clonotypes_li_edit_distances.txt", sep="\t", header=FALSE)
distances_matp1,
distances_mat[1,]
# compare to Li
li_file <- "/Users/Eric/tcrseq/new/li/Supplementary_Table_1.fa"
con <- file(li_file, open="r")
lines <- readLines(con)
close(con, type="r")
pancan_rna_aa_c_f <- c()
for (i in 1:length(pancan_rna_unique_aa))
{
aa <- pancan_rna_unique_aa[i]
first <- regexpr("C", aa)
last <- regexpr("F", aa)
if (first != -1 && last != -1 && first<last) {
aa_c_f <- substr(aa, first, last)
pancan_rna_aa_c_f <- c(pancan_rna_aa_c_f, aa_c_f)
}
}
li_table <- matrix(data=NA, nrow=length(lines)/2, ncol=2)
header <- c()
for (i in 1:length(lines))
{
line <- lines[i]
if (substr(line, 1, 1) == ">") {
header <- line
} else {
li_table[i/2,] <- c(header, line)
}
}
li_aa <- unique(li_table[,2])
li_aa_c_f <- c()
for (i in 1:length(li_aa))
{
aa <- li_aa[i]
first <- regexpr("C", aa)
last <- regexpr("F", aa)
if (first != -1 && last != -1 && first<last) {
aa_c_f <- substr(aa, first, last)
li_aa_c_f <- c(li_aa_c_f, aa_c_f)
}
}
### compare
results_new <- read.csv("/Users/Eric/tcrseq/new/processed/pancan_exome_rna_blood_tcrb_gsva_clinical_7-13-2016.txt", sep="\t")
#results_old <- read.csv("/Users/Eric/tcrseq/new/processed/pancan_exome_gsva_clinical_dedup.txt", sep="\t")
results_old <- read.csv("/Users/Eric/BRCA/cdr3_results_with_expression_blood_ptprc_burden_purity_gsva_clustering_four_groups_1078.txt", sep="\t")
results_holt <- read.csv("/Users/Eric/tcrseq/new/holt/TCGA_mitcr_cdr3_result_160401.tsv.datafreeze1.3.filtered.tsv", sep="\t")
clonotypes_new <- read.csv("/User
### comparing to Holt
clonotypes_rna <- clonotypes_new[clonotypes_new$rna>0,]
pancan_rna_unique_nuc <- as.character(unique(clonotypes_rna$clonotype))
holt_unique_nuc <- as.character(unique(results_holt$nucSeq))
length(intersect(pancan_rna_unique_nuc, holt_unique_nuc))
pancan_rna_unique_aa <- as.character(unique(clonotypes_rna$aa))
pancan_rna_unique_aa <- pancan_rna_unique_aa[complete.cases((pancan_rna_unique_aa))]
holt_unique_aa <- as.character(unique(results_holt$aaSeq))
length(intersect(pancan_rna_unique_aa, holt_unique_aa))
)
### compare
results_new <- read.csv("/Users/Eric/tcrseq/new/processed/pancan_exome_rna_blood_tcrb_gsva_clinical_7-13-2016.txt", sep="\t")
#results_old <- read.csv("/Users/Eric/tcrseq/new/processed/pancan_exome_gsva_clinical_dedup.txt", sep="\t")
results_old <- read.csv("/Users/Eric/BRCA/cdr3_results_with_expression_blood_ptprc_burden_purity_gsva_clustering_four_groups_1078.txt", sep="\t")
results_holt <- read.csv("/Users/Eric/tcrseq/new/holt/TCGA_mitcr_cdr3_result_160401.tsv.datafreeze1.3.filtered.tsv", sep="\t")
clonotypes_new <- read.csv("/Users/Eric/tcrseq/new/processed/pancan_clonotypes_all_7-14-2016.txt", sep="\t")
### comparing to Holt
clonotypes_rna <- clonotypes_new[clonotypes_new$rna>0,]
pancan_rna_unique_nuc <- as.character(unique(clonotypes_rna$clonotype))
holt_unique_nuc <- as.character(unique(results_holt$nucSeq))
length(intersect(pancan_rna_unique_nuc, holt_unique_nuc))
pancan_rna_unique_aa <- as.character(unique(clonotypes_rna$aa))
pancan_rna_unique_aa <- pancan_rna_unique_aa[complete.cases((pancan_rna_unique_aa))]
holt_unique_aa <- as.character(unique(results_holt$aaSeq))
length(intersect(pancan_rna_unique_aa, holt_unique_aa))
# compare to Li
li_file <- "/Users/Eric/tcrseq/new/li/Supplementary_Table_1.fa"
con <- file(li_file, open="r")
lines <- readLines(con)
close(con, type="r")
pancan_rna_aa_c_f <- c()
for (i in 1:length(pancan_rna_unique_aa))
{
aa <- pancan_rna_unique_aa[i]
first <- regexpr("C", aa)
last <- regexpr("F", aa)
if (first != -1 && last != -1 && first<last) {
aa_c_f <- substr(aa, first, last)
pancan_rna_aa_c_f <- c(pancan_rna_aa_c_f, aa_c_f)
}
}
li_table <- matrix(data=NA, nrow=length(lines)/2, ncol=2)
header <- c()
for (i in 1:length(lines))
{
line <- lines[i]
if (substr(line, 1, 1) == ">") {
header <- line
} else {
li_table[i/2,] <- c(header, line)
}
}
li_aa <- unique(li_table[,2])
li_aa_c_f <- c()
for (i in 1:length(li_aa))
{
aa <- li_aa[i]
first <- regexpr("C", aa)
last <- regexpr("F", aa)
if (first != -1 && last != -1 && first<last) {
aa_c_f <- substr(aa, first, last)
li_aa_c_f <- c(li_aa_c_f, aa_c_f)
}
}
pancan_rna_aa_c_f_unique <- unique(pancan_rna_aa_c_f)
li_aa_c_f_unique <- unique(li_aa_c_f)
length(intersect(pancan_rna_aa_c_f_unique, li_aa_c_f_unique))
distances_mat <- read.csv("/Users/Eric/tcrseq/new/processed/pancan_clonotypes_li_edit_distances.txt", sep="\t", header=FALSE)
distances_mat[1,]
nrow(li_table)
nrow(li_aa_c_f_unique)
length(li_aa_c_f_unique)
length(pancan_rna_aa_c_f_unique)
length(intersect(pancan_rna_aa_c_f_unique, li_aa_c_f_unique))
distances_mat[1,]
hist(distances_mat[,1])
hist(distances_mat[,1], main="Histogram of string distances", xlab="String distance")
table(distances_mat[,1])
library(OIsurv)
library(cgdsr)
library(cluster)
library(fpc)
library(gplots)
library(heatmap.plus)
library(reshape)
library(dplyr)
library(ggplot2)
library(plotrix)
results <- read.csv("/Users/Eric/tcrseq/new/processed/pancan_exome_rna_blood_tcrb_gsva_clinical_7-13-2016.txt", sep="\t")
### recreate figures from BRCA paper
cdr3_results_current<-results
# calculating the iDNA score, rna_rpm, R and D groups
cdr3_results_current<-mutate(cdr3_results_current,exome_rpm=exome_cdr3*10^6/exome_reads)
tmp<-select(filter(cdr3_results_current,exome_rpm!=0),patient_uuid,exome_rpm)
tmp<-mutate(tmp,iDNA_score=ntile(exome_rpm,10))
cdr3_results_current<-left_join(cdr3_results_current,tmp)
cdr3_results_current<-mutate(cdr3_results_current,iDNA_score=ifelse(is.na(iDNA_score),0,iDNA_score))
cdr3_results_current<-mutate(cdr3_results_current,rna_rpm=rna_cdr3*10^6/rna_reads)
cdr3_results_current<-mutate(cdr3_results_current,blood_rpm=blood_cdr3*10^6/blood_reads)
cdr3_results_current<-mutate(cdr3_results_current,D=ifelse(exome_rpm==0,"D-","D+"),R=ifelse(rna_rpm==0,"R-","R+"))
### recreate relevant results report
cancer_current <- cdr3_results_current
# remove cohort size <400
# BLCA, BRCA, COAD, HNSC, KIRC, LGG, LUAD, LUSC, OV, PRAD, STAD, THCA, UCEC
cancer_current <- filter(cdr3_results_current, cohort=="BLCA" | cohort=="BRCA" | cohort=="COAD" | cohort=="HNSC" |
cohort=="KIRC" | cohort=="LGG" | cohort=="LUAD" | cohort=="LUSC" | cohort=="OV" |
cohort=="PRAD" | cohort=="STAD" | cohort=="THCA" | cohort=="UCEC")
cancer_current$cohort <- factor(cancer_current$cohort)
cancer_split <- split(cancer_current, cancer_current$cohort)
# contrast infiltration of cancer types
exome_split <- lapply(cancer_split, '[[', "exome_rpm")
rna_split <- lapply(cancer_split, '[[', "rna_rpm")
blood_split <- lapply(cancer_split, '[[', "blood_rpm")
idna_split <- lapply(cancer_split, '[[', "iDNA_score")
exome_split
ggplot(cancer_current, aes(x=exome_rpm, y=rna_rpm, colour=cohort)) + geom_point()
exome_avg <- sapply(exome_split, mean, na.rm=TRUE)
rna_avg <- sapply(rna_split, mean, na.rm=TRUE)
cohort_sizes <- table(cancer_current$cohort)
avgs_plot <- as.data.frame(cbind(exome_avg, rna_avg, cohort_sizes))
ggplot(avgs_plot, aes(exome_avg, rna_avg, size=cohort_sizes, colour=rownames(avgs_plot))) + geom_point()
tmp <- filter(cancer_current,D=="D+",R=="R-")
tmp
tmp[1,]
tmp <- filter(cancer_current,D=="D+",R=="R-")
nrow(tmp)
clonotypes <- read.csv("/Users/Eric/tcrseq/new/processed/pancan_clonotypes_all_7-14-2016.txt", sep="\t", header=FALSE)
clonotypes[1,]
clonotypes <- read.csv("/Users/Eric/tcrseq/new/processed/pancan_clonotypes_all_7-14-2016.txt", sep="\t")
clonotypes[1,]
source('~/tcrseq/new/rstudio/clonotypes_analysis.R')
exome_pos_rna_pos
nrow(exome_pos_blood_pos)
nrow(exome_neg_blood_pos)
nrow(exome_pos_blood_neg)
exome_pos_blood_pos[1,]
length(unique(exome_pos_blood_pos$aa))
length(unique(exome_pos_blood_neg$aa))
length(unique(exome_neg_blood_pos$aa))
length(unique(exome_neg_blood_pos$patient_id))
length(unique(exome_pos_blood_pos$patient_id))
length(unique(exome_pos_blood_neg$patient_id))
clonotype_common <- "TGTGCCACCAGCAGAGACACAGAGCTGCAGTGCTTCCTGCTCTCTGTTCATAAACCTCATTGTTTCCCAGATCCAGGTGCTTTCTCT"
shared <- clonotypes[which(clonotypes$clonotype==clonotype_common),]
shared
nrow(shared)
length(unique(shared$patient_id))
exome_pos_rna_pos <- filter(clonotypes, rna > 0 & exome > 0)
exome_neg_rna_pos <- filter(clonotypes, rna > 0 & exome == 0)
exome_pos_rna_neg <- filter(clonotypes, rna == 0 & exome > 0)
nrow(exome_pos_rna_pos)
nrow(exome_neg_rna_pos)
nrow(exome_pos_rna_neg)
length(unique(exome_pos_rna_pos$aa))
length(unique(exome_pos_rna_neg$aa))
length(unique(exome_neg_rna_pos$aa))
results[1,]
library(OIsurv)
library(cgdsr)
library(cluster)
library(fpc)
library(gplots)
library(heatmap.plus)
library(reshape)
library(dplyr)
library(ggplot2)
library(plotrix)
results <- read.csv("/Users/Eric/tcrseq/new/processed/pancan_exome_rna_blood_tcrb_gsva_clinical_7-13-2016.txt", sep="\t")
clonotypes <- read.csv("/Users/Eric/tcrseq/new/processed/pancan_clonotypes_all_7-14-2016.txt", sep="\t")
### recreate figures from BRCA paper
cdr3_results_current<-results
# calculating the iDNA score, rna_rpm, R and D groups
cdr3_results_current<-mutate(cdr3_results_current,exome_rpm=exome_cdr3*10^6/exome_reads)
tmp<-select(filter(cdr3_results_current,exome_rpm!=0),patient_uuid,exome_rpm)
tmp<-mutate(tmp,iDNA_score=ntile(exome_rpm,10))
cdr3_results_current<-left_join(cdr3_results_current,tmp)
cdr3_results_current<-mutate(cdr3_results_current,iDNA_score=ifelse(is.na(iDNA_score),0,iDNA_score))
cdr3_results_current<-mutate(cdr3_results_current,rna_rpm=rna_cdr3*10^6/rna_reads)
cdr3_results_current<-mutate(cdr3_results_current,blood_rpm=blood_cdr3*10^6/blood_reads)
cdr3_results_current<-mutate(cdr3_results_current,D=ifelse(exome_rpm==0,"D-","D+"),R=ifelse(rna_rpm==0,"R-","R+"))
### recreate relevant results report
cancer_current <- cdr3_results_current
# remove cohort size <400
# BLCA, BRCA, COAD, HNSC, KIRC, LGG, LUAD, LUSC, OV, PRAD, STAD, THCA, UCEC
cancer_current <- filter(cdr3_results_current, cohort=="BLCA" | cohort=="BRCA" | cohort=="COAD" | cohort=="HNSC" |
cohort=="KIRC" | cohort=="LGG" | cohort=="LUAD" | cohort=="LUSC" | cohort=="OV" |
cohort=="PRAD" | cohort=="STAD" | cohort=="THCA" | cohort=="UCEC")
cancer_current$cohort <- factor(cancer_current$cohort)
cancer_split <- split(cancer_current, cancer_current$cohort)
# contrast infiltration of cancer types
exome_split <- lapply(cancer_split, '[[', "exome_rpm")
rna_split <- lapply(cancer_split, '[[', "rna_rpm")
blood_split <- lapply(cancer_split, '[[', "blood_rpm")
idna_split <- lapply(cancer_split, '[[', "iDNA_score")
ggplot(cancer_current, aes(x=exome_rpm, y=rna_rpm, colour=cohort)) + geom_point()
exome_avg <- sapply(exome_split, mean, na.rm=TRUE)
rna_avg <- sapply(rna_split, mean, na.rm=TRUE)
cohort_sizes <- table(cancer_current$cohort)
avgs_plot <- as.data.frame(cbind(exome_avg, rna_avg, cohort_sizes))
ggplot(avgs_plot, aes(exome_avg, rna_avg, size=cohort_sizes, colour=rownames(avgs_plot))) + geom_point()
# exome CDR3 high without RNA
tmp <- filter(cancer_current,D=="D+",R=="R-")
# exome vs. blood
exome_only <- filter(clonotypes, exome > 0)
63*0.14
library(stringdist)
### put together both RNA and DNA
results_exome <- read.csv("/Users/Eric/tcrseq/new/processed/pancan_exome_rna_blood_tcrb_gsva_clinical_7-5-2016_exome.txt", sep="\t")
results_RNA <- read.csv("/Users/Eric/tcrseq/new/processed/pancan_exome_rna_blood_tcrb_gsva_clinical_7-5-2016_RNA.txt", sep="\t")
patients_exome_to_add <- setdiff(as.character(results_exome$patient_uuid), as.character(results_RNA$patient_uuid))
rownames(results_exome) <- as.character(results_exome$patient_uuid)
rows_exome_to_add <- results_exome[patients_exome_to_add,]
rownames(rows_exome_to_add) <- NULL
results_both <- rbind(results_RNA, rows_exome_to_add)
write.table(results, "/Users/Eric/tcrseq/new/processed/pancan_exome_rna_blood_tcrb_gsva_clinical_7-6-2016.txt", sep="\t",
row.names=FALSE, quote=FALSE)
### compare
results_new <- read.csv("/Users/Eric/tcrseq/new/processed/pancan_exome_rna_blood_tcrb_gsva_clinical_7-13-2016.txt", sep="\t")
#results_old <- read.csv("/Users/Eric/tcrseq/new/processed/pancan_exome_gsva_clinical_dedup.txt", sep="\t")
results_old <- read.csv("/Users/Eric/BRCA/cdr3_results_with_expression_blood_ptprc_burden_purity_gsva_clustering_four_groups_1078.txt", sep="\t")
results_holt <- read.csv("/Users/Eric/tcrseq/new/holt/TCGA_mitcr_cdr3_result_160401.tsv.datafreeze1.3.filtered.tsv", sep="\t")
clonotypes_new <- read.csv("/Users/Eric/tcrseq/new/processed/pancan_clonotypes_all_7-14-2016.txt", sep="\t")
### comparing to Holt
clonotypes_rna <- clonotypes_new[clonotypes_new$rna>0,]
pancan_rna_unique_nuc <- as.character(unique(clonotypes_rna$clonotype))
holt_unique_nuc <- as.character(unique(results_holt$nucSeq))
length(intersect(pancan_rna_unique_nuc, holt_unique_nuc))
pancan_rna_unique_aa <- as.character(unique(clonotypes_rna$aa))
pancan_rna_unique_aa <- pancan_rna_unique_aa[complete.cases((pancan_rna_unique_aa))]
holt_unique_aa <- as.character(unique(results_holt$aaSeq))
length(intersect(pancan_rna_unique_aa, holt_unique_aa))
# within distances
distances_mat <- matrix(NA, nrow=length(pancan_rna_unique_aa), ncol=3)
for (i in 1:length(pancan_rna_unique_aa))
{
pancan_rna_unique_without <- pancan_rna_unique_aa[-i]
distances <- stringdist(pancan_rna_unique_aa[i], pancan_rna_unique_without)
distance <- min(distances)
aa_without <- pancan_rna_unique_without[which(distances==distance)][1]
aa_pancan <- pancan_rna_unique_aa[i]
distances_mat[i,] <- c(distance, aa_pancan, aa_without)
}
distances_mat[1,]
write.table(distances_mat, "pancan_clonotypes_within_edit_distances.txt", quote=FALSE, row.names=FALSE, col.names=FALSE, sep="\t")
distances_mat <- read.csv("/Users/Eric/tcrseq/new/processed/pancan_clonotypes_within_edit_distances.txt", sep="\t", header=FALSE)
distances <- distances_mat[,1]
hist(distances, xlab="Minimum string distance", main="Distances within pancan")
table(distances)
results <- read.csv("/Users/Eric/tcrseq/new/processed/pancan_exome_rna_blood_tcrb_gsva_clinical_7-13-2016.txt", sep="\t")
library(OIsurv)
library(cgdsr)
library(cluster)
library(fpc)
library(gplots)
library(heatmap.plus)
library(reshape2)
library(dplyr)
library(ggplot2)
library(plotrix)
library(VennDiagram)
library(ggrepel)
results <- read.csv("/Users/Eric/tcrseq/new/processed/pancan_exome_rna_blood_tcrb_gsva_clinical_7-13-2016.txt", sep="\t")
clonotypes <- read.csv("/Users/Eric/tcrseq/new/processed/pancan_clonotypes_all_7-14-2016.txt", sep="\t")
### recreate figures from BRCA paper
cdr3_results_current<-results
# calculating the iDNA score, rna_rpm, R and D groups
cdr3_results_current<-mutate(cdr3_results_current,exome_rpm=exome_cdr3*10^6/exome_reads)
tmp<-select(filter(cdr3_results_current,exome_rpm!=0),patient_uuid,exome_rpm)
tmp<-mutate(tmp,iDNA_score=ntile(exome_rpm,10))
cdr3_results_current<-left_join(cdr3_results_current,tmp)
cdr3_results_current<-mutate(cdr3_results_current,iDNA_score=ifelse(is.na(iDNA_score),0,iDNA_score))
cdr3_results_current<-mutate(cdr3_results_current,rna_rpm=rna_cdr3*10^6/rna_reads)
cdr3_results_current<-mutate(cdr3_results_current,blood_rpm=blood_cdr3*10^6/blood_reads)
cdr3_results_current<-mutate(cdr3_results_current,tcrb_rpm=tcrb_reads*10^6/rna_reads)
cdr3_results_current<-mutate(cdr3_results_current,D=ifelse(exome_rpm==0,"D-","D+"),R=ifelse(rna_rpm==0,"R-","R+"))
### recreate relevant results report
cancer_current <- cdr3_results_current
# remove cohort size <400
# BLCA, BRCA, COAD, HNSC, KIRC, LGG, LUAD, LUSC, OV, PRAD, STAD, THCA, UCEC
#cancer_current <- filter(cdr3_results_current, cohort=="BLCA" | cohort=="BRCA" | cohort=="COAD" | cohort=="HNSC" |
#                       cohort=="KIRC" | cohort=="LGG" | cohort=="LUAD" | cohort=="LUSC" | cohort=="OV" |
#                       cohort=="PRAD" | cohort=="STAD" | cohort=="THCA" | cohort=="UCEC")
#cancer_current$cohort <- factor(cancer_current$cohort)
#cancer_split <- split(cancer_current, cancer_current$cohort)
# remove THYM since it only has ONE exome case, UVM and CHOL have no RNA
cancer_current <- filter(cdr3_results_current, cohort != "THYM", cohort != "UVM", cohort != "CHOL")
cancer_current$cohort <- factor(cancer_current$cohort)
cancer_split <- split(cancer_current, cancer_current$cohort)
# contrast infiltration of cancer types
exome_split <- lapply(cancer_split, '[[', "exome_rpm")
rna_split <- lapply(cancer_split, '[[', "rna_rpm")
blood_split <- lapply(cancer_split, '[[', "blood_rpm")
idna_split <- lapply(cancer_split, '[[', "iDNA_score")
#ggplot(cancer_current, aes(x=exome_rpm, y=rna_rpm, colour=cohort)) + geom_point()
#exome_avg <- sapply(exome_split, mean, na.rm=TRUE)
#rna_avg <- sapply(rna_split, mean, na.rm=TRUE)
exome_avg <- log(sapply(exome_split, mean, na.rm=TRUE), 10)
rna_avg <- log(sapply(rna_split, mean, na.rm=TRUE), 10)
cohort_sizes <- table(cancer_current$cohort)
avgs_plot <- as.data.frame(cbind(exome_avg, rna_avg, cohort_sizes))
ggplot(avgs_plot, aes(exome_avg, rna_avg, size=cohort_sizes, colour=rownames(avgs_plot))) + geom_point() + labs(title="Cohort average exome and RNA RPM", x="log(exome CDR3 rpm)", y="log(RNA CDR3 rpm)")
ggplot(avgs_plot, aes(exome_avg, rna_avg)) + geom_point() + labs(title="Cohort average exome and RNA RPM", x="log(exome CDR3 rpm)", y="log(RNA CDR3 rpm)") + geom_text_repel(data=avgs_plot, aes(label=rownames(avgs_plot)))
# contrast read counts of cancer types
exome_read_split <- lapply(cancer_split, '[[', "exome_reads")
rna_read_split <- lapply(cancer_split, '[[', "rna_reads")
percent_tils_split <- lapply(cancer_split, '[[', "percent_tils")
tcrb_rpm_split <- lapply(cancer_split, '[[', "tcrb_rpm")
tcrb_rpm_log_split <- lapply(tcrb_rpm_split, FUN=log)
gsva_cluster_split <- lapply(cancer_split, '[[', "gsva_cluster")
exome_read_melt <- melt(exome_read_split)
exome_read_melt$value <- log(exome_read_melt$value, 10)
ggplot(exome_read_melt, aes(x=L1, y=value)) + geom_boxplot() + labs(title="Exome read counts by cohort", x="Cohort", y="log(read count)")
rna_read_melt <- melt(rna_read_split)
rna_read_melt$value <- log(rna_read_melt$value, 10)
ggplot(rna_read_melt, aes(x=L1, y=value)) + geom_boxplot() + labs(title="RNA read counts by cohort", x="Cohort", y="log(read count)")
results[1,]
cancer_current[1,]
filter(cancer_current, !is.na(exome_rpm))
nrow(filter(cancer_current, !is.na(exome_rpm)))
exome_n <- nrow(filter(cancer_current, !is.na(exome_rpm)))
rna_n <- nrow(filter(cancer_current, !is.na(rna_rpm)))
blood_n <- nrow(filter(cancer_current, !is.na(blood_rpm)))
exome_n
rna_n
blood_n
exome_rna_n <- nrow(filter(cancer_current, !is.na(rna_rpm) & !is.na(exome_rpm)))
exome_rna_n
exome_n <- nrow(filter(cancer_current, !is.na(exome_rpm)))
rna_n <- nrow(filter(cancer_current, !is.na(rna_rpm)))
blood_n <- nrow(filter(cancer_current, !is.na(blood_rpm)))
exome_rna_n <- nrow(filter(cancer_current, !is.na(rna_rpm) & !is.na(exome_rpm)))
exome_blood_n <- nrow(filter(cancer_current, !is.na(blood_rpm) & !is.na(exome_rpm)))
blood_rna_n <- nrow(filter(cancer_current, !is.na(rna_rpm) & !is.na(blood_rpm)))
exome_rna_blood_n <- nrow(filter(cancer_current, !is.na(rna_rpm) & !is.na(exome_rpm) & !is.na(blood_rpm)))
exome_n
rna_n
blood_n
exome_blood_n
exome_rna_n
blood_rna_n
exome_rna_blood_n
draw.pairwise.venn(area1 = exome_n, area2 = rna_n, area3 = blood_n,
n12 = exome_rna_n, n23 = blood_rna_n, n13 = exome_blood_n,
n123 = exome_rna_blood_n)
grid.newpage()
draw.triple.venn(area1 = exome_n, area2 = rna_n, area3 = blood_n,
n12 = exome_rna_n, n23 = blood_rna_n, n13 = exome_blood_n,
n123 = exome_rna_blood_n, fill = c("skyblue", "orange"))
draw.triple.venn(area1 = exome_n, area2 = rna_n, area3 = blood_n,
n12 = exome_rna_n, n23 = blood_rna_n, n13 = exome_blood_n,
n123 = exome_rna_blood_n)
exome_n
blood_n
exome_blood_n
grid.newpage()
draw.triple.venn(area1 = exome_n, area2 = rna_n, area3 = blood_n,
n12 = exome_rna_n, n23 = blood_rna_n, n13 = exome_blood_n,
n123 = exome_rna_blood_n, fill = c("skyblue", "orange", "green"))
grid.newpage()
draw.triple.venn(area1 = exome_n, area2 = rna_n, area3 = blood_n,
n12 = exome_rna_n, n23 = blood_rna_n, n13 = exome_blood_n,
n123 = exome_rna_blood_n, fill = c("skyblue", "orange", "green"),
category = c("Tumor exome", "Tumor RNA", "Blood exome"))
exome_rna_blood <- filter(cancer_current, !is.na(rna_rpm) & !is.na(exome_rpm) & !is.na(blood_rpm))
table(exome_rna_blood$cohort)
barplot(table(exome_rna_blood$cohort))
testy <- as.data.frame(table(exome_rna_blood)$cohort)
testy <- as.data.frame(table(exome_rna_blood$cohort))
testy
testy[1,]
ggplot(as.data.frame(table(exome_rna_blood$cohort)), aes(x=Freq)) + geom_barplot()
ggplot(as.data.frame(table(exome_rna_blood$cohort)), aes(x=Freq)) + geom_bar()
ggplot(as.data.frame(table(exome_rna_blood$cohort)), aes(x=Var1, y=Freq))
ggplot(as.data.frame(table(exome_rna_blood$cohort)), aes(x=Var1, y=Freq)) + geom_bar(stat="identity")
ggplot(as.data.frame(table(exome_rna_blood$cohort)), aes(x=Var1, y=Freq)) + geom_bar(stat="identity") + labs(title="Number of patients with exome/RNA/blood", x="Cohort", y="Number of patients") + theme(axis.text.x = element_text(angle = 90, hjust = 1))
ggplot(as.data.frame(table(exome_rna_blood$cohort)), aes(x=Var1, y=Freq)) + geom_bar(stat="identity") + labs(title="Number of patients with tumor exome, tumor RNA, and blood exome", x="Cohort", y="Number of patients") + theme(axis.text.x = element_text(angle = 90, hjust = 1))
nrow(filter(exome_rna_blood, cohort="BRCA"))
nrow(filter(exome_rna_blood, cohort=="BRCA"))
nrow(filter(cancer_current, !is.na(rna_rpm) | !is.na(exome_rpm) | !is.na(blood_rpm)))
