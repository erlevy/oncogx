{
    "collab_server" : "",
    "contents" : "\nexome_dir <- \"/Users/Eric/tcrseq/new/imseq/exome/\"\nrna_dir <- \"/Users/Eric/tcrseq/new/imseq/rna/\"\nblood_dir <- \"/Users/Eric/tcrseq/new/imseq/blood/\"\n\nfile_exome <- list.files(path=exome_dir, pattern=\"*.tsv\", full.names=T, recursive=FALSE)\nfile_rna <- list.files(path=rna_dir, pattern=\"*.tsv\", full.names=T, recursive=FALSE)\nfile_blood <- list.files(path=blood_dir, pattern=\"*.tsv\", full.names=T, recursive=FALSE)\n\nresults <- read.csv(\"/Users/Eric/tcrseq/new/processed/pancan_exome_rna_blood_tcrb_gsva_clinical_7-30-2016.txt\", sep=\"\\t\")\n \n### get output of all clonotypes by patient id for blood, rna, and exome\nclonotypes_all <- matrix(nrow=0, ncol=6)\nclonotypes_exome <- matrix(nrow=0, ncol=6)\ncolnames(clonotypes_all) <- c(\"clonotype\", \"patient_id\", \"blood\", \"rna\", \"exome\", \"nuc\")\nexome_clonotypes <- c()\nrna_clonotypes <- c()\nblood_clonotypes <- c()\nfor (i in 1:nrow(results))\n{\n  clonotypes_patient <- matrix(nrow=0, ncol=6)\n  clonotypes_exome_patient <- matrix(nrow=0, ncol=6)\n  exome_reads <- matrix(nrow=0, ncol=11)\n  exome_file <- paste(results$exome_uuid[i], \".tsv\", sep=\"\")\n  exome_path <- paste(exome_dir, exome_file, sep=\"\")\n  rna_reads <- matrix(nrow=0, ncol=11)\n  rna_file <- paste(results$rna_uuid[i], \".tsv\", sep=\"\")\n  rna_path <- paste(rna_dir, rna_file, sep=\"\")\n  blood_reads <- matrix(nrow=0, ncol=11)\n  blood_file <- paste(results$blood_uuid[i], \".tsv\", sep=\"\")\n  blood_path <- paste(blood_dir, blood_file, sep=\"\")\n\n  if(!file.exists(exome_path)) {next}\n  exome_reads <- as.matrix(read.csv(exome_path, sep=\"\\t\", header=T))\n  if(file.exists(rna_path)) {rna_reads <- as.matrix(read.csv(rna_path, sep=\"\\t\", header=T))\n  } else {rna_reads <- NULL}\n  if(file.exists(blood_path)) {blood_reads <- as.matrix(read.csv(blood_path, sep=\"\\t\", header=T))\n  } else {blood_reads <- NULL}\n\n  if (nrow(exome_reads)>0) \n  {\n    for (j in 1:nrow(exome_reads))\n    {\n      cl <- exome_reads[j,11]\n      nuc <- exome_reads[j,10]\n      match <- which(clonotypes_patient[,1]==cl)\n      left_match <- exome_reads[j,4]\n      right_match <- exome_reads[j,7]\n      if (length(match)==0) \n      {\n        clonotypes_patient <- rbind(clonotypes_patient, c(cl, as.character(results$patient_uuid[i]), 0, 0, 1, nuc))\n#        clonotypes_exome_patient <- rbind(clonotypes_exome_patient, c(cl, aa, as.character(substr(results$sample_barcode[i], 1, 16)), 1, left_match, right_match))\n      } else \n      {\n        clonotypes_patient[match,5] <- as.character(as.numeric(clonotypes_patient[match,5]) + 1)\n#        clonotypes_exome_patient[match,4] <- as.character(as.numeric(clonotypes_exome_patient[match,4]) + 1)\n      }\n      \n    }    \n  }\n  \n  if (length(rna_reads)>2)\n  {\n    for (j in 1:nrow(rna_reads))\n    {\n      cl <- rna_reads[j,11]\n      nuc <- rna_reads[j,10]\n      match <- which(clonotypes_patient[,1]==cl)\n      if (length(match)==0) {clonotypes_patient <- rbind(clonotypes_patient, c(cl, as.character(results$patient_uuid[i]), 0, 1, 0, nuc))  }\n      else {clonotypes_patient[match,4] <- as.character(as.numeric(clonotypes_patient[match,4]) + 1)}\n    }\n  }\n\n  if (length(blood_reads)>2)\n  {\n    for (j in 1:nrow(blood_reads))\n    {\n      cl <- blood_reads[j,11]\n      nuc <- blood_reads[j,10]\n      match <- which(clonotypes_patient[,1]==cl)\n      if (length(match)==0) {clonotypes_patient <- rbind(clonotypes_patient, c(cl, as.character(results$patient_uuid[i]), 1, 0, 0, nuc))  }\n      else {clonotypes_patient[match,3] <- as.character(as.numeric(clonotypes_patient[match,3]) + 1)}\n    }\n  }\n\n  if (is.null(rna_reads)) {clonotypes_patient[,4] <- rep(NA, nrow(clonotypes_patient))}\n  if (is.null(blood_reads)) {clonotypes_patient[,3] <- rep(NA, nrow(clonotypes_patient))}\n  clonotypes_all <- rbind(clonotypes_all, clonotypes_patient)\n#  if (nrow(clonotypes_exome_patient)>0) {clonotypes_exome <- rbind(clonotypes_exome, clonotypes_exome_patient)}\n}\n\nwrite.table(clonotypes_all, \"/Users/Eric/tcrseq/new/processed/pancan_clonotypes_all_7-30-2016.txt\", sep=\"\\t\", quote=FALSE, row.names=FALSE)\n",
    "created" : 1468515447293.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "4176271770",
    "id" : "CD990EC1",
    "lastKnownWriteTime" : 1469901246,
    "last_content_update" : 1469901246,
    "path" : "~/tcrseq/new/rstudio_data/clonotypes_output.R",
    "project_path" : "clonotypes_output.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}